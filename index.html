<!DOCTYPE html>
<html lang="fa" dir="rtl" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="app-title">ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø²Ø¨Ø§Ù† Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f7f9fc;
      --surface: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border: rgba(17, 24, 39, 0.08);
      --shadow: 0 10px 30px -12px rgba(2, 6, 23, .18);
      --primary: #3b82f6;
      --primary-600:#2563eb;
      --chip:#f8fafc;
      --chip-border:#e5e7eb;
      --accent-1: #e0e7ff;
      --accent-2: #fce7f3;
      --accent-3: #ccfbf1;
      --accent-4: #fef3c7;
    }
    [data-theme="dark"]{
      --bg: #0b1220;
      --surface: #0f172a;
      --text: #e5e7eb;
      --muted: #9ca3af;
      --border: rgba(148, 163, 184, 0.15);
      --shadow: 0 14px 42px -12px rgba(2, 6, 23, .6);
      --primary: #60a5fa;
      --primary-600:#3b82f6;
      --chip:#0b1220;
      --chip-border:#1f2937;
      --accent-1: #1e293b;
      --accent-2: #1f2540;
      --accent-3: #0f2f2b;
      --accent-4: #2a1f0f;
    }

    html { scroll-behavior: smooth; }
    body {
      font-family: 'Vazirmatn', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background-color: var(--bg);
      background-image:
        radial-gradient(1200px 600px at 100% -10%, var(--accent-1), transparent 60%),
        radial-gradient(900px 500px at -10% 110%, var(--accent-2), transparent 60%);
      color: var(--text);
      min-height: 100vh;
    }

    .glass {
      backdrop-filter: saturate(160%) blur(12px);
      background: color-mix(in oklab, var(--surface) 78%, transparent);
      border-bottom: 1px solid var(--border);
    }

    .card {
      background: color-mix(in oklab, var(--surface) 94%, transparent);
      border: 1px solid var(--border);
      border-radius: 1.25rem;
      box-shadow: var(--shadow);
    }

    .ring-card {
      position: relative;
      border-radius: 1rem;
      overflow: hidden;
      background-color: var(--surface);
    }
    .ring-card::before{
      content:"";
      position:absolute; inset: -1px;
      border-radius: 1rem;
      padding: 1px;
      background: conic-gradient(from 180deg, #60a5fa, #a78bfa, #22d3ee, #60a5fa);
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude;
      pointer-events: none;
      animation: spin 8s linear infinite;
      opacity: .75;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .result-header {
      cursor: pointer;
      background: color-mix(in oklab, var(--surface) 88%, transparent);
      transition: background .2s ease, transform .15s ease;
    }
    .ring-card:hover .result-header { transform: translateY(-1px); }
    .result-details {
      max-height: 0; overflow: hidden;
      transition: max-height .5s ease, padding .35s ease, border-color .35s ease;
      border-top: 1px solid transparent;
      padding: 0 1.25rem;
      background: var(--surface);
    }
    .result-details.open {
      max-height: 1600px; border-top-color: var(--border);
      padding: 1rem 1.25rem 1.25rem;
    }

    .chip {
      display: inline-flex; align-items: center; gap:.35rem;
      padding: .22rem .6rem; border-radius: 999px;
      font-size: .78rem; font-weight: 600;
      border: 1px solid var(--chip-border);
      background: var(--chip);
      white-space: nowrap;
    }
    .chip .dot{width:.5rem;height:.5rem;border-radius:999px;opacity:.85}

    .drop-zone {
      border: 2px dashed var(--border);
      border-radius: 1rem; transition: all .2s ease;
      background: color-mix(in oklab, var(--surface) 80%, transparent);
    }
    .drop-zone.drag-over { border-color: var(--primary); background: color-mix(in oklab, var(--surface) 92%, transparent); }

    .btn {
      border-radius: .85rem; font-weight: 700; padding: .68rem 1.2rem;
      display: inline-flex; align-items: center; gap: .55rem;
      border: 1px solid var(--border);
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
      will-change: transform;
    }
    .btn:active{ transform: translateY(1px) }
    .btn-primary{
      background: linear-gradient(180deg, var(--primary), var(--primary-600));
      color: #fff; border-color: color-mix(in oklab, var(--primary-600) 60%, #0000);
      box-shadow: 0 12px 28px -12px color-mix(in oklab, var(--primary) 60%, transparent);
    }
    .btn-secondary{ background: var(--surface); color: var(--text); }
    .btn-ghost{ background: transparent; border-color: transparent; }

    .muted { color: var(--muted); }

    .skeleton {
      background: linear-gradient(90deg,
        color-mix(in oklab, var(--surface) 75%, transparent) 25%,
        color-mix(in oklab, var(--surface) 95%, transparent) 37%,
        color-mix(in oklab, var(--surface) 75%, transparent) 63%);
      background-size: 400% 100%;
      animation: shimmer 1.2s ease-in-out infinite;
      border-radius: .75rem;
    }
    @keyframes shimmer { 0%{background-position: 100% 0} 100%{background-position: 0 0} }

    .toggle {
      width: 44px; height: 26px; border-radius: 999px; position: relative; border:1px solid var(--border);
      background: color-mix(in oklab, var(--surface) 86%, transparent); cursor: pointer;
      display: inline-flex; align-items: center;
    }
    .toggle .knob { width: 20px; height: 20px; border-radius: 999px; background: var(--primary); transition: transform .2s ease; transform: translateX(2px); }
    [data-theme="dark"] .toggle .knob { transform: translateX(22px); }

    .floating-top {
      position: fixed; bottom: 20px; inset-inline-end: 20px; z-index: 50;
      backdrop-filter: blur(8px);
      background: color-mix(in oklab, var(--surface) 92%, transparent);
      border:1px solid var(--border); border-radius: 999px;
      padding: .6rem .8rem; box-shadow: var(--shadow);
      display: none;
    }
    .floating-top.show{ display: inline-flex; }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="sticky top-0 z-20 glass">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="size-9 rounded-xl bg-gradient-to-br from-blue-500 via-indigo-500 to-cyan-400 grid place-items-center text-white shadow">
          <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 0-3 3v4a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M12 18a3 3 0 0 0 3-3V9a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3Z"/></svg>
        </div>
        <div>
          <h1 id="main-title" class="text-xl md:text-2xl font-extrabold tracking-tight"></h1>
          <p id="header-subtitle" class="text-xs muted hidden sm:block"></p>
        </div>
      </div>

      <div class="flex items-center gap-3">
        <div class="flex items-center gap-2">
            <div class="relative flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 rtl:right-3 rtl:left-auto size-4 pointer-events-none text-[var(--muted)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
                <select id="ui-lang-switcher" class="appearance-none w-full pl-10 pr-4 rtl:pr-10 rtl:pl-4 py-1.5 rounded-lg border text-sm bg-[var(--surface)] border-[var(--border)]"></select>
            </div>
          <button id="theme-toggle" class="toggle" aria-label="toggle theme">
            <span class="knob"></span>
          </button>
          <button id="stop-tts" class="btn btn-ghost p-2.5" title="ØªÙˆÙ‚Ù Ú¯ÙØªØ§Ø±" aria-label="stop-tts">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Hero -->
  <section class="max-w-5xl mx-auto px-4 pt-8 pb-2">
      <div class="card p-6 md:p-8">
        <p id="subtitle" class="muted mb-4 text-base"></p>

        <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
          <div>
            <label id="source-lang-label" class="block text-sm font-medium mb-1"></label>
            <select id="source-lang" class="w-full p-2.5 rounded-xl border bg-[var(--surface)] border-[var(--border)]"></select>
          </div>
          <div>
            <label id="target-lang-label" class="block text-sm font-medium mb-1"></label>
            <select id="target-lang" class="w-full p-2.5 rounded-xl border bg-[var(--surface)] border-[var(--border)]"></select>
          </div>
          <div>
            <label id="user-level-label" class="block text-sm font-medium mb-1"></label>
            <select id="user-level" class="w-full p-2.5 rounded-xl border bg-[var(--surface)] border-[var(--border)]">
              <option id="level-unspecified" value="Unspecified"></option>
              <option id="level-a1" value="A1 (Beginner)"></option>
              <option id="level-a2" value="A2 (Elementary)"></option>
              <option id="level-b1" value="B1 (Intermediate)"></option>
              <option id="level-b2" value="B2 (Upper-Intermediate)"></option>
              <option id="level-c1" value="C1 (Advanced)"></option>
            </select>
          </div>
          <div class="flex items-end">
            <label class="inline-flex items-center gap-2 cursor-pointer">
              <input id="force-wordlist" type="checkbox" class="w-4 h-4 rounded accent-[var(--primary)]">
              <span id="force-wordlist-label" class="text-sm"></span>
            </label>
          </div>
        </div>

        <div id="hint-container" class="mb-5 rounded-xl border border-[var(--border)] bg-[var(--surface)]">
            <div class="px-4 py-3 flex items-start gap-3">
              <div class="size-8 rounded-lg bg-[var(--accent-1)]/60 grid place-items-center mt-1">ğŸ’¡</div>
              <div id="hint" class="text-sm muted space-y-1"></div>
            </div>
        </div>

        <div id="drop-zone" class="drop-zone p-4">
          <div class="flex items-center justify-between mb-3">
            <div class="flex items-center gap-2">
              <span id="drop-hint-icon" class="inline-grid place-items-center size-8 rounded-lg bg-[var(--accent-3)]/50">ğŸ“</span>
              <span id="drop-hint-text" class="text-sm muted"></span>
            </div>
            <div id="drag-drop-badge" class="text-xs px-2 py-1 rounded-full bg-[var(--accent-2)]/40 border border-[var(--border)]"></div>
          </div>

          <textarea id="text-input" rows="10" class="w-full p-3 rounded-xl border bg-[var(--surface)] border-[var(--border)] focus:outline-none"></textarea>

          <div class="flex flex-col md:flex-row gap-3 md:items-center justify-between mt-4">
            <div class="flex items-center gap-2">
              <label for="file-upload" class="cursor-pointer btn btn-secondary">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                <span id="upload-btn-text"></span>
              </label>
              <input id="file-upload" type="file" class="hidden" accept=".txt,.srt">
              <span id="file-name" class="text-sm muted"></span>
            </div>
            <button id="process-btn" class="btn btn-primary px-8">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
              <span class="select-none"></span>
            </button>
          </div>
          <p id="error-msg" class="text-red-500 text-sm mt-3 text-center hidden"></p>
        </div>
      </div>
  </section>

  <!-- Results -->
  <main class="max-w-7xl mx-auto px-4 pb-16">
    <section id="results-view" class="hidden mt-8">
      <div class="card p-4 md:p-5 flex flex-col md:flex-row gap-3 md:items-center justify-between mb-6">
        <h2 id="results-title" class="text-2xl md:text-3xl font-extrabold"></h2>
        <div class="flex gap-2">
          <button id="expand-all" class="btn btn-secondary text-sm"></button>
          <button id="collapse-all" class="btn btn-secondary text-sm"></button>
          <button id="start-over-btn" class="btn btn-secondary text-sm"></button>
        </div>
      </div>

      <div id="loader" class="grid gap-4 md:grid-cols-2 hidden">
        <div class="ring-card"><div class="card p-5"><div class="skeleton h-6 w-40 mb-3"></div><div class="skeleton h-4 w-72 mb-6"></div><div class="skeleton h-24"></div></div></div>
        <div class="ring-card"><div class="card p-5"><div class="skeleton h-6 w-40 mb-3"></div><div class="skeleton h-4 w-72 mb-6"></div><div class="skeleton h-24"></div></div></div>
      </div>

      <div id="results-list" class="space-y-4"></div>
    </section>
  </main>

  <footer class="text-center p-8 mt-8 text-sm muted">
      <p id="footer-text-line1"></p>
      <p id="footer-text-line2" class="mt-1"></p>
  </footer>

  <button id="to-top" class="floating-top" aria-label="Back to top" title="Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¨Ø§Ù„Ø§">â¤´ï¸</button>

  <script>
    const PROXY_URL = 'https://language-learner.qaderi.workers.dev/';
    
    // === Languages (ÙÙ‚Ø· Ù‡Ù…ÛŒÙ† 9ØªØ§Ø› tts Ø¨Ø±Ø§ÛŒ Ø¯Ú©Ù…Ù‡â€ŒÛŒ Ù¾Ø®Ø´ Ù„Ø§Ø²Ù… Ø¨ÙˆØ¯)
    const LANGS = [
      { code:'fa', label:'ÙØ§Ø±Ø³ÛŒ',   en:'Persian',  tts:'fa-IR' },
      { code:'en', label:'English', en:'English',  tts:'en-US' },
      { code:'de', label:'Deutsch', en:'German',   tts:'de-DE' },
      { code:'fr', label:'FranÃ§ais',en:'French',   tts:'fr-FR' },
      { code:'es', label:'EspaÃ±ol', en:'Spanish',  tts:'es-ES' },
      { code:'zh', label:'ä¸­æ–‡',     en:'Chinese',  tts:'zh-CN' },
      { code:'tr', label:'TÃ¼rkÃ§e',  en:'Turkish',  tts:'tr-TR' },
      { code:'it', label:'Italiano',en:'Italian',  tts:'it-IT' },
      { code:'ru', label:'Ğ ÑƒÑÑĞºĞ¸Ğ¹', en:'Russian',  tts:'ru-RU' },
    ];
    const RTL_LANGS = new Set(['fa']);

    // ====== Grab elements
    const resultsView = document.getElementById('results-view');
    const processBtn = document.getElementById('process-btn');
    const startOverBtn = document.getElementById('start-over-btn');
    const textInput = document.getElementById('text-input');
    const fileUpload = document.getElementById('file-upload');
    const fileNameEl = document.getElementById('file-name');
    const errorMsg = document.getElementById('error-msg');
    const userLevelSelect = document.getElementById('user-level');
    const sourceLangSelect = document.getElementById('source-lang');
    const targetLangSelect = document.getElementById('target-lang');
    const loader = document.getElementById('loader');
    const resultsList = document.getElementById('results-list');
    const uiLangSwitcher = document.getElementById('ui-lang-switcher');
    const dropZone = document.getElementById('drop-zone');
    const stopTTSBtn = document.getElementById('stop-tts');
    const expandAllBtn = document.getElementById('expand-all');
    const collapseAllBtn = document.getElementById('collapse-all');
    const forceWordlist = document.getElementById('force-wordlist');
    const toTopBtn = document.getElementById('to-top');
    const themeToggle = document.getElementById('theme-toggle');

    // ===== Theme
    const savedTheme = localStorage.getItem('ll-theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    themeToggle.addEventListener('click', () => {
      const next = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('ll-theme', next);
    });

    // ===== Events
    processBtn.addEventListener('click', handleProcessRequest);
    startOverBtn.addEventListener('click', () => {
      resultsView.classList.add('hidden');
      textInput.value=''; fileUpload.value=''; fileNameEl.textContent=''; resultsList.innerHTML='';
      hideError();
      window.scrollTo({top:0, behavior:'smooth'});
      updateModeBadge();
    });
    expandAllBtn.addEventListener('click', () => toggleAll(true));
    collapseAllBtn.addEventListener('click', () => toggleAll(false));
    stopTTSBtn.addEventListener('click', () => speechSynthesis.cancel());
    fileUpload.addEventListener('change', (e) => { const f = e.target.files[0]; if (f) handleFile(f); });
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
    dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('drag-over'); const f = e.dataTransfer.files[0]; if (f) handleFile(f); });
    uiLangSwitcher.addEventListener('change', (e) => {
      localStorage.setItem('ll-lang', e.target.value);
      setLanguage(e.target.value);
    });
    forceWordlist.addEventListener('change', syncLevelRequirement);
    textInput.addEventListener('input', syncLevelRequirement);
    window.addEventListener('scroll', () => { toTopBtn.classList.toggle('show', window.scrollY > 800) });
    toTopBtn.addEventListener('click', () => window.scrollTo({top:0, behavior:'smooth'}));

    // ===== File helpers
    function handleFile(file){
      fileNameEl.textContent = file.name;
      const reader = new FileReader();
      reader.onload = (e) => {
        textInput.value = file.name.endsWith('.srt') ? cleanSRT(e.target.result || '') : (e.target.result || '');
        syncLevelRequirement();
      };
      reader.readAsText(file);
    }
    function cleanSRT(s){
      return s.replace(/\uFEFF/g,'').replace(/^\d+\s*$/gm,'')
             .replace(/\d{2}:\d{2}:\d{2},\d{3}\s+-->\s+\d{2}:\d{2}:\d{2},\d{3}.*/g,'')
             .replace(/<[^>]+>/g,'').replace(/[^\S\r\n]+/g,' ')
             .replace(/\n{2,}/g,'\n').trim();
    }

    // ===== UX helpers
    function looksLikeWordList(text){
      const lines = text.split(/\r?\n/).filter(l=>l.trim()!=='');
      if (lines.length>=2 && lines.every(l=>l.trim().length<=40)) return true;
      const tokens = text.split(/\s*-\s*/).filter(t=>t.trim()!=='');
      if (tokens.length>=2 && tokens.every(t=>t.trim().length<=40)) return true;
      return text.trim().split(/\s+/).length < 30 && !text.includes('\n\n');
    }
    function updateModeBadge(){
      const badge = document.getElementById('drag-drop-badge');
      const s = uiStrings[currentLang] || uiStrings.en;
      const isList = forceWordlist.checked || (looksLikeWordList(textInput.value.trim()) && !fileUpload.files[0]);
      badge.textContent = isList ? s.modeWordlist : s.modeText;
    }
    function syncLevelRequirement(){
      const isList = forceWordlist.checked || (looksLikeWordList(textInput.value.trim()) && !fileUpload.files[0]);
      userLevelSelect.disabled = isList;
      if (isList) userLevelSelect.value='Unspecified';
      updateModeBadge();
    }
    function showError(m){ errorMsg.textContent=m; errorMsg.classList.remove('hidden'); }
    function hideError(){ errorMsg.classList.add('hidden'); }

    // ===== Flow
    function handleProcessRequest(){
      const text = textInput.value.trim();
      const level = userLevelSelect.value;
      const isList = forceWordlist.checked || (looksLikeWordList(text) && !fileUpload.files[0]);

      if (!text){ showError(uiStrings[currentLang].errorText); return; }
      if (!isList && level==='Unspecified'){ showError(uiStrings[currentLang].errorLevel); return; }

      hideError();
      resultsView.classList.remove('hidden');
      loader.classList.remove('hidden');
      resultsList.innerHTML='';
      callAI(text, isList);
      document.getElementById('results-view').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function englishName(code){ return LANGS.find(l=>l.code===code)?.en || code; }
    function ttsCode(code){ return LANGS.find(l=>l.code===code)?.tts || 'en-US'; }

    function buildPrompt(text, isWordList){
      const sourceLang = englishName(sourceLangSelect.value);
      const targetLang = englishName(targetLangSelect.value);
      const level = userLevelSelect.value;
      const taskDesc = isWordList
        ? `You will analyze a USER-PROVIDED LIST of words/phrases in ${targetLang}. For EACH item, produce a full analysis.`
        : `You will analyze a LONG TEXT in ${targetLang}. Extract ALL useful, everyday words, idioms, and phrases for a ${level} learner. For EACH extracted item, produce a full analysis.`;
      const fieldSpec = `For EACH item, output EXACTLY the following template. Use "---" as a separator between items.

Word: [the item in ${targetLang}]
Translation: [translation in ${sourceLang}; if multiple common meanings, separate with ";"]
Definition: [simple, level-appropriate definition in ${targetLang}]
Grammar: [part of speech; e.g., "phrasal verb (inseparable)", "verb (takes Akkusativ)", "noun (countable)"]
Collocations: [common combinations, comma-separated; if none, write "N/A"]
Examples:
1. [Example 1 in ${targetLang}] - [${sourceLang} translation]
2. [Example 2 in ${targetLang}] - [${sourceLang} translation]
Common Mistakes: ["nothing specific" OR a concrete pitfall (wrong preposition, false friend, etc.)]
Context/Note:
- Write 1â€“2 concise sentences on ONE of the following (most relevant): register/formality; synonym contrast; required prepositions/case; language-specific behavior (e.g., separable verb); usage frequency.
- Never output "N/A". Default: "neutral register; general-use".
Pronunciation: [IPA/Pinyin/phonetic if applicable; else "N/A"]
Tags:
- Choose 1â€“3 tags from the list (AT LEAST ONE required). Separate with semicolons.
- Allowed: informal; formal; neutral; spoken; academic; business; travel; tech; slang; idiom; phrasal-verb; collocation; fixed-expression; false-friend; grammar; pronunciation; register; preposition; case; separable; aspect; measure-word; gender; article; tense; frequency-high; frequency-medium; frequency-low; level-a1; level-a2; level-b1; level-b2; level-c1
---`;
      const extraRules = isWordList
        ? `INPUT MODE: WORD LIST. Treat each line or hyphen-separated token as ONE item.`
        : `INPUT MODE: LONG TEXT. "Example 1" MUST be the EXACT sentence from the source text. Add other natural examples. If an item is too basic/rare for ${level}, SKIP it.`;
      return `You are an expert language tutor AI. User's native: ${sourceLang}. Target: ${targetLang}. ${isWordList ? '' : `Proficiency: ${level}.`}

${taskDesc}

RULES:
- Prioritize PRACTICAL usage.
- Output MUST strictly follow the template. No extra commentary.

${fieldSpec}

${extraRules}

${isWordList ? `Here is the word/phrase list:\n${text}` : `Here is the text to analyze:\n${text}`}`;
    }

    async function callAI(text, isWordList){
      const prompt = buildPrompt(text, isWordList);
      try{
        const controller = new AbortController();
        setTimeout(()=>controller.abort(), 60000);
        const res = await fetch(PROXY_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ prompt }), signal: controller.signal });
        if(!res.ok) throw new Error(`Network error: ${res.status}`);
        const data = await res.json();
        const ai = data?.candidates?.[0]?.content?.parts?.[0]?.text || '';
        if(!ai) throw new Error(uiStrings[currentLang].errorAIResponse);
        renderResults(ai);
      }catch(err){
        console.error(err);
        resultsList.innerHTML = `<div class="card p-8 text-center text-red-500">${err.message || uiStrings[currentLang].errorServer}</div>`;
      }finally{
        loader.classList.add('hidden');
      }
    }

    // ===== Parse AI
    function parseAIResponse(s){
      return s.split('---').filter(x=>x.trim()).map(txt=>{
        const data = {}; let currentKey = '';
        txt.trim().split('\n').forEach(line => {
          const match = line.match(/^([a-zA-Z\s/]+):\s*(.*)/);
          if (match) {
            currentKey = match[1].trim().toLowerCase().replace(/[\s/]/g, '');
            data[currentKey] = match[2].trim();
          } else if (currentKey === 'examples' && /^\d+\./.test(line.trim())) {
            data.exampleslist = data.exampleslist || [];
            data.exampleslist.push(line.trim());
          } else if (currentKey === 'contextnote' && line.trim().startsWith('-')) {
            data[currentKey] = (data[currentKey] || '') + '\n' + line.trim();
          }
        });
        return data;
      });
    }

    // ===== Utils
    function escapeHTML(s=''){ return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function speakText(ev, text, langCode){
      ev?.stopPropagation?.();
      if(!text) return;
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text); u.lang = langCode; speechSynthesis.speak(u);
    }
    function tagPalette(i){ return ['#e0e7ff','#ccfbf1','#fef3c7','#fce7f3','#fee2e2'][i % 5]; }

    function renderResults(ai){
        const parsed = parseAIResponse(ai);
        const strings = uiStrings[currentLang] || uiStrings.en;
        if (parsed.length === 0 || parsed.every(x => !x.word)){
            resultsList.innerHTML = `<div class="card p-8 text-center muted">${strings.errorNoResults}</div>`;
            return;
        }
        const tts = ttsCode(targetLangSelect.value);
        resultsList.innerHTML = parsed.map((it, idx)=>{
            const word = escapeHTML(it.word || '');
            const translation = escapeHTML(it.translation || '');
            const grammar = escapeHTML(it.grammar || 'N/A');
            const collocRaw = (it.collocations || '').split(/,|ØŒ/).map(s => s.trim()).filter(Boolean);
            const tagsRaw = (it.tags || '').split(';').map(s=>s.trim()).filter(Boolean);
            const examplesHTML = (it.exampleslist || []).map(ex => {
                const splitAt = ex.lastIndexOf(' - ');
                let original = ex.slice(ex.indexOf('.') + 1).trim();
                let trans = '';
                if (splitAt > 1) {
                    original = ex.slice(ex.indexOf('.') + 1, splitAt).trim();
                    trans = ex.slice(splitAt + 3).trim();
                }
                return `<li><div class="flex items-center gap-2"><p>${escapeHTML(original)}</p><button class="btn btn-ghost p-2" onclick="speakText(event,'${original.replace(/'/g, "\\'")}', '${tts}')" title="${strings.speakSentence}">ğŸ”Š</button></div>${trans ? `<p class="text-sm muted">${escapeHTML(trans)}</p>`:''}</li>`;
            }).join('');
            return `<div class="ring-card">
              <div class="card result-item">
                <div class="result-header flex justify-between items-center p-4" onclick="toggleDetails(${idx})">
                  <div class="min-w-0"><div class="flex items-center gap-2 flex-wrap"><h3 class="text-xl font-extrabold text-[var(--primary-600)] truncate">${word||strings.wordNotFound}</h3>${grammar&&grammar!=='N/A'?`<span class="chip"><span class="dot" style="background:${tagPalette(idx)}"></span>${grammar}</span>`:''}</div><p class="mt-1 muted">${translation}</p></div>
                  <div class="flex items-center gap-2"><button class="btn btn-ghost p-2.5" onclick="speakText(event,'${word.replace(/'/g,"\\'")}', '${tts}')" title="${strings.speakWord}">ğŸ”Š</button><span id="chevron-${idx}" class="text-xl transition-transform">â–¾</span></div>
                </div>
                <div id="details-${idx}" class="result-details"><div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 pt-2">
                  <div><div class="flex items-center gap-2 mb-2"><span>ğŸ“˜</span><strong>${strings.definition}:</strong></div><p>${escapeHTML(it.definition||'N/A')}</p></div>
                  <div><div class="flex items-center gap-2 mb-2"><span>ğŸ—£ï¸</span><strong>${strings.pronunciation}:</strong></div><p>${escapeHTML(it.pronunciation||'N/A')}</p></div>
                  <div class="md:col-span-2"><div class="flex items-center gap-2 mb-2"><span>ğŸ”—</span><strong>${strings.collocations}:</strong></div><div class="flex flex-wrap gap-2">${collocRaw.length?collocRaw.map((c,i)=>`<span class="chip" style="background: color-mix(in oklab, ${tagPalette(i)} 60%, transparent)">${escapeHTML(c)}</span>`).join(''):`<span class="text-sm muted">${strings.notApplicable||'â€”'}</span>`}</div></div>
                  <div class="md:col-span-2"><div class="flex items-center gap-2 mb-2"><span>âœï¸</span><strong>${strings.examples}:</strong></div><ul class="space-y-3 pl-4 pr-4">${examplesHTML}</ul></div>
                  <div><div class="flex items-center gap-2 mb-2"><span>âš ï¸</span><strong>${strings.commonMistakes}:</strong></div><p>${escapeHTML(it.commonmistakes||'N/A')}</p></div>
                  <div><div class="flex items-center gap-2 mb-2"><span>ğŸ’¡</span><strong>${strings.contextNote}:</strong></div><p>${(it.contextnote||'').replace(/\n/g,'<br>')}</p></div>
                </div></div>
              </div></div>`;
        }).join('');
    }

    function toggleDetails(i){
      const d=document.getElementById(`details-${i}`); const c=document.getElementById(`chevron-${i}`);
      d.classList.toggle('open'); if(c)c.style.transform=d.classList.contains('open')?'rotate(180deg)':'rotate(0deg)';
    }
    function toggleAll(open){
      document.querySelectorAll('.result-details').forEach((d,idx)=>{
        const c=document.getElementById(`chevron-${idx}`);
        d.classList.toggle('open',open); if(c)c.style.transform=open?'rotate(180deg)':'rotate(0deg)';
      });
    }

    // i18n â€” ØªØ±Ø¬Ù…Ù‡â€ŒÛŒ Ú©Ø§Ù…Ù„ UI Ø¨Ø±Ø§ÛŒ 9 Ø²Ø¨Ø§Ù†
    let currentLang='fa';
    const uiStrings = {
      fa:{appTitle:"ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ø²Ø¨Ø§Ù† Ø¨Ø§ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ",mainTitle:"Ø³Ø§Ø²Ù†Ø¯Ù‡ ÙˆØ§Ú˜Ú¯Ø§Ù† Ù‡ÙˆØ´Ù…Ù†Ø¯",headerSubtitle:"ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ Ø¨Ø§ Ú©Ù…Ú© Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ",subtitle:"Ø²Ø¨Ø§Ù†â€ŒÙ‡Ø§ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ØŒ Ù…ØªÙ† ÛŒØ§ ÙÙ‡Ø±Ø³Øª ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§ Ø±Ø§ Ø¨Ø¯Ù‡Ø› Ø¨Ù‚ÛŒÙ‡â€ŒØ§Ø´ Ø¨Ø§ Ù…Ø§ âœ¨",sourceLangLabel:"Ø²Ø¨Ø§Ù† Ù…Ø§Ø¯Ø±ÛŒ Ù…Ù†",targetLangLabel:"Ø²Ø¨Ø§Ù†ÛŒ Ú©Ù‡ ÛŒØ§Ø¯ Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ù…",userLevelLabel:"Ø³Ø·Ø­ Ù…Ù†",forceWordlistLabel:"Ø§ÛŒÙ† ÛŒÚ© Ù„ÛŒØ³Øª ÙˆØ§Ú˜Ù‡ Ø§Ø³Øª",hintStatic:"<p class='font-semibold mb-1'>Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ:</p><ul class='list-disc pr-4 space-y-1'><li>Ø§Ú¯Ø± <b>Ù„ÛŒØ³Øª Ú©Ù„Ù…Ø§Øª</b> Ø¯Ø§Ø±ÛŒØ¯: Ù‡Ø± Ø®Ø· ÛŒÚ© Ú©Ù„Ù…Ù‡/Ø¹Ø¨Ø§Ø±Øª Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯ ÛŒØ§ Ø¨Ø§ <code>-</code> Ø¬Ø¯Ø§ Ú©Ù†ÛŒØ¯. <b>Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ø·Ø­ Ù†ÛŒØ³Øª</b>.</li><li>Ø§Ú¯Ø± <b>Ù…ØªÙ† ÛŒØ§ ÙØ§ÛŒÙ„</b> Ø¯Ø§Ø±ÛŒØ¯: Ø³Ø·Ø­â€ŒØªØ§Ù† Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ Ú©Ù„Ù…Ø§ØªØŒ Ø§ØµØ·Ù„Ø§Ø­Ø§Øª Ùˆ Ø¬Ù…Ù„Ø§Øª Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ <b>Ù…ØªÙ†Ø§Ø³Ø¨ Ø¨Ø§ Ø³Ø·Ø­ Ø´Ù…Ø§</b> Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´ÙˆØ¯.</li></ul>",uploadBtnText:"Ø¢Ù¾Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ (.txt, .srt)",processBtn:"ØªØ­Ù„ÛŒÙ„ Ú©Ù†",resultsTitle:"Ù†ØªØ§ÛŒØ¬ ØªØ­Ù„ÛŒÙ„",startOverBtn:"Ø´Ø±ÙˆØ¹ Ø¯ÙˆØ¨Ø§Ø±Ù‡",expandAll:"Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡",collapseAll:"Ø¨Ø³ØªÙ† Ù‡Ù…Ù‡",errorText:"Ù„Ø·ÙØ§Ù‹ ÙˆØ±ÙˆØ¯ÛŒ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ ÛŒØ§ Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.",errorLevel:"Ø¨Ø±Ø§ÛŒ Ù…ØªÙ†â€ŒÙ‡Ø§/ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ù„Ø·ÙØ§Ù‹ Ø³Ø·Ø­ Ø®ÙˆØ¯ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯.",errorAIResponse:"Ù¾Ø§Ø³Ø® Ù…Ø¹ØªØ¨Ø±ÛŒ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù†Ø´Ø¯.",errorServer:"Ù…Ø´Ú©Ù„ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ø±ÙˆØ±. Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.",errorNoResults:"Ù…ÙˆØ±Ø¯ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.",wordNotFound:"Ú©Ù„Ù…Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯",definition:"ØªØ¹Ø±ÛŒÙ",grammar:"Ú¯Ø±Ø§Ù…Ø±",collocations:"ØªØ±Ú©ÛŒØ¨â€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒØ¬",examples:"Ù…Ø«Ø§Ù„â€ŒÙ‡Ø§",commonMistakes:"Ø§Ø´ØªØ¨Ø§Ù‡Ø§Øª Ø±Ø§ÛŒØ¬",contextNote:"Ù†Ú©ØªÙ‡",pronunciation:"ØªÙ„ÙØ¸",notApplicable:"â€”",tags:"Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§",speakWord:"Ø´Ù†ÛŒØ¯Ù† ÙˆØ§Ú˜Ù‡",speakSentence:"Ø´Ù†ÛŒØ¯Ù† Ø¬Ù…Ù„Ù‡",stopSpeech:"ØªÙˆÙ‚Ù Ú¯ÙØªØ§Ø±",footerLine1:"Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ Ù‡Ù…Ú©Ø§Ø±ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ", footerLine2:`Ø³Ø§Ø²Ù†Ø¯Ù‡: <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`, textPlaceholder:"Ù„ÛŒØ³Øª Ú©Ù„Ù…Ø§Øª Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ù…ØªÙ†/ÙØ§ÛŒÙ„ Ø±Ø§ Paste Ú©Ù†ÛŒØ¯â€¦", dropHint:"Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ú©Ù„Ù…Ø§Øª Ø±Ø§ ØªØ§ÛŒÙ¾ Ú©Ù†ÛŒØ¯ ÛŒØ§ ÙØ§ÛŒÙ„ .txt/.srt Ø±Ø§ Ø¨Ú©Ø´ÛŒØ¯ Ùˆ Ø±Ù‡Ø§ Ú©Ù†ÛŒØ¯.",modeWordlist:"Ø­Ø§Ù„Øª: Ù„ÛŒØ³Øª Ú©Ù„Ù…Ø§Øª",modeText:"Ø­Ø§Ù„Øª: Ù…ØªÙ†/ÙØ§ÛŒÙ„"},
      en:{appTitle:"AI Language Learner",mainTitle:"Smart Vocab Builder",headerSubtitle:"Practical learning with AI assistance",subtitle:"Pick languages, paste text or a word listâ€”AI does the rest âœ¨",sourceLangLabel:"My Native Language",targetLangLabel:"Language I'm Learning",userLevelLabel:"My Level",forceWordlistLabel:"This is a word list",hintStatic:"<p class='font-semibold mb-1'>Input Guide:</p><ul class='list-disc pl-4 space-y-1'><li>If you have a <b>word list</b>: one item per line or separated with <code>-</code>. <b>No level selection needed</b>.</li><li>If you have a <b>text or file</b>: pick your level so we extract vocabulary <b>matched to you</b>.</li></ul>",uploadBtnText:"Upload File (.txt, .srt)",processBtn:"Analyze",resultsTitle:"Analysis Results",startOverBtn:"Start Over",expandAll:"Expand All",collapseAll:"Collapse All",errorText:"Please enter or upload valid input.",errorLevel:"For texts/files, please select your level.",errorAIResponse:"No valid AI response.",errorServer:"Server connection issue.",errorNoResults:"No items found.",wordNotFound:"Word not found",definition:"Definition",grammar:"Grammar",collocations:"Collocations",examples:"Examples",commonMistakes:"Common Mistakes",contextNote:"Context/Note",pronunciation:"Pronunciation",notApplicable:"â€”",tags:"Tags",speakWord:"Speak word",speakSentence:"Speak sentence",stopSpeech:"Stop speech",footerLine1:"Built with AI collaboration", footerLine2:`Built by <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`, textPlaceholder:"Enter your word list here or paste a text/fileâ€¦", dropHint:"Type your words or drag & drop a .txt/.srt file.",modeWordlist:"Mode: Word list",modeText:"Mode: Text/File"},
      de:{appTitle:"KI-Sprachlerner",mainTitle:"Intelligenter Vokabeltrainer",headerSubtitle:"Praktisches Lernen mit KI-UnterstÃ¼tzung",subtitle:"Sprachen wÃ¤hlen, Text oder Wortliste einfÃ¼gen â€“ den Rest Ã¼bernimmt die KI âœ¨",sourceLangLabel:"Meine Muttersprache",targetLangLabel:"Sprache, die ich lerne",userLevelLabel:"Mein Niveau",forceWordlistLabel:"Dies ist eine Wortliste",hintStatic:"<p class='font-semibold mb-1'>Eingabehinweise:</p><ul class='list-disc pl-4 space-y-1'><li>Bei einer <b>Wortliste</b>: ein Eintrag pro Zeile oder mit <code>-</code> trennen. <b>Kein Niveau nÃ¶tig</b>.</li><li>Bei <b>Text/Datei</b>: wÃ¤hle dein Niveau, damit passende Vokabeln extrahiert werden.</li></ul>",uploadBtnText:"Datei hochladen (.txt, .srt)",processBtn:"Analysieren",resultsTitle:"Analyseergebnisse",startOverBtn:"Neu starten",expandAll:"Alle Ã¶ffnen",collapseAll:"Alle schlieÃŸen",errorText:"Bitte gÃ¼ltige Eingabe eingeben oder hochladen.",errorLevel:"Bitte bei Text/Datei ein Niveau wÃ¤hlen.",errorAIResponse:"Keine gÃ¼ltige KI-Antwort.",errorServer:"Serververbindungsproblem.",errorNoResults:"Keine EintrÃ¤ge gefunden.",wordNotFound:"Wort nicht gefunden",definition:"Definition",grammar:"Grammatik",collocations:"Kollokationen",examples:"Beispiele",commonMistakes:"HÃ¤ufige Fehler",contextNote:"Hinweis",pronunciation:"Aussprache",notApplicable:"â€”",tags:"Tags",speakWord:"Wort vorlesen",speakSentence:"Satz vorlesen",stopSpeech:"Sprachausgabe stoppen",footerLine1:"Erstellt mit KI-UnterstÃ¼tzung", footerLine2:`Erstellt von <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`, textPlaceholder:"FÃ¼ge hier deine Wortliste oder einen Text einâ€¦", dropHint:"WÃ¶rter eingeben oder .txt/.srt per Drag & Drop.",modeWordlist:"Modus: Wortliste",modeText:"Modus: Text/Datei"},
      fr:{appTitle:"Apprenant de langues IA",mainTitle:"GÃ©nÃ©rateur de vocabulaire intelligent",headerSubtitle:"Apprentissage pratique assistÃ© par IA",subtitle:"Choisissez les langues, collez un texte ou une liste â€” lâ€™IA fait le reste âœ¨",sourceLangLabel:"Ma langue maternelle",targetLangLabel:"Langue que jâ€™apprends",userLevelLabel:"Mon niveau",forceWordlistLabel:"Ceci est une liste de mots",hintStatic:"<p class='font-semibold mb-1'>Guide de saisie :</p><ul class='list-disc pl-4 space-y-1'><li>Avec une <b>liste de mots</b> : un Ã©lÃ©ment par ligne ou sÃ©parÃ©s par <code>-</code>. <b>Pas besoin de niveau</b>.</li><li>Avec un <b>texte/fichier</b> : choisissez votre niveau pour extraire un vocabulaire <b>adaptÃ©</b>.</li></ul>",uploadBtnText:"TÃ©lÃ©verser un fichier (.txt, .srt)",processBtn:"Analyser",resultsTitle:"RÃ©sultats de lâ€™analyse",startOverBtn:"Recommencer",expandAll:"Tout dÃ©plier",collapseAll:"Tout replier",errorText:"Veuillez saisir ou tÃ©lÃ©verser une entrÃ©e valide.",errorLevel:"Pour les textes/fichiers, choisissez votre niveau.",errorAIResponse:"Aucune rÃ©ponse IA valide.",errorServer:"ProblÃ¨me de connexion serveur.",errorNoResults:"Aucun Ã©lÃ©ment trouvÃ©.",wordNotFound:"Mot introuvable",definition:"DÃ©finition",grammar:"Grammaire",collocations:"Collocations",examples:"Exemples",commonMistakes:"Erreurs courantes",contextNote:"Contexte/Note",pronunciation:"Prononciation",notApplicable:"â€”",tags:"Ã‰tiquettes",speakWord:"Prononcer le mot",speakSentence:"Prononcer la phrase",stopSpeech:"ArrÃªter la voix",footerLine1:"CrÃ©Ã© avec lâ€™aide de lâ€™IA", footerLine2:`CrÃ©Ã© par <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`, textPlaceholder:"Entrez votre liste de mots ou collez un texte/fichierâ€¦", dropHint:"Saisissez des mots ou glissez-dÃ©posez un .txt/.srt.",modeWordlist:"Mode : liste de mots",modeText:"Mode : texte/fichier"},
      es:{appTitle:"Aprendiz de idiomas con IA",mainTitle:"Constructor de vocabulario inteligente",headerSubtitle:"Aprendizaje prÃ¡ctico con ayuda de IA",subtitle:"Elige idiomas, pega texto o una lista â€” la IA hace el resto âœ¨",sourceLangLabel:"Mi lengua materna",targetLangLabel:"Idioma que estoy aprendiendo",userLevelLabel:"Mi nivel",forceWordlistLabel:"Esto es una lista de palabras",hintStatic:"<p class='font-semibold mb-1'>GuÃ­a de entrada:</p><ul class='list-disc pl-4 space-y-1'><li>Con una <b>lista de palabras</b>: un elemento por lÃ­nea o separado con <code>-</code>. <b>No hace falta nivel</b>.</li><li>Con <b>texto/archivo</b>: elige tu nivel para extraer vocabulario <b>adecuado</b>.</li></ul>",uploadBtnText:"Subir archivo (.txt, .srt)",processBtn:"Analizar",resultsTitle:"Resultados del anÃ¡lisis",startOverBtn:"Empezar de nuevo",expandAll:"Expandir todo",collapseAll:"Contraer todo",errorText:"Introduce o sube una entrada vÃ¡lida.",errorLevel:"Para textos/archivos, elige tu nivel.",errorAIResponse:"Respuesta de IA no vÃ¡lida.",errorServer:"Problema de conexiÃ³n con el servidor.",errorNoResults:"No se encontraron elementos.",wordNotFound:"Palabra no encontrada",definition:"DefiniciÃ³n",grammar:"GramÃ¡tica",collocations:"Colocaciones",examples:"Ejemplos",commonMistakes:"Errores comunes",contextNote:"Contexto/Nota",pronunciation:"PronunciaciÃ³n",notApplicable:"â€”",tags:"Etiquetas",speakWord:"Pronunciar palabra",speakSentence:"Pronunciar frase",stopSpeech:"Detener voz",footerLine1:"Creado con ayuda de IA", footerLine2:`Creado por <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`, textPlaceholder:"Introduce tu lista o pega un texto/archivoâ€¦", dropHint:"Escribe palabras o arrastra un .txt/.srt.",modeWordlist:"Modo: lista de palabras",modeText:"Modo: texto/archivo"},
      zh:{appTitle:"AI è¯­è¨€å­¦ä¹ åŠ©æ‰‹",mainTitle:"æ™ºèƒ½è¯æ±‡ç”Ÿæˆå™¨",headerSubtitle:"åœ¨ AI çš„å¸®åŠ©ä¸‹é«˜æ•ˆå­¦ä¹ ",subtitle:"é€‰æ‹©è¯­è¨€ï¼Œç²˜è´´æ–‡æœ¬æˆ–è¯è¡¨â€”â€”å…¶ä½™äº¤ç»™ AI âœ¨",sourceLangLabel:"æ¯è¯­",targetLangLabel:"æ­£åœ¨å­¦ä¹ çš„è¯­è¨€",userLevelLabel:"æˆ‘çš„æ°´å¹³",forceWordlistLabel:"è¿™æ˜¯ä¸€ä¸ªè¯è¡¨",hintStatic:"<p class='font-semibold mb-1'>è¾“å…¥æŒ‡å—ï¼š</p><ul class='list-disc pl-4 space-y-1'><li>å¦‚æœæ˜¯<b>è¯è¡¨</b>ï¼šæ¯è¡Œä¸€ä¸ªè¯/çŸ­è¯­ï¼Œæˆ–ç”¨ <code>-</code> åˆ†éš”ã€‚<b>æ— éœ€é€‰æ‹©æ°´å¹³</b>ã€‚</li><li>å¦‚æœæ˜¯<b>æ–‡æœ¬/æ–‡ä»¶</b>ï¼šé€‰æ‹©ä½ çš„æ°´å¹³ï¼Œä»¥æå–<b>é€‚åˆä½ </b>çš„è¯æ±‡ã€‚</li></ul>",uploadBtnText:"ä¸Šä¼ æ–‡ä»¶ (.txt, .srt)",processBtn:"åˆ†æ",resultsTitle:"åˆ†æç»“æœ",startOverBtn:"é‡æ–°å¼€å§‹",expandAll:"å…¨éƒ¨å±•å¼€",collapseAll:"å…¨éƒ¨æ”¶èµ·",errorText:"è¯·è¾“å…¥æˆ–ä¸Šä¼ æœ‰æ•ˆå†…å®¹ã€‚",errorLevel:"æ–‡æœ¬/æ–‡ä»¶è¯·å…ˆé€‰æ‹©æ°´å¹³ã€‚",errorAIResponse:"æœªè·å¾—æœ‰æ•ˆçš„ AI å“åº”ã€‚",errorServer:"æœåŠ¡å™¨è¿æ¥é—®é¢˜ã€‚",errorNoResults:"æœªæ‰¾åˆ°ä»»ä½•æ¡ç›®ã€‚",wordNotFound:"æœªæ‰¾åˆ°è¯è¯­",definition:"å®šä¹‰",grammar:"è¯­æ³•",collocations:"æ­é…",examples:"ä¾‹å¥",commonMistakes:"å¸¸è§é”™è¯¯",contextNote:"æ³¨é‡Š",pronunciation:"å‘éŸ³",notApplicable:"â€”",tags:"æ ‡ç­¾",speakWord:"æœ—è¯»å•è¯",speakSentence:"æœ—è¯»å¥å­",stopSpeech:"åœæ­¢æœ—è¯»",footerLine1:"åœ¨ AI ååŠ©ä¸‹æ„å»º", footerLine2:`ç”± <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a> æ„å»º`, textPlaceholder:"åœ¨æ­¤è¾“å…¥è¯è¡¨æˆ–ç²˜è´´æ–‡æœ¬/æ–‡ä»¶â€¦", dropHint:"è¾“å…¥è¯è¯­æˆ–æ‹–æ‹½ .txt/.srt æ–‡ä»¶ã€‚",modeWordlist:"æ¨¡å¼ï¼šè¯è¡¨",modeText:"æ¨¡å¼ï¼šæ–‡æœ¬/æ–‡ä»¶"},
      tr:{appTitle:"YZ Dil Ã–ÄŸrenici",mainTitle:"AkÄ±llÄ± Kelime OluÅŸturucu",headerSubtitle:"YZ desteÄŸiyle pratik Ã¶ÄŸrenme",subtitle:"Dilleri seÃ§, metni ya da kelime listesini yapÄ±ÅŸtÄ±r â€” gerisini YZ halleder âœ¨",sourceLangLabel:"Anadilim",targetLangLabel:"Ã–ÄŸrendiÄŸim dil",userLevelLabel:"Seviyem",forceWordlistLabel:"Bu bir kelime listesi",hintStatic:"<p class='font-semibold mb-1'>Girdi rehberi:</p><ul class='list-disc pl-4 space-y-1'><li><b>Kelime listesi</b> iÃ§in: satÄ±r baÅŸÄ±na bir Ã¶ÄŸe veya <code>-</code> ile ayÄ±rÄ±n. <b>Seviye gerekmez</b>.</li><li><b>Metin/dosya</b> iÃ§in: seviyeni seÃ§ ki sana <b>uygun</b> kelimeler Ã§Ä±karÄ±lsÄ±n.</li></ul>",uploadBtnText:"Dosya yÃ¼kle (.txt, .srt)",processBtn:"Analiz et",resultsTitle:"Analiz SonuÃ§larÄ±",startOverBtn:"BaÅŸtan baÅŸla",expandAll:"TÃ¼mÃ¼nÃ¼ aÃ§",collapseAll:"TÃ¼mÃ¼nÃ¼ kapat",errorText:"LÃ¼tfen geÃ§erli bir girdi girin veya yÃ¼kleyin.",errorLevel:"Metin/dosya iÃ§in lÃ¼tfen seviyeni seÃ§.",errorAIResponse:"GeÃ§erli bir YZ yanÄ±tÄ± yok.",errorServer:"Sunucu baÄŸlantÄ± sorunu.",errorNoResults:"Ã–ÄŸe bulunamadÄ±.",wordNotFound:"Kelime bulunamadÄ±",definition:"TanÄ±m",grammar:"Dilbilgisi",collocations:"SÄ±klÄ±kla kullanÄ±lan birliktelikler",examples:"Ã–rnekler",commonMistakes:"YaygÄ±n hatalar",contextNote:"BaÄŸlam/Not",pronunciation:"Telaffuz",notApplicable:"â€”",tags:"Etiketler",speakWord:"Kelimeyi oku",speakSentence:"CÃ¼mleyi oku",stopSpeech:"Sesi durdur",footerLine1:"YZ desteÄŸiyle oluÅŸturuldu", footerLine2:`OluÅŸturan: <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`, textPlaceholder:"Kelime listesini buraya gir veya metin/dosya yapÄ±ÅŸtÄ±râ€¦", dropHint:"Kelimeleri yaz veya .txt/.srt sÃ¼rÃ¼kle-bÄ±rak.",modeWordlist:"Mod: Kelime listesi",modeText:"Mod: Metin/Dosya"},
      it:{appTitle:"Apprendimento lingue con IA",mainTitle:"Generatore intelligente di vocabolario",headerSubtitle:"Apprendimento pratico con lâ€™aiuto dellâ€™IA",subtitle:"Scegli le lingue, incolla un testo o una lista â€” al resto pensa lâ€™IA âœ¨",sourceLangLabel:"Lingua madre",targetLangLabel:"Lingua che sto imparando",userLevelLabel:"Il mio livello",forceWordlistLabel:"Questa Ã¨ una lista di parole",hintStatic:"<p class='font-semibold mb-1'>Guida allâ€™input:</p><ul class='list-disc pl-4 space-y-1'><li>Con una <b>lista di parole</b>: un elemento per riga o separati con <code>-</code>. <b>Nessun livello necessario</b>.</li><li>Con <b>testo/file</b>: scegli il tuo livello per estrarre vocabolario <b>adatto a te</b>.</li></ul>",uploadBtnText:"Carica file (.txt, .srt)",processBtn:"Analizza",resultsTitle:"Risultati dellâ€™analisi",startOverBtn:"Ricomincia",expandAll:"Espandi tutto",collapseAll:"Comprimi tutto",errorText:"Inserisci o carica un input valido.",errorLevel:"Per testi/file seleziona il livello.",errorAIResponse:"Nessuna risposta valida dellâ€™IA.",errorServer:"Problema di connessione al server.",errorNoResults:"Nessun elemento trovato.",wordNotFound:"Parola non trovata",definition:"Definizione",grammar:"Grammatica",collocations:"Collocazioni",examples:"Esempi",commonMistakes:"Errori comuni",contextNote:"Contesto/Nota",pronunciation:"Pronuncia",notApplicable:"â€”",tags:"Tag",speakWord:"Pronuncia parola",speakSentence:"Pronuncia frase",stopSpeech:"Ferma voce",footerLine1:"Creato con lâ€™aiuto dellâ€™IA", footerLine2:`Creato da <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`, textPlaceholder:"Inserisci qui la lista o incolla un testo/fileâ€¦", dropHint:"Scrivi parole o trascina .txt/.srt.",modeWordlist:"ModalitÃ : lista",modeText:"ModalitÃ : testo/file"},
      ru:{appTitle:"Ğ˜Ğ·ÑƒÑ‡ĞµĞ½Ğ¸Ğµ ÑĞ·Ñ‹ĞºĞ¾Ğ² Ñ Ğ˜Ğ˜",mainTitle:"Ğ£Ğ¼Ğ½Ñ‹Ğ¹ ÑĞ»Ğ¾Ğ²Ğ°Ñ€Ğ½Ñ‹Ğ¹ Ñ‚Ñ€ĞµĞ½Ğ°Ğ¶Ñ‘Ñ€",headerSubtitle:"ĞŸÑ€Ğ°ĞºÑ‚Ğ¸Ñ‡Ğ½Ğ¾Ğµ Ğ¾Ğ±ÑƒÑ‡ĞµĞ½Ğ¸Ğµ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ¸ Ğ˜Ğ˜",subtitle:"Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑĞ·Ñ‹ĞºĞ¸, Ğ²ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ¸Ğ»Ğ¸ ÑĞ¿Ğ¸ÑĞ¾Ğº â€” Ğ´Ğ°Ğ»ÑŒÑˆĞµ Ğ²ÑÑ‘ ÑĞ´ĞµĞ»Ğ°ĞµÑ‚ Ğ˜Ğ˜ âœ¨",sourceLangLabel:"ĞœĞ¾Ğ¹ Ñ€Ğ¾Ğ´Ğ½Ğ¾Ğ¹ ÑĞ·Ñ‹Ğº",targetLangLabel:"Ğ¯Ğ·Ñ‹Ğº, ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğ¹ Ñ Ğ¸Ğ·ÑƒÑ‡Ğ°Ñ",userLevelLabel:"ĞœĞ¾Ğ¹ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ",forceWordlistLabel:"Ğ­Ñ‚Ğ¾ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞ»Ğ¾Ğ²",hintStatic:"<p class='font-semibold mb-1'>ĞŸĞ¾Ğ´ÑĞºĞ°Ğ·ĞºĞ¸ Ğ¿Ğ¾ Ğ²Ğ²Ğ¾Ğ´Ñƒ:</p><ul class='list-disc pl-4 space-y-1'><li>Ğ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ <b>ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞ»Ğ¾Ğ²</b>: Ğ¿Ğ¾ Ğ¾Ğ´Ğ½Ğ¾Ğ¼Ñƒ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ñƒ Ğ² ÑÑ‚Ñ€Ğ¾ĞºĞµ Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ·Ğ´ĞµĞ»ÑĞ¹Ñ‚Ğµ <code>-</code>. <b>Ğ£Ñ€Ğ¾Ğ²ĞµĞ½ÑŒ Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°Ñ‚ÑŒ Ğ½Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾</b>.</li><li>Ğ•ÑĞ»Ğ¸ ÑÑ‚Ğ¾ <b>Ñ‚ĞµĞºÑÑ‚/Ñ„Ğ°Ğ¹Ğ»</b>: Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ²Ğ»ĞµÑ‡ÑŒ <b>Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´ÑÑ‰ÑƒÑ</b> Ğ»ĞµĞºÑĞ¸ĞºÑƒ.</li></ul>",uploadBtnText:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ„Ğ°Ğ¹Ğ» (.txt, .srt)",processBtn:"ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ",resultsTitle:"Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ñ‹ Ğ°Ğ½Ğ°Ğ»Ğ¸Ğ·Ğ°",startOverBtn:"ĞĞ°Ñ‡Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ½Ğ¾Ğ²Ğ¾",expandAll:"Ğ Ğ°ÑĞºÑ€Ñ‹Ñ‚ÑŒ Ğ²ÑÑ‘",collapseAll:"Ğ¡Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ²ÑÑ‘",errorText:"Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ¸Ğ»Ğ¸ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚Ğµ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ñ‹Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ.",errorLevel:"Ğ”Ğ»Ñ Ñ‚ĞµĞºÑÑ‚Ğ°/Ñ„Ğ°Ğ¹Ğ»Ğ° Ğ²Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ ÑƒÑ€Ğ¾Ğ²ĞµĞ½ÑŒ.",errorAIResponse:"ĞĞµÑ‚ ĞºĞ¾Ñ€Ñ€ĞµĞºÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ° Ğ˜Ğ˜.",errorServer:"ĞŸÑ€Ğ¾Ğ±Ğ»ĞµĞ¼Ğ° ÑĞ¾ĞµĞ´Ğ¸Ğ½ĞµĞ½Ğ¸Ñ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼.",errorNoResults:"ĞĞ¸Ñ‡ĞµĞ³Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾.",wordNotFound:"Ğ¡Ğ»Ğ¾Ğ²Ğ¾ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ¾",definition:"ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ğ¸Ğµ",grammar:"Ğ“Ñ€Ğ°Ğ¼Ğ¼Ğ°Ñ‚Ğ¸ĞºĞ°",collocations:"ĞšĞ¾Ğ»Ğ»Ğ¾ĞºĞ°Ñ†Ğ¸Ğ¸",examples:"ĞŸÑ€Ğ¸Ğ¼ĞµÑ€Ñ‹",commonMistakes:"Ğ¢Ğ¸Ğ¿Ğ¸Ñ‡Ğ½Ñ‹Ğµ Ğ¾ÑˆĞ¸Ğ±ĞºĞ¸",contextNote:"ĞšĞ¾Ğ½Ñ‚ĞµĞºÑÑ‚/Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ°",pronunciation:"ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ğµ",notApplicable:"â€”",tags:"Ğ¢ĞµĞ³Ğ¸",speakWord:"ĞĞ·Ğ²ÑƒÑ‡Ğ¸Ñ‚ÑŒ ÑĞ»Ğ¾Ğ²Ğ¾",speakSentence:"ĞĞ·Ğ²ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ñ€ĞµĞ´Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ",stopSpeech:"ĞÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Ğ¾Ğ·Ğ²ÑƒÑ‡ĞºÑƒ",footerLine1:"Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¾ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞµ Ğ˜Ğ˜", footerLine2:`ĞĞ²Ñ‚Ğ¾Ñ€: <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`, textPlaceholder:"Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞ»Ğ¾Ğ² Ğ¸Ğ»Ğ¸ Ğ²ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚/Ñ„Ğ°Ğ¹Ğ»â€¦", dropHint:"Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ÑĞ»Ğ¾Ğ²Ğ° Ğ¸Ğ»Ğ¸ Ğ¿ĞµÑ€ĞµÑ‚Ğ°Ñ‰Ğ¸Ñ‚Ğµ .txt/.srt.",modeWordlist:"Ğ ĞµĞ¶Ğ¸Ğ¼: ÑĞ¿Ğ¸ÑĞ¾Ğº ÑĞ»Ğ¾Ğ²",modeText:"Ğ ĞµĞ¶Ğ¸Ğ¼: Ñ‚ĞµĞºÑÑ‚/Ñ„Ğ°Ğ¹Ğ»"},
    };

    function setLanguage(lang){
      currentLang = lang;
      const s = uiStrings[lang] || uiStrings.en;
      const isRtl = RTL_LANGS.has(lang);
      document.documentElement.lang = lang;
      document.documentElement.dir = isRtl ? 'rtl' : 'ltr';

      // Ù…ØªÙˆÙ† Ø«Ø§Ø¨Øª
      const map = {
        'app-title': s.appTitle,
        'main-title': s.mainTitle,
        'header-subtitle': s.headerSubtitle,
        'subtitle': s.subtitle,
        'source-lang-label': s.sourceLangLabel,
        'target-lang-label': s.targetLangLabel,
        'user-level-label': s.userLevelLabel,
        'force-wordlist-label': s.forceWordlistLabel,
        'upload-btn-text': s.uploadBtnText,
        'results-title': s.resultsTitle,
        'start-over-btn': s.startOverBtn,
        'drop-hint-text': s.dropHint
      };
      for(const id in map){
        const el = document.getElementById(id);
        if(!el) continue;
        // hint HTML Ø§Ø³ØªØŒ Ø¨Ù‚ÛŒÙ‡ Ù…ØªÙ† Ø³Ø§Ø¯Ù‡
        if(id==='app-title' || id==='results-title' || id==='start-over-btn'){
          el.textContent = map[id];
        } else if(id==='upload-btn-text' || id==='drop-hint-text' || id==='force-wordlist-label' || id==='source-lang-label' || id==='target-lang-label' || id==='user-level-label' || id==='subtitle' || id==='main-title' || id==='header-subtitle'){
          el.textContent = map[id];
        }
      }
      // hint Ø¬Ø¯Ø§ Ú†ÙˆÙ† HTML Ø¯Ø§Ø±Ø¯
      const hintEl = document.getElementById('hint');
      hintEl.innerHTML = s.hintStatic;

      document.title = s.appTitle;
      document.querySelector('#process-btn > span').textContent = s.processBtn;
      document.getElementById('expand-all').textContent = `â¬‡ï¸ ${s.expandAll}`;
      document.getElementById('collapse-all').textContent = `â¬†ï¸ ${s.collapseAll}`;
      document.getElementById('stop-tts').title = s.stopSpeech;
      document.getElementById('to-top').title = (lang==='fa') ? 'Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¨Ø§Ù„Ø§' : (lang==='ru'?'ĞĞ°Ğ²ĞµÑ€Ñ…':(lang==='tr'?'BaÅŸa dÃ¶n':(lang==='de'?'Nach oben':(lang==='fr'?'Haut de page':(lang==='es'?'Volver arriba':(lang==='it'?'Torna su':(lang==='zh'?'å›åˆ°é¡¶éƒ¨':'Back to top')))))));

      // Ø³Ø·Ø­â€ŒÙ‡Ø§ (Ø¨Ø±Ø§ÛŒ Ø³Ø§Ø¯Ú¯ÛŒ: en Ù…ØªÙ† Ø¯Ø§Ø®Ù„ value Ù…ÛŒâ€ŒÙ…Ø§Ù†Ø¯Ø› labelâ€ŒÙ‡Ø§ ØªØ±Ø¬Ù…Ù‡ Ù†Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ Ú†ÙˆÙ† CEFR)
      document.getElementById('level-unspecified').textContent = (lang==='fa') ? 'Ø§Ù†ØªØ®Ø§Ø¨ Ù†Ø´Ø¯Ù‡' : (lang==='ru'?'ĞĞµ ÑƒĞºĞ°Ğ·Ğ°Ğ½Ğ¾':(lang==='tr'?'Belirtilmedi':(lang==='de'?'Nicht festgelegt':(lang==='fr'?'Non spÃ©cifiÃ©':(lang==='es'?'Sin especificar':(lang==='it'?'Non specificato':(lang==='zh'?'æœªæŒ‡å®š':'Unspecified')))))));

      document.getElementById('text-input').placeholder = s.textPlaceholder;
      document.getElementById('footer-text-line1').innerHTML = s.footerLine1;
      document.getElementById('footer-text-line2').innerHTML = s.footerLine2;

      updateModeBadge();
    }

    // ===== INIT
    document.addEventListener('DOMContentLoaded', ()=> {
      // Populate selects once
      [uiLangSwitcher, sourceLangSelect, targetLangSelect].forEach(sel => {
        sel.innerHTML = LANGS.map(l => `<option value="${l.code}">${l.label}</option>`).join('');
      });
      // Set defaults
      const lang = localStorage.getItem('ll-lang') || 'fa';
      setLanguage(lang);
      uiLangSwitcher.value = lang;
      sourceLangSelect.value = 'fa';
      targetLangSelect.value = 'en';
      updateModeBadge();
    });
  </script>
</body>
</html>
