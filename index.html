<!DOCTYPE html>
<!-- The lang and dir attributes will be set by JavaScript -->
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="app-title">یادگیری زبان با هوش مصنوعی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f7fafc;
            color: #2d3748;
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        select, input[type="text"], textarea, input[type="file"] {
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
            transition: box-shadow 0.2s ease-in-out;
        }
        select:focus, input[type="text"]:focus, textarea:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.5);
            border-color: #4299e1;
        }
        .result-item {
            border: 1px solid #e2e8f0;
            border-radius: 0.75rem;
            margin-bottom: 1rem;
            overflow: hidden;
        }
        .result-header {
            cursor: pointer;
            padding: 1rem;
            background-color: #f7fafc;
            transition: background-color 0.2s;
        }
        .result-header:hover {
            background-color: #edf2f7;
        }
        .result-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            padding: 0 1.5rem;
        }
        .result-details.open {
            max-height: 1200px; /* Increased for content */
            padding: 1.5rem;
        }
        .speak-btn {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .speak-btn:hover {
            transform: scale(1.1);
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #4a90e2;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Style for drag-and-drop area */
        .drop-zone {
            border: 2px dashed #e2e8f0;
            transition: border-color 0.3s, background-color 0.3s;
        }
        .drag-over {
            border-color: #4299e1;
            background-color: #ebf8ff;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- Language Switcher -->
    <div class="max-w-4xl mx-auto mb-4 flex justify-end">
        <select id="ui-lang-switcher" class="p-2 bg-white">
            <option value="fa">فارسی</option>
            <option value="en">English</option>
            <option value="de">Deutsch</option>
            <option value="fr">Français</option>
            <option value="es">Español</option>
            <option value="zh">中文</option>
            <option value="tr">Türkçe</option>
            <option value="it">Italiano</option>
            <option value="ru">Русский</option>
        </select>
    </div>

    <div id="app-container" class="max-w-4xl mx-auto">
        <!-- Setup View -->
        <div id="setup-view" class="card p-6 md:p-8">
            <div class="text-center mb-8">
                <h1 id="main-title" class="text-3xl md:text-4xl font-bold text-gray-800">سازنده واژگان هوشمند</h1>
                <p id="subtitle" class="text-gray-600 mt-2">زبان مورد نظر خود را انتخاب کرده و متن خود را برای تحلیل وارد کنید.</p>
            </div>

            <!-- Language & Level Selection -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label id="source-lang-label" for="source-lang" class="block text-sm font-medium text-gray-700 mb-1">زبان مادری من</label>
                    <select id="source-lang" class="w-full p-2">
                        <option value="Persian">فارسی</option>
                        <option value="English">English</option>
                        <option value="German">Deutsch</option>
                        <option value="French">Français</option>
                        <option value="Spanish">Español</option>
                        <option value="Chinese">中文</option>
                        <option value="Turkish">Türkçe</option>
                        <option value="Italian">Italiano</option>
                        <option value="Russian">Русский</option>
                    </select>
                </div>
                <div>
                    <label id="target-lang-label" for="target-lang" class="block text-sm font-medium text-gray-700 mb-1">زبانی که یاد می‌گیرم</label>
                    <select id="target-lang" class="w-full p-2">
                        <option value="English">English</option>
                        <option value="German">Deutsch</option>
                        <option value="French">Français</option>
                        <option value="Spanish">Español</option>
                        <option value="Persian">فارسی</option>
                        <option value="Chinese">中文</option>
                        <option value="Turkish">Türkçe</option>
                        <option value="Italian">Italiano</option>
                        <option value="Russian">Русский</option>
                    </select>
                </div>
                <div>
                    <label id="user-level-label" for="user-level" class="block text-sm font-medium text-gray-700 mb-1">سطح من</label>
                    <select id="user-level" class="w-full p-2">
                        <option value="Unspecified" id="level-unspecified">انتخاب نشده</option>
                        <option value="A1 (Beginner)" id="level-a1">A1 (مبتدی)</option>
                        <option value="A2 (Elementary)" id="level-a2">A2 (ابتدایی)</option>
                        <option value="B1 (Intermediate)" id="level-b1">B1 (متوسط)</option>
                        <option value="B2 (Upper-Intermediate)" id="level-b2">B2 (فوق متوسط)</option>
                        <option value="C1 (Advanced)" id="level-c1">C1 (پیشرفته)</option>
                    </select>
                </div>
            </div>

            <!-- Input Area with Drag and Drop -->
            <div id="drop-zone" class="drop-zone p-4 rounded-lg">
                <textarea id="text-input" rows="10" class="w-full p-3"></textarea>
                <div class="flex justify-between items-center mt-4">
                    <div class="flex items-center gap-2">
                       <label for="file-upload" class="bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-300 rounded-lg shadow-sm cursor-pointer">
                           <span id="upload-btn-text">آپلود فایل (.txt, .srt)</span>
                       </label>
                       <input id="file-upload" type="file" class="hidden" accept=".txt,.srt">
                       <span id="file-name" class="text-sm text-gray-500"></span>
                    </div>
                    <button id="process-btn" class="bg-blue-600 text-white font-bold py-2 px-8 rounded-lg hover:bg-blue-700 transition-colors shadow-md">
                        تحلیل کن
                    </button>
                </div>
                 <p id="error-msg" class="text-red-500 text-sm mt-2 text-center hidden"></p>
            </div>
        </div>

        <!-- Results View -->
        <div id="results-view" class="hidden mt-8">
            <div class="flex justify-between items-center mb-6">
                <h2 id="results-title" class="text-2xl md:text-3xl font-bold text-gray-800">نتایج تحلیل</h2>
                <button id="start-over-btn" class="bg-gray-200 text-gray-800 font-bold py-2 px-6 rounded-lg hover:bg-gray-300 transition-colors">
                    شروع دوباره
                </button>
            </div>
            <div id="loader" class="flex justify-center items-center p-16 hidden"><div class="loader"></div></div>
            <div id="results-list" class="card"></div>
        </div>
    </div>

<script>
    // --- تنظیمات برنامه ---
    const PROXY_URL = 'https://language-learner.qaderi.workers.dev/';

    // --- دسترسی به عناصر صفحه ---
    const setupView = document.getElementById('setup-view');
    const resultsView = document.getElementById('results-view');
    const processBtn = document.getElementById('process-btn');
    const startOverBtn = document.getElementById('start-over-btn');
    const textInput = document.getElementById('text-input');
    const fileUpload = document.getElementById('file-upload');
    const fileNameEl = document.getElementById('file-name');
    const errorMsg = document.getElementById('error-msg');
    const userLevelSelect = document.getElementById('user-level');
    const sourceLangSelect = document.getElementById('source-lang');
    const targetLangSelect = document.getElementById('target-lang');
    const loader = document.getElementById('loader');
    const resultsList = document.getElementById('results-list');
    const uiLangSwitcher = document.getElementById('ui-lang-switcher');
    const dropZone = document.getElementById('drop-zone');


    // --- رویدادها ---
    processBtn.addEventListener('click', handleProcessRequest);
    startOverBtn.addEventListener('click', () => {
        resultsView.classList.add('hidden');
        setupView.classList.remove('hidden');
        textInput.value = '';
        fileUpload.value = '';
        fileNameEl.textContent = '';
        resultsList.innerHTML = '';
    });

    fileUpload.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            handleFile(file);
        }
    });

    // --- Drag and Drop Events ---
    dropZone.addEventListener('dragover', (event) => {
        event.preventDefault();
        dropZone.classList.add('drag-over');
    });

    dropZone.addEventListener('dragleave', () => {
        dropZone.classList.remove('drag-over');
    });

    dropZone.addEventListener('drop', (event) => {
        event.preventDefault();
        dropZone.classList.remove('drag-over');
        const file = event.dataTransfer.files[0];
        if (file) {
            handleFile(file);
        }
    });
    
    // --- Language Switcher Event ---
    uiLangSwitcher.addEventListener('change', (event) => {
        setLanguage(event.target.value);
    });


    // --- توابع اصلی ---
    function handleFile(file) {
        if (file.type === "text/plain" || file.name.endsWith('.srt')) {
            fileNameEl.textContent = file.name;
            const reader = new FileReader();
            reader.onload = (e) => {
                textInput.value = e.target.result;
            };
            reader.readAsText(file);
        } else {
            fileNameEl.textContent = "File not supported";
        }
    }


    function handleProcessRequest() {
        const text = textInput.value.trim();
        const level = userLevelSelect.value;

        if (text.length > 200 && level === 'Unspecified') {
            showError(uiStrings[currentLang].errorLevel);
            return;
        }
        
        if (!text) {
            showError(uiStrings[currentLang].errorText);
            return;
        }

        hideError();
        setupView.classList.add('hidden');
        resultsView.classList.remove('hidden');
        loader.classList.remove('hidden');
        resultsList.innerHTML = '';

        callAI(text);
    }

    function buildPrompt(text) {
        const sourceLang = sourceLangSelect.value;
        const targetLang = targetLangSelect.value;
        const level = userLevelSelect.value;
        
        const isWordList = text.split(/\s+/).length < 30 && !text.includes('\n\n');
        
        let taskDescription;
        if (isWordList) {
            taskDescription = `For EACH word/phrase in the following list: "${text}", provide a detailed analysis.`;
        } else {
            taskDescription = `Analyze the following text. Extract the most important and practical words, idioms, and common phrases that are suitable for a ${level} learner. For EACH item you extract, provide a detailed analysis.`;
        }

        return `
            You are an expert language tutor AI. Your goal is to help a user learn new vocabulary.
            The user's native language is ${sourceLang}. They are learning ${targetLang} at a ${level} proficiency level.

            TASK: ${taskDescription}

            For EACH item, provide the analysis in the following structured format EXACTLY. Use "---" as a separator between each item. Do not add any text before the first item or after the last item.

            Word: [The extracted word or phrase in ${targetLang}]
            Translation: [The translation in ${sourceLang}]
            Definition: [A simple definition in ${targetLang} suitable for a ${level} learner]
            Grammar: [Part of speech, e.g., noun, verb, adjective, idiom]
            Collocations: [Common word combinations, or "N/A"]
            Examples:
            1. [Example 1 in ${targetLang}] - [Translation of Example 1 in ${sourceLang}]
            2. [Example 2 in ${targetLang}] - [Translation of Example 2 in ${sourceLang}]
            Common Mistakes: [Common mistakes or "nothing specific"]
            Context/Note: [Extra notes on usage, formality, etc., or "N/A"]
            ---
            
            ${isWordList ? '' : `Here is the text to analyze:\n\n${text}`}
        `;
    }

    async function callAI(text) {
        const prompt = buildPrompt(text);
        
        try {
            const response = await fetch(PROXY_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ prompt: prompt })
            });

            if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);

            const data = await response.json();
            
            if (data.candidates && data.candidates[0].content.parts[0].text) {
                const aiResponse = data.candidates[0].content.parts[0].text;
                renderResults(aiResponse);
            } else {
                 resultsList.innerHTML = `<p class="text-center p-8 text-red-500">${data?.error?.message || uiStrings[currentLang].errorAIResponse}</p>`;
            }

        } catch (error) {
            console.error("AI Call Error:", error);
            resultsList.innerHTML = `<p class="text-center p-8 text-red-500">${uiStrings[currentLang].errorServer}</p>`;
        } finally {
            loader.classList.add('hidden');
        }
    }

    function parseAIResponse(responseText) {
         const items = responseText.split('---').filter(item => item.trim() !== '');
        return items.map(itemText => {
            const lines = itemText.trim().split('\n');
            const data = {};
            let currentKey = '';
            lines.forEach(line => {
                const parts = line.split(':');
                if (parts.length > 1) {
                    const key = parts[0].trim().toLowerCase().replace(/ /g, '');
                    data[key] = parts.slice(1).join(':').trim();
                    currentKey = key;
                } else if (currentKey === 'examples' && line.trim().match(/^\d+\./)) {
                    if(!data.exampleslist) data.exampleslist = [];
                    data.exampleslist.push(line.trim());
                }
            });
            return data;
        });
    }

    function renderResults(aiResponse) {
        const parsedData = parseAIResponse(aiResponse);
        const lang = currentLang;
        const isRtl = lang === 'fa';

        resultsList.dir = isRtl ? 'rtl' : 'ltr';

        if (parsedData.length === 0 || parsedData.some(item => !item.word)) {
            resultsList.innerHTML = `<p class="text-center p-8 text-gray-600">${uiStrings[lang].errorNoResults}</p>`;
            return;
        }

        let html = '<div class="p-4 md:p-6 space-y-4">';
        const listPaddingClass = isRtl ? 'pr-6' : 'pl-6';

        parsedData.forEach((item, index) => {
            const targetLangCode = getLangCode(targetLangSelect.value);

            html += `
                <div class="result-item">
                    <div class="result-header flex justify-between items-center" onclick="toggleDetails(${index})">
                        <div>
                            <h3 class="text-lg font-bold text-blue-700">${item.word || uiStrings[lang].wordNotFound}</h3>
                            <p class="text-md text-gray-700">${item.translation || ''}</p>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="speak-btn text-2xl" onclick="speakText(event, '${item.word ? item.word.replace(/'/g, "\\'") : ''}', '${targetLangCode}')">🔊</span>
                            <span id="chevron-${index}" class="text-2xl transition-transform">▼</span>
                        </div>
                    </div>
                    <div id="details-${index}" class="result-details bg-white border-t border-gray-200 space-y-4">
                        <div>
                            <strong>${uiStrings[lang].definition}:</strong>
                            <p class="mt-1 text-gray-800">${item.definition || 'N/A'}</p>
                        </div>
                        <div>
                            <strong>${uiStrings[lang].grammar}:</strong>
                            <p class="mt-1 text-gray-800">${item.grammar || 'N/A'}</p>
                        </div>
                        <div>
                            <strong>${uiStrings[lang].collocations}:</strong>
                            <p class="mt-1 text-gray-800">${item.collocations || 'N/A'}</p>
                        </div>
                        <div>
                            <strong>${uiStrings[lang].examples}:</strong>
                            <ul class="list-disc ${listPaddingClass} mt-1 space-y-2">
                                ${ (item.exampleslist || []).map(ex => {
                                    const parts = ex.split(' - ');
                                    const original = parts[0].substring(parts[0].indexOf('.') + 1).trim();
                                    const translation = parts[1] || '';
                                    return `<li>
                                                <div class="flex items-center gap-2">
                                                    <span>${original}</span>
                                                    <span class="speak-btn text-lg" onclick="speakText(event, '${original.replace(/'/g, "\\'")}', '${targetLangCode}')">🔊</span>
                                                </div>
                                                <p class="text-sm text-gray-500">${translation}</p>
                                            </li>`;
                                }).join('')}
                            </ul>
                        </div>
                         <div>
                            <strong>${uiStrings[lang].commonMistakes}:</strong>
                            <p class="mt-1 text-gray-800">${item.commonmistakes || 'N/A'}</p>
                        </div>
                        <div>
                            <strong>${uiStrings[lang].contextNote}:</strong>
                            <p class="mt-1 text-gray-800">${item.contextnote || 'N/A'}</p>
                        </div>
                    </div>
                </div>`;
        });
        html += '</div>';
        resultsList.innerHTML = html;
    }
    
    // --- توابع کمکی ---

    function speakText(event, text, langCode) {
        event.stopPropagation(); 
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = langCode;
        speechSynthesis.speak(utterance);
    }
    
    function getLangCode(langName) {
        const codes = { 'English': 'en-US', 'German': 'de-DE', 'French': 'fr-FR', 'Spanish': 'es-ES', 'Italian': 'it-IT', 'Russian': 'ru-RU', 'Turkish': 'tr-TR', 'Chinese': 'zh-CN', 'Persian': 'fa-IR' };
        return codes[langName] || 'en-US';
    }

    function toggleDetails(index) {
        const details = document.getElementById(`details-${index}`);
        const chevron = document.getElementById(`chevron-${index}`);
        details.classList.toggle('open');
        chevron.style.transform = details.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
    }

    function showError(message) {
        errorMsg.textContent = message;
        errorMsg.classList.remove('hidden');
    }

    function hideError() {
        errorMsg.classList.add('hidden');
    }

    // --- Internationalization (i18n) ---
    let currentLang = 'fa';
    const uiStrings = {
        fa: {
            appTitle: "یادگیری زبان با هوش مصنوعی",
            mainTitle: "سازنده واژگان هوشمند",
            subtitle: "زبان مورد نظر خود را انتخاب کرده و متن خود را برای تحلیل وارد کنید.",
            sourceLangLabel: "زبان مادری من",
            targetLangLabel: "زبانی که یاد می‌گیرم",
            userLevelLabel: "سطح من",
            levelUnspecified: "انتخاب نشده",
            levelA1: "A1 (مبتدی)",
            levelA2: "A2 (ابتدایی)",
            levelB1: "B1 (متوسط)",
            levelB2: "B2 (فوق متوسط)",
            levelC1: "C1 (پیشرفته)",
            textPlaceholder: "لیست کلمات خود را اینجا وارد کنید، یا یک متن طولانی برای تحلیل جای‌گذاری کنید...",
            uploadBtnText: "آپلود فایل (.txt, .srt)",
            processBtn: "تحلیل کن",
            resultsTitle: "نتایج تحلیل",
            startOverBtn: "شروع دوباره",
            errorLevel: "برای تحلیل متن‌های طولانی، لطفاً سطح زبان خود را انتخاب کنید تا واژگان متناسب با سطح شما استخراج شود.",
            errorText: "لطفاً متنی را برای تحلیل وارد یا آپلود کنید.",
            errorAIResponse: "پاسخ معتبری از هوش مصنوعی دریافت نشد.",
            errorServer: "مشکلی در ارتباط با سرور پیش آمد. لطفاً دوباره تلاش کنید.",
            errorNoResults: "هوش مصنوعی موردی متناسب با درخواست شما پیدا نکرد. لطفاً متن دیگری را امتحان کنید.",
            wordNotFound: "کلمه یافت نشد",
            definition: "تعریف",
            grammar: "نوع گرامر",
            collocations: "ترکیب‌های رایج",
            examples: "مثال‌ها",
            commonMistakes: "اشتباهات رایج",
            contextNote: "نکته",
        },
        en: {
            appTitle: "AI Language Learner",
            mainTitle: "Smart Vocabulary Builder",
            subtitle: "Select your languages and enter text to analyze.",
            sourceLangLabel: "My Native Language",
            targetLangLabel: "Language I'm Learning",
            userLevelLabel: "My Level",
            levelUnspecified: "Unspecified",
            levelA1: "A1 (Beginner)",
            levelA2: "A2 (Elementary)",
            levelB1: "B1 (Intermediate)",
            levelB2: "B2 (Upper-Intermediate)",
            levelC1: "C1 (Advanced)",
            textPlaceholder: "Enter your word list here, or paste a long text to analyze...",
            uploadBtnText: "Upload File (.txt, .srt)",
            processBtn: "Analyze",
            resultsTitle: "Analysis Results",
            startOverBtn: "Start Over",
            errorLevel: "For long texts, please select your proficiency level to extract suitable vocabulary.",
            errorText: "Please enter or upload some text to analyze.",
            errorAIResponse: "No valid response from AI.",
            errorServer: "A problem occurred connecting to the server. Please try again.",
            errorNoResults: "The AI did not find any items matching your request. Please try another text.",
            wordNotFound: "Word not found",
            definition: "Definition",
            grammar: "Grammar",
            collocations: "Collocations",
            examples: "Examples",
            commonMistakes: "Common Mistakes",
            contextNote: "Context/Note",
        },
        de: {
            appTitle: "KI-Sprachlerner",
            mainTitle: "Intelligenter Vokabeltrainer",
            subtitle: "Wählen Sie Ihre Sprachen aus und geben Sie Text zur Analyse ein.",
            sourceLangLabel: "Meine Muttersprache",
            targetLangLabel: "Sprache, die ich lerne",
            userLevelLabel: "Mein Niveau",
            levelUnspecified: "Nicht angegeben",
            levelA1: "A1 (Anfänger)",
            levelA2: "A2 (Grundlegend)",
            levelB1: "B1 (Mittelstufe)",
            levelB2: "B2 (Obere Mittelstufe)",
            levelC1: "C1 (Fortgeschritten)",
            textPlaceholder: "Geben Sie hier Ihre Wortliste ein oder fügen Sie einen langen Text zur Analyse ein...",
            uploadBtnText: "Datei hochladen (.txt, .srt)",
            processBtn: "Analysieren",
            resultsTitle: "Analyseergebnisse",
            startOverBtn: "Neu anfangen",
            errorLevel: "Für lange Texte wählen Sie bitte Ihr Sprachniveau, um passendes Vokabular zu extrahieren.",
            errorText: "Bitte geben Sie Text zur Analyse ein oder laden Sie ihn hoch.",
            errorAIResponse: "Keine gültige Antwort von der KI.",
            errorServer: "Problem bei der Verbindung zum Server. Bitte versuchen Sie es erneut.",
            errorNoResults: "Die KI hat keine passenden Elemente gefunden. Bitte versuchen Sie einen anderen Text.",
            wordNotFound: "Wort nicht gefunden",
            definition: "Definition",
            grammar: "Grammatik",
            collocations: "Kollokationen",
            examples: "Beispiele",
            commonMistakes: "Häufige Fehler",
            contextNote: "Kontext/Notiz",
        },
        fr: {
            appTitle: "Apprentissage des langues par l'IA",
            mainTitle: "Constructeur de vocabulaire intelligent",
            subtitle: "Sélectionnez vos langues et entrez du texte à analyser.",
            sourceLangLabel: "Ma langue maternelle",
            targetLangLabel: "Langue que j'apprends",
            userLevelLabel: "Mon niveau",
            levelUnspecified: "Non spécifié",
            levelA1: "A1 (Débutant)",
            levelA2: "A2 (Élémentaire)",
            levelB1: "B1 (Intermédiaire)",
            levelB2: "B2 (Intermédiaire supérieur)",
            levelC1: "C1 (Avancé)",
            textPlaceholder: "Entrez votre liste de mots ici, ou collez un long texte à analyser...",
            uploadBtnText: "Télécharger un fichier (.txt, .srt)",
            processBtn: "Analyser",
            resultsTitle: "Résultats de l'analyse",
            startOverBtn: "Recommencer",
            errorLevel: "Pour les textes longs, veuillez sélectionner votre niveau pour extraire le vocabulaire approprié.",
            errorText: "Veuillez saisir ou télécharger du texte à analyser.",
            errorAIResponse: "Aucune réponse valide de l'IA.",
            errorServer: "Un problème est survenu lors de la connexion au serveur. Veuillez réessayer.",
            errorNoResults: "L'IA n'a trouvé aucun élément correspondant. Veuillez essayer un autre texte.",
            wordNotFound: "Mot non trouvé",
            definition: "Définition",
            grammar: "Grammaire",
            collocations: "Collocations",
            examples: "Exemples",
            commonMistakes: "Erreurs courantes",
            contextNote: "Contexte/Note",
        },
        es: {
            appTitle: "Aprendizaje de idiomas con IA",
            mainTitle: "Constructor de vocabulario inteligente",
            subtitle: "Seleccione sus idiomas e ingrese texto para analizar.",
            sourceLangLabel: "Mi lengua materna",
            targetLangLabel: "Idioma que estoy aprendiendo",
            userLevelLabel: "Mi nivel",
            levelUnspecified: "No especificado",
            levelA1: "A1 (Principiante)",
            levelA2: "A2 (Elemental)",
            levelB1: "B1 (Intermedio)",
            levelB2: "B2 (Intermedio alto)",
            levelC1: "C1 (Avanzado)",
            textPlaceholder: "Ingrese su lista de palabras aquí, o pegue un texto largo para analizar...",
            uploadBtnText: "Subir archivo (.txt, .srt)",
            processBtn: "Analizar",
            resultsTitle: "Resultados del análisis",
            startOverBtn: "Empezar de nuevo",
            errorLevel: "Para textos largos, seleccione su nivel para extraer el vocabulario adecuado.",
            errorText: "Por favor, ingrese o suba un texto para analizar.",
            errorAIResponse: "No hay respuesta válida de la IA.",
            errorServer: "Ocurrió un problema al conectarse al servidor. Por favor, inténtelo de nuevo.",
            errorNoResults: "La IA no encontró ningún elemento coincidente. Por favor, intente con otro texto.",
            wordNotFound: "Palabra no encontrada",
            definition: "Definición",
            grammar: "Gramática",
            collocations: "Colocaciones",
            examples: "Ejemplos",
            commonMistakes: "Errores comunes",
            contextNote: "Contexto/Nota",
        },
        zh: {
            appTitle: "人工智能语言学习器",
            mainTitle: "智能词汇构建器",
            subtitle: "选择您的语言并输入文本进行分析。",
            sourceLangLabel: "我的母语",
            targetLangLabel: "我正在学习的语言",
            userLevelLabel: "我的水平",
            levelUnspecified: "未指定",
            levelA1: "A1 (初学者)",
            levelA2: "A2 (初级)",
            levelB1: "B1 (中级)",
            levelB2: "B2 (中高级)",
            levelC1: "C1 (高级)",
            textPlaceholder: "在此处输入您的单词列表，或粘贴长文本进行分析...",
            uploadBtnText: "上传文件 (.txt, .srt)",
            processBtn: "分析",
            resultsTitle: "分析结果",
            startOverBtn: "重新开始",
            errorLevel: "对于长文本，请选择您的水平以便提取合适的词汇。",
            errorText: "请输入或上传一些文本进行分析。",
            errorAIResponse: "AI无有效响应。",
            errorServer: "连接服务器时出现问题。请再试一次。",
            errorNoResults: "AI未找到任何匹配项。请尝试其他文本。",
            wordNotFound: "未找到单词",
            definition: "定义",
            grammar: "语法",
            collocations: "搭配",
            examples: "例子",
            commonMistakes: "常见错误",
            contextNote: "语境/说明",
        },
        tr: {
            appTitle: "Yapay Zeka ile Dil Öğrenimi",
            mainTitle: "Akıllı Kelime Oluşturucu",
            subtitle: "Dillerinizi seçin ve analiz etmek için metin girin.",
            sourceLangLabel: "Ana Dilim",
            targetLangLabel: "Öğrendiğim Dil",
            userLevelLabel: "Seviyem",
            levelUnspecified: "Belirtilmemiş",
            levelA1: "A1 (Başlangıç)",
            levelA2: "A2 (Temel)",
            levelB1: "B1 (Orta)",
            levelB2: "B2 (Orta-üstü)",
            levelC1: "C1 (İleri)",
            textPlaceholder: "Kelime listenizi buraya girin veya analiz için uzun bir metin yapıştırın...",
            uploadBtnText: "Dosya Yükle (.txt, .srt)",
            processBtn: "Analiz Et",
            resultsTitle: "Analiz Sonuçları",
            startOverBtn: "Yeniden Başla",
            errorLevel: "Uzun metinler için uygun kelimeleri çıkarmak üzere lütfen seviyenizi seçin.",
            errorText: "Lütfen analiz için bir metin girin veya yükleyin.",
            errorAIResponse: "Yapay zekadan geçerli bir yanıt alınamadı.",
            errorServer: "Sunucuya bağlanırken bir sorun oluştu. Lütfen tekrar deneyin.",
            errorNoResults: "Yapay zeka isteğinizle eşleşen bir öğe bulamadı. Lütfen başka bir metin deneyin.",
            wordNotFound: "Kelime bulunamadı",
            definition: "Tanım",
            grammar: "Gramer",
            collocations: "Birlikte Kullanımlar",
            examples: "Örnekler",
            commonMistakes: "Yaygın Hatalar",
            contextNote: "Bağlam/Not",
        },
        it: {
            appTitle: "Apprendimento delle lingue con IA",
            mainTitle: "Costruttore di vocabolario intelligente",
            subtitle: "Seleziona le tue lingue e inserisci il testo da analizzare.",
            sourceLangLabel: "La mia lingua madre",
            targetLangLabel: "Lingua che sto imparando",
            userLevelLabel: "Il mio livello",
            levelUnspecified: "Non specificato",
            levelA1: "A1 (Principiante)",
            levelA2: "A2 (Elementare)",
            levelB1: "B1 (Intermedio)",
            levelB2: "B2 (Intermedio-superiore)",
            levelC1: "C1 (Avanzato)",
            textPlaceholder: "Inserisci qui la tua lista di parole, o incolla un testo lungo da analizzare...",
            uploadBtnText: "Carica File (.txt, .srt)",
            processBtn: "Analizza",
            resultsTitle: "Risultati dell'analisi",
            startOverBtn: "Ricomincia",
            errorLevel: "Per testi lunghi, seleziona il tuo livello per estrarre il vocabolario appropriato.",
            errorText: "Inserisci o carica un testo da analizzare.",
            errorAIResponse: "Nessuna risposta valida dall'IA.",
            errorServer: "Si è verificato un problema durante la connessione al server. Riprova.",
            errorNoResults: "L'IA non ha trovato elementi corrispondenti. Prova con un altro testo.",
            wordNotFound: "Parola non trovata",
            definition: "Definizione",
            grammar: "Grammatica",
            collocations: "Collocazioni",
            examples: "Esempi",
            commonMistakes: "Errori comuni",
            contextNote: "Contesto/Nota",
        },
        ru: {
            appTitle: "Изучение языков с ИИ",
            mainTitle: "Умный конструктор словарного запаса",
            subtitle: "Выберите языки и введите текст для анализа.",
            sourceLangLabel: "Мой родной язык",
            targetLangLabel: "Язык, который я изучаю",
            userLevelLabel: "Мой уровень",
            levelUnspecified: "Не указан",
            levelA1: "A1 (Начинающий)",
            levelA2: "A2 (Элементарный)",
            levelB1: "B1 (Средний)",
            levelB2: "B2 (Выше среднего)",
            levelC1: "C1 (Продвинутый)",
            textPlaceholder: "Введите свой список слов здесь или вставьте длинный текст для анализа...",
            uploadBtnText: "Загрузить файл (.txt, .srt)",
            processBtn: "Анализировать",
            resultsTitle: "Результаты анализа",
            startOverBtn: "Начать сначала",
            errorLevel: "Для длинных текстов, пожалуйста, выберите свой уровень для извлечения подходящей лексики.",
            errorText: "Пожалуйста, введите или загрузите текст для анализа.",
            errorAIResponse: "Нет действительного ответа от ИИ.",
            errorServer: "Возникла проблема с подключением к серверу. Пожалуйста, попробуйте еще раз.",
            errorNoResults: "ИИ не нашел совпадений. Пожалуйста, попробуйте другой текст.",
            wordNotFound: "Слово не найдено",
            definition: "Определение",
            grammar: "Грамматика",
            collocations: "Словосочетания",
            examples: "Примеры",
            commonMistakes: "Частые ошибки",
            contextNote: "Контекст/Примечание",
        },
    };

    function setLanguage(lang) {
        currentLang = lang;
        const strings = uiStrings[lang];
        const isRtl = lang === 'fa';
        
        document.documentElement.lang = lang;
        document.documentElement.dir = isRtl ? 'rtl' : 'ltr';

        document.getElementById('app-title').textContent = strings.appTitle;
        document.getElementById('main-title').textContent = strings.mainTitle;
        document.getElementById('subtitle').textContent = strings.subtitle;
        document.getElementById('source-lang-label').textContent = strings.sourceLangLabel;
        document.getElementById('target-lang-label').textContent = strings.targetLangLabel;
        document.getElementById('user-level-label').textContent = strings.userLevelLabel;
        document.getElementById('level-unspecified').textContent = strings.levelUnspecified;
        document.getElementById('level-a1').textContent = strings.levelA1;
        document.getElementById('level-a2').textContent = strings.levelA2;
        document.getElementById('level-b1').textContent = strings.levelB1;
        document.getElementById('level-b2').textContent = strings.levelB2;
        document.getElementById('level-c1').textContent = strings.levelC1;
        document.getElementById('text-input').placeholder = strings.textPlaceholder;
        document.getElementById('upload-btn-text').textContent = strings.uploadBtnText;
        document.getElementById('process-btn').textContent = strings.processBtn;
        document.getElementById('results-title').textContent = strings.resultsTitle;
        document.getElementById('start-over-btn').textContent = strings.startOverBtn;
    }

    // Initialize with default language
    document.addEventListener('DOMContentLoaded', () => {
        setLanguage('fa');
    });

</script>

</body>
</html>

