<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="app-title">یادگیری زبان با هوش مصنوعی</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #3b82f6;
      --primary-hover: #2563eb;
      --card-bg: rgba(255, 255, 255, 0.75);
      --border-color: rgba(0, 0, 0, 0.08);
      --shadow-color: rgba(50, 50, 93, 0.1);
      --text-main: #1f2937;
      --text-light: #4b5563;
    }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Vazirmatn', sans-serif;
      background-color: #f9fafb;
      background-image:
        radial-gradient(circle at 12% 18%, rgb(215, 227, 255) 0%, transparent 42%),
        radial-gradient(circle at 88% 85%, rgb(253, 224, 235) 0%, transparent 45%);
      color: var(--text-main);
    }
    .glass {
      backdrop-filter: saturate(180%) blur(12px);
      background: rgba(255, 255, 255, 0.7);
      border-bottom: 1px solid var(--border-color);
    }
    .card {
      background: var(--card-bg);
      backdrop-filter: blur(20px);
      border-radius: 1.25rem;
      border: 1px solid var(--border-color);
      box-shadow: 0 10px 30px -10px var(--shadow-color);
    }
    .result-item {
      border: 1px solid var(--border-color);
      border-radius: 1rem;
      overflow: hidden;
      transition: all 0.3s ease;
      background: rgba(255,255,255,.9);
    }
    .result-item:hover { box-shadow: 0 8px 26px -10px rgba(2,6,23,.12); }
    .result-header {
      cursor: pointer;
      padding: 1rem 1.25rem;
      background: rgba(249, 250, 251, 0.6);
      transition: background 0.2s;
    }
    .result-header:hover { background: rgba(243, 244, 246, 0.85); }
    .result-details {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out, border-color 0.5s ease-in-out;
      padding: 0 1.5rem;
      border-top: 1px solid transparent;
    }
    .result-details.open {
      max-height: 1500px;
      padding: 1.25rem 1.5rem 1.5rem;
      border-top-color: var(--border-color);
    }
    .chip {
      display: inline-block;
      border-radius: 999px;
      border: 1px solid var(--border-color);
      padding: 0.18rem 0.6rem;
      font-size: 0.78rem;
      background: #fff;
      font-weight: 600;
    }
    .chip.tag { background: #f8fafc; }
    .tag-palette-1 { background:#eef2ff; border-color:#e0e7ff; }
    .tag-palette-2 { background:#ecfeff; border-color:#cffafe; }
    .tag-palette-3 { background:#fefce8; border-color:#fde68a; }
    .tag-palette-4 { background:#f0fdf4; border-color:#bbf7d0; }
    .tag-palette-5 { background:#fff7ed; border-color:#fed7aa; }
    .drop-zone { border: 2px dashed #d1d5db; border-radius: 1rem; transition: all 0.2s ease; }
    .drop-zone.drag-over { border-color: var(--primary-color); background: #eff6ff; }
    .btn {
      border-radius: 0.75rem;
      font-weight: 600;
      padding: 0.6rem 1.2rem;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      border: 1px solid transparent;
    }
    .btn-primary { background: var(--primary-color); color: #fff; border-color: var(--primary-color); box-shadow: 0 4px 14px -4px var(--primary-color); }
    .btn-primary:hover { background: var(--primary-hover); }
    .btn-secondary { background: #fff; color: var(--text-light); border-color: var(--border-color); }
    .btn-secondary:hover { background: #f9fafb; border-color: #d1d5db; }
    .loader {
      border: 5px solid #e5e7eb;
      border-top: 5px solid var(--primary-color);
      border-radius: 50%;
      width: 48px;
      height: 48px;
      animation: spin 1s linear infinite;
    }
    select, textarea {
        border: 1px solid var(--border-color);
        border-radius: 0.75rem;
        transition: box-shadow 0.2s;
        background: #fff;
    }
    select:focus, textarea:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.35);
        border-color: var(--primary-color);
    }
    .muted { color:#6b7280 }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body class="min-h-screen">
  <!-- Top bar -->
  <header class="sticky top-0 z-20 glass">
    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><path d="M12 2a3 3 0 0 0-3 3v4a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M12 18a3 3 0 0 0 3-3V9a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3Z"/><path d="M18 12a3 3 0 0 0-3-3V5a3 3 0 0 0-6 0v4a3 3 0 0 0 0 6v4a3 3 0 0 0 6 0v-4a3 3 0 0 0-3-3Z"/><path d="M6 12a3 3 0 0 0-3-3V5a3 3 0 0 0-3 3v4a3 3 0 0 0 3 3v4a3 3 0 0 0 3 3v-4a3 3 0 0 0-3-3Z"/></svg>
        <h1 id="main-title" class="text-xl md:text-2xl font-bold text-gray-800">سازنده واژگان هوشمند</h1>
      </div>
      <div class="flex items-center gap-2">
        <select id="ui-lang-switcher" class="px-2 py-1.5 bg-white rounded-lg border border-gray-200 text-sm">
          <option value="fa">فارسی</option><option value="en">English</option>
          <option value="de">Deutsch</option><option value="fr">Français</option>
          <option value="es">Español</option><option value="zh">中文</option>
          <option value="tr">Türkçe</option><option value="it">Italiano</option>
          <option value="ru">Русский</option>
        </select>
        <button id="stop-tts" class="btn btn-secondary p-2.5" title="توقف گفتار" aria-label="توقف گفتار">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
        </button>
      </div>
    </div>
  </header>

  <main class="max-w-6xl mx-auto p-4 md:p-8">
    <!-- Setup -->
    <section id="setup-view" class="card p-6 md:p-8">
      <p id="subtitle" class="text-gray-600 mb-6 text-lg">
        زبان مورد نظر خود را انتخاب کرده و متن یا فهرست واژه‌ها را وارد کنید.
      </p>

      <!-- selectors -->
      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
        <div>
          <label id="source-lang-label" class="block text-sm font-medium mb-1 text-gray-700">زبان مادری من</label>
          <select id="source-lang" class="w-full p-2.5">
            <option>Persian</option><option>English</option><option>German</option>
            <option>French</option><option>Spanish</option><option>Chinese</option>
            <option>Turkish</option><option>Italian</option><option>Russian</option>
          </select>
        </div>
        <div>
          <label id="target-lang-label" class="block text-sm font-medium mb-1 text-gray-700">زبانی که یاد می‌گیرم</label>
          <select id="target-lang" class="w-full p-2.5">
            <option>English</option><option>German</option><option>French</option>
            <option>Spanish</option><option>Persian</option><option>Chinese</option>
            <option>Turkish</option><option>Italian</option><option>Russian</option>
          </select>
        </div>
        <div>
          <label id="user-level-label" class="block text-sm font-medium mb-1 text-gray-700">سطح من (برای متن/فایل)</label>
          <select id="user-level" class="w-full p-2.5">
            <option id="level-unspecified" value="Unspecified">انتخاب نشده</option>
            <option id="level-a1" value="A1 (Beginner)">A1 (مبتدی)</option>
            <option id="level-a2" value="A2 (Elementary)">A2 (ابتدایی)</option>
            <option id="level-b1" value="B1 (Intermediate)">B1 (متوسط)</option>
            <option id="level-b2" value="B2 (Upper-Intermediate)">B2 (فوق متوسط)</option>
            <option id="level-c1" value="C1 (Advanced)">C1 (پیشرفته)</option>
          </select>
        </div>
        <div class="flex items-end">
          <label class="inline-flex items-center gap-2 cursor-pointer">
            <input id="force-wordlist" type="checkbox" class="w-4 h-4 rounded text-blue-600 focus:ring-blue-500">
            <span id="force-wordlist-label" class="text-sm">این ورودی یک لیست واژه است</span>
          </label>
        </div>
      </div>

      <!-- guidance -->
      <div id="hint-container" class="text-sm text-blue-800 bg-blue-50 border border-blue-200 rounded-xl p-4 mb-5">
        <span id="hint"></span>
      </div>

      <!-- input -->
      <div id="drop-zone" class="drop-zone p-4">
        <textarea id="text-input" rows="10" class="w-full p-3 bg-transparent focus:bg-white" placeholder=""></textarea>
        <div class="flex flex-col md:flex-row gap-3 md:items-center justify-between mt-4">
          <div class="flex items-center gap-2">
            <label for="file-upload" class="cursor-pointer btn btn-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
              <span id="upload-btn-text"></span>
            </label>
            <input id="file-upload" type="file" class="hidden" accept=".txt,.srt">
            <span id="file-name" class="text-sm text-gray-500"></span>
          </div>
          <button id="process-btn" class="btn btn-primary px-8 py-3 shadow-lg">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
            <span class="select-none"></span>
          </button>
        </div>
        <p id="error-msg" class="text-red-600 text-sm mt-3 text-center hidden"></p>
      </div>
    </section>

    <!-- Results -->
    <section id="results-view" class="hidden mt-10">
      <div class="flex flex-col md:flex-row gap-3 md:items-center justify-between mb-6">
        <h2 id="results-title" class="text-3xl md:text-4xl font-bold">نتایج تحلیل</h2>
        <div class="flex gap-2">
          <button id="expand-all" class="btn btn-secondary"></button>
          <button id="collapse-all" class="btn btn-secondary"></button>
          <button id="start-over-btn" class="btn btn-secondary"></button>
        </div>
      </div>
      <div id="loader" class="flex justify-center items-center p-16 hidden"><div class="loader"></div></div>
      <div id="results-list" class="space-y-4"></div>
    </section>
  </main>
 
  <footer class="text-center p-8 mt-8 text-gray-500 text-sm">
      <p id="footer-text">ساخته شده با همکاری هوش مصنوعی</p>
  </footer>

  <script>
    const PROXY_URL = 'https://language-learner.qaderi.workers.dev/';

    const setupView = document.getElementById('setup-view');
    const resultsView = document.getElementById('results-view');
    const processBtn = document.getElementById('process-btn');
    const startOverBtn = document.getElementById('start-over-btn');
    const textInput = document.getElementById('text-input');
    const fileUpload = document.getElementById('file-upload');
    const fileNameEl = document.getElementById('file-name');
    const errorMsg = document.getElementById('error-msg');
    const userLevelSelect = document.getElementById('user-level');
    const sourceLangSelect = document.getElementById('source-lang');
    const targetLangSelect = document.getElementById('target-lang');
    const loader = document.getElementById('loader');
    const resultsList = document.getElementById('results-list');
    const uiLangSwitcher = document.getElementById('ui-lang-switcher');
    const dropZone = document.getElementById('drop-zone');
    const stopTTSBtn = document.getElementById('stop-tts');
    const expandAllBtn = document.getElementById('expand-all');
    const collapseAllBtn = document.getElementById('collapse-all');
    const forceWordlist = document.getElementById('force-wordlist');
    const hint = document.getElementById('hint');

    // events
    processBtn.addEventListener('click', handleProcessRequest);
    startOverBtn.addEventListener('click', resetUI);
    expandAllBtn.addEventListener('click', () => toggleAll(true));
    collapseAllBtn.addEventListener('click', () => toggleAll(false));
    stopTTSBtn.addEventListener('click', () => speechSynthesis.cancel());

    fileUpload.addEventListener('change', (e) => {
      const f = e.target.files[0]; if (f) handleFile(f);
    });

    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
    dropZone.addEventListener('drop', (e) => {
      e.preventDefault(); dropZone.classList.remove('drag-over');
      const f = e.dataTransfer.files[0]; if (f) handleFile(f);
    });

    uiLangSwitcher.addEventListener('change', (e) => setLanguage(e.target.value));
    forceWordlist.addEventListener('change', syncLevelRequirement);
    textInput.addEventListener('input', syncLevelRequirement);

    function resetUI(){
      resultsView.classList.add('hidden');
      setupView.classList.remove('hidden');
      textInput.value=''; fileUpload.value=''; fileNameEl.textContent=''; resultsList.innerHTML='';
      hideError();
    }

    function handleFile(file){
      fileNameEl.textContent = file.name;
      const reader = new FileReader();
      reader.onload = (e) => {
        const raw = e.target.result || '';
        textInput.value = file.name.endsWith('.srt') ? cleanSRT(raw) : raw;
        syncLevelRequirement();
      };
      reader.readAsText(file);
    }

    function cleanSRT(s){
      return s
        .replace(/\uFEFF/g,'')
        .replace(/^\d+\s*$/gm,'')
        .replace(/\d{2}:\d{2}:\d{2},\d{3}\s+-->\s+\d{2}:\d{2}:\d{2},\d{3}.*/g,'')
        .replace(/<[^>]+>/g,'')
        .replace(/[^\S\r\n]+/g,' ')
        .replace(/\n{2,}/g,'\n')
        .trim();
    }

    function looksLikeWordList(text){
      const lines = text.split(/\r?\n/).filter(l=>l.trim()!=='');
      if (lines.length>=2 && lines.every(l=>l.trim().length<=40)) return true;
      const tokens = text.split(/\s*-\s*/).filter(t=>t.trim()!=='');
      if (tokens.length>=2 && tokens.every(t=>t.trim().length<=40)) return true;
      const wc = text.trim().split(/\s+/).length;
      return wc<30 && !text.includes('\n\n');
    }

    function syncLevelRequirement(){
      const t = textInput.value.trim();
      const fileAttached = !!fileUpload.files[0];
      const autoIsList = looksLikeWordList(t) && !fileAttached;
      const isList = forceWordlist.checked || autoIsList;
     
      if (isList){
        userLevelSelect.value='Unspecified';
        userLevelSelect.disabled = true;
        hint.innerHTML = '📝 حالت «لیست واژه»: هر خط یک واژه/عبارت یا با <b>-</b> جدا کنید. سطح لازم نیست.';
      }else{
        userLevelSelect.disabled = false;
        hint.innerHTML = '📚 حالت «متن/فایل»: لطفاً سطح خود را انتخاب کنید تا واژگان و عبارات مطابق سطح شما استخراج شوند.';
      }
    }

    function showError(m){ errorMsg.textContent=m; errorMsg.classList.remove('hidden'); }
    function hideError(){ errorMsg.classList.add('hidden'); }

    function handleProcessRequest(){
      const text = textInput.value.trim();
      const level = userLevelSelect.value;
      const fileAttached = !!fileUpload.files[0];
      const isList = forceWordlist.checked || (looksLikeWordList(text) && !fileAttached);

      if (!text){ showError(uiStrings[currentLang].errorText); return; }
      if (!isList && level==='Unspecified'){
        showError(uiStrings[currentLang].errorLevel); return;
      }

      hideError(); setupView.classList.add('hidden'); resultsView.classList.remove('hidden');
      loader.classList.remove('hidden'); resultsList.innerHTML='';
      callAI(text, isList);
    }

    function buildPrompt(text, isWordList){
      const sourceLang = sourceLangSelect.value;
      const targetLang = targetLangSelect.value;
      const level = userLevelSelect.value;

      const taskDesc = isWordList
        ? `You will analyze a USER-PROVIDED LIST of words/phrases in ${targetLang}. Items are either one per line or separated by hyphens "-". For EACH item, produce a full analysis.`
        : `You will analyze a LONG TEXT in ${targetLang}. Extract ALL useful, natural, everyday words, idioms, and set phrases appropriate for a ${level} learner. Do NOT limit the number of items—focus on practical usefulness. For EACH extracted item, produce a full analysis.`;

      const fieldSpec =
`For EACH item, output EXACTLY the following template. Use "---" as a separator between items.
Do NOT add any text before the first item or after the last item.

Word: [the item in ${targetLang}]
Translation: [translation in ${sourceLang}; if multiple common meanings, separate with ";"]
Definition: [simple, level-appropriate definition in ${targetLang}]
Grammar: [part of speech; optionally sub-features like "phrasal verb (inseparable)", "verb (takes Akkusativ)", "noun (countable)"]
Collocations: [common combinations, comma-separated; if truly none, write "N/A"]
Examples:
1. [Example 1 in ${targetLang}] - [${sourceLang} translation]
2. [Example 2 in ${targetLang}] - [${sourceLang} translation]
3. [Optional more examples...]
Common Mistakes: ["nothing specific" OR a concrete pitfall (wrong preposition, word order, false friend, article/case)]
Context/Note:
- Write 1–2 concise sentences covering at least ONE of the following (choose the most relevant):
  register/formality; synonym contrast and subtle meaning; required prepositions or case governance;
  language-specific behavior (e.g., separable verb; phrasal-verb type; aspect; measure word/classifier; vowel harmony; clitic placement; liaison; gender/article);
  fixed expression constraints; typical contexts/frequency; a short pronunciation tip if truly useful.
- Never output "N/A" for this field. If nothing obvious applies, write: "neutral register; general-use".
Pronunciation: [IPA/Pinyin/phonetic if applicable; else "N/A"]
Tags:
- Choose 1–3 tags from the controlled list below (AT LEAST ONE tag is required).
- Use lowercase; hyphen for multiword; separate with semicolons (e.g., "informal;phrasal-verb").
- Allowed: informal; formal; neutral; spoken; academic; business; travel; tech; slang;
  idiom; phrasal-verb; collocation; fixed-expression; false-friend;
  grammar; pronunciation; register; preposition; case; separable; aspect; measure-word;
  gender; article; tense; frequency-high; frequency-medium; frequency-low; level-a1; level-a2; level-b1; level-b2; level-c1
---`;

      const extraRules = isWordList
        ? `INPUT MODE: WORD LIST. Treat each line or hyphen-separated token as ONE item.`
        : `INPUT MODE: LONG TEXT. "Example 1" MUST be the EXACT sentence from the source text.
Add 2–4 additional natural examples you create to cover different senses/usages if needed.
If the item is too basic/common OR too technical/rare for ${level}, SKIP it.`;

      return `
You are an expert language tutor AI.
User's native language: ${sourceLang}.
Target language: ${targetLang}.
${isWordList ? 'Proficiency is not specified for word-list mode.' : `User proficiency: ${level}.`}

${taskDesc}

Quality rules:
- Prioritize PRACTICAL everyday usage.
- If an item has multiple common meanings/usages, include them via translations and examples.
- No fixed limits: include as many items/examples as necessary if important.
- Output MUST strictly follow the template below. Do NOT add headers or prose.

${fieldSpec}

${extraRules}

${isWordList ? `Here is the word/phrase list:\n${text}` : `Here is the text to analyze:\n${text}`}
`.trim();
    }

    async function callAI(text, isWordList){
      const prompt = buildPrompt(text, isWordList);
      try{
        const controller = new AbortController();
        const timeout = setTimeout(()=>controller.abort(), 60000);
        const res = await fetch(PROXY_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ prompt }),
          signal: controller.signal
        });
        clearTimeout(timeout);
        if(!res.ok) throw new Error(`Network error: ${res.status} ${res.statusText}`);
        const data = await res.json();

        const ai =
          data?.candidates?.[0]?.content?.parts?.[0]?.text ||
          data?.output_text || data?.text || '';
        if(!ai){ resultsList.innerHTML = `<p class="p-8 text-center text-red-600">${uiStrings[currentLang].errorAIResponse}</p>`; return; }

        renderResults(ai);
      }catch(err){
        console.error(err);
        resultsList.innerHTML = `<p class="p-8 text-center text-red-600">${uiStrings[currentLang].errorServer}</p>`;
      }finally{
        loader.classList.add('hidden');
      }
    }

    function parseAIResponse(s){
      const items = s.split('---').filter(x=>x.trim()!=='');
      return items.map(txt=>{
        const data = {};
        let currentKey = '';
        const lines = txt.trim().split('\n');

        lines.forEach(line => {
            const match = line.match(/^([a-zA-Z\s/]+):\s*(.*)/);
            if (match) {
                currentKey = match[1].trim().toLowerCase().replace(/[\s/]/g, '');
                data[currentKey] = match[2].trim();
            } else if (currentKey === 'examples' && /^\d+\./.test(line.trim())) {
                data.exampleslist = data.exampleslist || [];
                data.exampleslist.push(line.trim());
            } else if (currentKey === 'contextnote' && line.trim().startsWith('-')) {
                data[currentKey] += '\n' + line.trim();
            }
        });
        return data;
      });
    }

    function escapeHTML(s=''){
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }

    function getLangCode(name){
      const map={'English':'en-US','German':'de-DE','French':'fr-FR','Spanish':'es-ES','Italian':'it-IT','Russian':'ru-RU','Turkish':'tr-TR','Chinese':'zh-CN','Persian':'fa-IR'};
      return map[name]||'en-US';
    }

    function speakText(ev, text, langCode){
      ev?.stopPropagation?.();
      if(!text) return;
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text);
      u.lang = langCode; speechSynthesis.speak(u);
    }

    function tagPaletteClass(i){
      const arr = ['tag-palette-1','tag-palette-2','tag-palette-3','tag-palette-4','tag-palette-5'];
      return arr[i % arr.length];
    }
 
    function renderResults(ai){
        const parsed = parseAIResponse(ai);

        const targetLangName = targetLangSelect.value;
        const targetIsRTL = ['Persian','Arabic','Urdu'].includes(targetLangName); // Simple RTL check
        resultsList.dir = targetIsRTL ? 'rtl' : 'ltr';

        const sourceLangName = sourceLangSelect.value;
        const strings = uiStrings[langNameToCode[sourceLangName]] || uiStrings.en;
        const isEmpty = parsed.length === 0 || parsed.every(x => !x.word);
        const targetLangCode = getLangCode(targetLangName);

        if (isEmpty){
            resultsList.innerHTML = `<div class="card p-8 text-center text-gray-600">${strings.errorNoResults}</div>`;
            return;
        }

        let html = '';
        parsed.forEach((it, idx)=>{
            const word = escapeHTML(it.word || '');
            const translation = escapeHTML(it.translation || '');
            const definition = escapeHTML(it.definition || 'N/A');
            const grammar = escapeHTML(it.grammar || 'N/A');
            const collocRaw = (it.collocations || '').split(/,|،/).map(s => s.trim()).filter(Boolean);
            const mistakes = escapeHTML(it.commonmistakes || 'N/A');
            const rawNote = (it.contextnote || 'N/A');
            const noteIsNA = /^n\/?a$/i.test(rawNote.trim()) || rawNote.trim()==='N/A';
            const note = noteIsNA ? '' : escapeHTML(rawNote).replace(/\n/g, '<br>');
            const pron = escapeHTML(it.pronunciation || 'N/A');
            const tagsRaw = (it.tags || '').split(';').map(s=>s.trim()).filter(Boolean);

            html += `
            <div class="result-item card">
                <div class="result-header flex justify-between items-center" onclick="toggleDetails(${idx})" aria-expanded="false" id="hdr-${idx}">
                    <div class="min-w-0">
                        <div class="flex items-center gap-3">
                            <h3 class="text-xl font-bold text-blue-700 truncate">${word || strings.wordNotFound}</h3>
                            ${grammar && grammar !== 'N/A' ? `<span class="chip">${grammar}</span>` : ''}
                        </div>
                        <p class="text-gray-700 mt-1">${translation}</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button class="btn btn-secondary p-2.5" onclick="speakText(event,'${word.replace(/'/g, "\\'")}', '${targetLangCode}')" title="${strings.speakWord}" aria-label="${strings.speakWord}">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>
                        </button>
                        <span id="chevron-${idx}" class="text-2xl transition-transform text-gray-400">
                           <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                        </span>
                    </div>
                </div>
                <div id="details-${idx}" class="result-details bg-white">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                        <div>
                            <div class="flex items-center gap-2 mb-2">
                                <span>📘</span><strong class="font-semibold">${strings.definition}:</strong>
                            </div>
                            <p class="text-gray-800 ps-8">${definition}</p>
                        </div>
                        <div>
                            <div class="flex items-center gap-2 mb-2"><span>🗣️</span><strong class="font-semibold">${strings.pronunciation}:</strong></div>
                            <p class="text-gray-800 ps-8">${pron}</p>
                        </div>
                        <div class="md:col-span-2">
                            <div class="flex items-center gap-2 mb-2">
                                <span>🔗</span><strong class="font-semibold">${strings.collocations}:</strong>
                            </div>
                            <div class="flex flex-wrap gap-2 ps-8">
                                ${collocRaw.length ? collocRaw.map((c,i) => `<span class="chip ${'tag-palette-'+((i%5)+1)}">${escapeHTML(c)}</span>`).join('') : `<span class="text-gray-500 text-sm">${strings.notApplicable}</span>`}
                            </div>
                        </div>
                         <div class="md:col-span-2">
                            <div class="flex items-center gap-2 mb-2">
                                <span>🏷️</span><strong class="font-semibold">${strings.tags}:</strong>
                            </div>
                            <div class="flex flex-wrap gap-2 ps-8">
                                ${tagsRaw.length ? tagsRaw.map((t,i) => `<span class="chip tag ${tagPaletteClass(i)}">${escapeHTML(t)}</span>`).join('') : `<span class="text-gray-500 text-sm">${strings.notApplicable}</span>`}
                            </div>
                        </div>
                        <div class="md:col-span-2">
                            <div class="flex items-center gap-2 mb-2">
                                <span>✍️</span><strong class="font-semibold">${strings.examples}:</strong>
                            </div>
                            <ul class="space-y-3 ${targetIsRTL ? 'pr-8' : 'pl-8'}">
                                ${(it.exampleslist || []).map(ex => {
                                    const splitAt = ex.lastIndexOf(' - ');
                                    let original = ex; let trans = '';
                                    if (splitAt > 1) { original = ex.slice(0, splitAt); trans = ex.slice(splitAt + 3); }
                                    original = original.replace(/^\d+\.\s*/, '').trim();
                                    return `<li>
                                        <div class="flex items-center gap-2">
                                            <p>${escapeHTML(original)}</p>
                                            <button class="btn btn-secondary p-2" onclick="speakText(event,'${original.replace(/'/g, "\\'")}', '${targetLangCode}')" title="${strings.speakSentence}" aria-label="${strings.speakSentence}">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon></svg>
                                            </button>
                                        </div>
                                        ${trans ? `<p class="text-sm muted">${escapeHTML(trans.trim())}</p>` : ''}
                                    </li>`;
                                }).join('')}
                            </ul>
                        </div>
                        <div>
                           <div class="flex items-center gap-2 mb-2"><span>⚠️</span><strong class="font-semibold">${strings.commonMistakes}:</strong></div>
                           <p class="text-gray-800 ps-8">${mistakes}</p>
                        </div>
                        <div>
                            <div class="flex items-center gap-2 mb-2"><span>💡</span><strong class="font-semibold">${strings.contextNote}:</strong></div>
                            ${ note
                                ? `<p class="text-gray-800 ps-8">${note}</p>`
                                : `<div class="ps-8 text-sm text-gray-500 flex items-center gap-2">
                                     <span>—</span>
                                     <span>نکته‌ای توسط مدل گزارش نشد.</span>
                                   </div>` }
                        </div>
                    </div>
                </div>
            </div>`;
        });
        resultsList.innerHTML = html;
    }

    function toggleDetails(i){
      const d = document.getElementById(`details-${i}`);
      const c = document.getElementById(`chevron-${i}`);
      const h = document.getElementById(`hdr-${i}`);
      const nowOpen = !d.classList.contains('open');
      d.classList.toggle('open');
      if (c) c.style.transform = nowOpen ? 'rotate(180deg)' : 'rotate(0deg)';
      h.setAttribute('aria-expanded', nowOpen ? 'true':'false');
    }

    function toggleAll(open){
      const items = document.querySelectorAll('.result-details');
      items.forEach((d,idx)=>{
        const c = document.getElementById(`chevron-${idx}`);
        const h = document.getElementById(`hdr-${idx}`);
        if(h) h.setAttribute('aria-expanded', open ? 'true':'false');
        if(c) c.style.transform = open ? 'rotate(180deg)' : 'rotate(0deg)';
        if (open) { d.classList.add('open'); } else { d.classList.remove('open'); }
      });
    }

    let currentLang='fa';
    const langNameToCode = {'Persian':'fa','English':'en','German':'de','French':'fr','Spanish':'es','Chinese':'zh','Turkish':'tr','Italian':'it','Russian':'ru'};
    const uiStrings = {
        fa: {
            appTitle: "یادگیری زبان با هوش مصنوعی", mainTitle: "سازنده واژگان هوشمند",
            subtitle: "زبان مورد نظر خود را انتخاب کرده و متن یا فهرست واژه‌ها را وارد کنید.",
            sourceLangLabel: "زبان مادری من", targetLangLabel: "زبانی که یاد می‌گیرم", userLevelLabel: "سطح من (برای متن/فایل)",
            levelUnspecified: "انتخاب نشده", levelA1: "A1 (مبتدی)", levelA2: "A2 (ابتدایی)", levelB1: "B1 (متوسط)", levelB2: "B2 (فوق متوسط)", levelC1: "C1 (پیشرفته)",
            uploadBtnText: "آپلود فایل", processBtn: "تحلیل کن", resultsTitle: "نتایج تحلیل", startOverBtn: "شروع دوباره",
            errorLevel: "برای متن‌ها/فایل‌ها لطفاً سطح خود را انتخاب کنید تا خروجی متناسب باشد.", errorText: "لطفاً ورودی معتبر وارد یا آپلود کنید.",
            errorAIResponse: "پاسخ معتبری از هوش مصنوعی دریافت نشد.", errorServer: "مشکل ارتباط با سرور. دوباره تلاش کنید.", errorNoResults: "موردی پیدا نشد؛ ورودی دیگری امتحان کنید.",
            wordNotFound: "کلمه یافت نشد", definition: "تعریف", grammar: "نوع گرامر", collocations: "ترکیب‌های رایج", examples: "مثال‌ها",
            commonMistakes: "اشتباهات رایج", contextNote: "نکته", pronunciation: "تلفظ", forceWordlistLabel: "این ورودی یک لیست واژه است",
            hintStatic: "💡 حالت «لیست واژه»: هر خط یک واژه/عبارت یا با <code>-</code> جدا کنید. انتخاب سطح لازم نیست.<br>در غیر این صورت، با وارد کردن متن یا فایل و انتخاب سطح، سیستم واژگان کاربردی را برای شما استخراج می‌کند.",
            textPlaceholder: "لیست واژه (هر خط یک مورد) یا متن طولانی برای تحلیل…",
            expandAll: "باز کردن همه", collapseAll: "بستن همه", speakWord: "شنیدن واژه", speakSentence: "شنیدن جمله", stopSpeech: "توقف گفتار",
            notApplicable: "موردی وجود ندارد", tags: "برچسب‌ها",
            footerText: "ساخته شده با همکاری هوش مصنوعی"
        },
        en: {
            appTitle: "AI Language Learner", mainTitle: "Smart Vocabulary Builder",
            subtitle: "Select your languages and enter a word list or a long text.", sourceLangLabel: "My Native Language",
            targetLangLabel: "Language I'm Learning", userLevelLabel: "My Level (for text/files)", levelUnspecified: "Unspecified",
            levelA1: "A1 (Beginner)", levelA2: "A2 (Elementary)", levelB1: "B1 (Intermediate)", levelB2: "B2 (Upper-Intermediate)", levelC1: "C1 (Advanced)",
            uploadBtnText: "Upload File", processBtn: "Analyze", resultsTitle: "Analysis Results", startOverBtn: "Start Over",
            errorLevel: "For texts/files, please select your level.", errorText: "Please enter or upload valid input.", errorAIResponse: "No valid AI response.",
            errorServer: "Problem connecting to server. Try again.", errorNoResults: "No items found. Try another input.", wordNotFound: "Word not found",
            definition: "Definition", grammar: "Grammar", collocations: "Collocations", examples: "Examples", commonMistakes: "Common Mistakes", contextNote: "Context/Note",
            pronunciation: "Pronunciation", forceWordlistLabel: "This input is a word list",
            hintStatic: "💡 'Word List' mode: one word/phrase per line or separated with <code>-</code>. Level selection is not needed.<br>Otherwise, by pasting text or uploading a file and selecting your level, the system will extract practical vocabulary for you.",
            textPlaceholder: "Word list (one item per line) or long text for analysis...",
            expandAll: "Expand All", collapseAll: "Collapse All", speakWord: "Speak word", speakSentence: "Speak sentence", stopSpeech: "Stop speech",
            notApplicable: "Not Applicable", tags: "Tags",
            footerText: "Built with AI collaboration"
        },
        de: {appTitle:"KI-Sprachlerner",mainTitle:"Intelligenter Vokabeltrainer",subtitle:"Wortliste oder langen Text eingeben.",sourceLangLabel:"Meine Muttersprache",targetLangLabel:"Sprache, die ich lerne",userLevelLabel:"Mein Niveau (für Text/Dateien)",levelUnspecified:"Nicht angegeben",levelA1:"A1 (Anfänger)",levelA2:"A2 (Grundlegend)",levelB1:"B1 (Mittelstufe)",levelB2:"B2 (Obere Mittelstufe)",levelC1:"C1 (Fortgeschritten)",uploadBtnText:"Datei hochladen",processBtn:"Analysieren",resultsTitle:"Analyseergebnisse",startOverBtn:"Neu anfangen",errorLevel:"Für Texte/Dateien bitte Niveau wählen.",errorText:"Bitte gültige Eingabe eingeben/hochladen.",errorAIResponse:"Keine gültige KI-Antwort.",errorServer:"Verbindungsproblem. Erneut versuchen.",errorNoResults:"Keine Elemente gefunden.",wordNotFound:"Wort nicht gefunden",definition:"Definition",grammar:"Grammatik",collocations:"Kollokationen",examples:"Beispiele",commonMistakes:"Häufige Fehler",contextNote:"Kontext/Notiz",pronunciation:"Aussprache",forceWordlistLabel:"Dies ist eine Wortliste",textPlaceholder:"Wortliste (ein Eintrag pro Zeile) oder langer Text...",expandAll:"Alle erweitern",collapseAll:"Alle reduzieren",speakWord:"Wort sprechen",speakSentence:"Satz sprechen",stopSpeech:"Sprache stoppen",notApplicable:"Nicht zutreffend", tags:"Tags", footerText:"Erstellt mit KI-Kollaboration"},
        fr: {appTitle:"Apprentissage des langues par l'IA",mainTitle:"Constructeur de vocabulaire intelligent",subtitle:"Saisissez une liste de mots ou un long texte.",sourceLangLabel:"Ma langue maternelle",targetLangLabel:"Langue que j'apprends",userLevelLabel:"Mon niveau (pour textes/fichiers)",levelUnspecified:"Non spécifié",levelA1:"A1 (Débutant)",levelA2:"A2 (Élémentaire)",levelB1:"B1 (Intermédiaire)",levelB2:"B2 (Intermédiaire supérieur)",levelC1:"C1 (Avancé)",uploadBtnText:"Télécharger",processBtn:"Analyser",resultsTitle:"Résultats de l'analyse",startOverBtn:"Recommencer",errorLevel:"Pour textes/fichiers, choisissez votre niveau.",errorText:"Veuillez saisir ou télécharger une entrée valide.",errorAIResponse:"Aucune réponse valide.",errorServer:"Problème de connexion.",errorNoResults:"Aucun élément trouvé.",wordNotFound:"Mot non trouvé",definition:"Définition",grammar:"Grammaire",collocations:"Collocations",examples:"Exemples",commonMistakes:"Erreurs courantes",contextNote:"Contexte/Note",pronunciation:"Prononciation",forceWordlistLabel:"Ceci est une liste de mots",textPlaceholder:"Liste de mots (un par ligne) ou texte long...",expandAll:"Tout déplier",collapseAll:"Tout replier",speakWord:"Parler le mot",speakSentence:"Parler la phrase",stopSpeech:"Arrêter la parole",notApplicable:"Non applicable", tags:"Étiquettes", footerText:"Créé avec la collaboration de l'IA"},
        es: {appTitle:"Aprendizaje de idiomas con IA",mainTitle:"Constructor de vocabulario inteligente",subtitle:"Lista de palabras o texto largo.",sourceLangLabel:"Mi lengua materna",targetLangLabel:"Idioma que aprendo",userLevelLabel:"Mi nivel (para texto/archivos)",levelUnspecified:"No especificado",levelA1:"A1 (Principiante)",levelA2:"A2 (Elemental)",levelB1:"B1 (Intermedio)",levelB2:"B2 (Intermedio alto)",levelC1:"C1 (Avanzado)",uploadBtnText:"Subir archivo",processBtn:"Analizar",resultsTitle:"Resultados del análisis",startOverBtn:"Empezar de nuevo",errorLevel:"Para textos/archivos, elige tu nivel.",errorText:"Introduce o sube una entrada válida.",errorAIResponse:"Sin respuesta válida.",errorServer:"Problemas de conexión.",errorNoResults:"No se encontraron elementos.",wordNotFound:"No se encontró palabra",definition:"Definición",grammar:"Gramática",collocations:"Colocaciones",examples:"Ejemplos",commonMistakes:"Errores comunes",contextNote:"Contexto/Nota",pronunciation:"Pronunciación",forceWordlistLabel:"Esta es una lista de palabras",textPlaceholder:"Lista de palabras (una por línea) o texto largo...",expandAll:"Expandir todo",collapseAll:"Contraer todo",speakWord:"Decir palabra",speakSentence:"Decir frase",stopSpeech:"Detener voz",notApplicable:"No aplica", tags:"Etiquetas", footerText:"Hecho con colaboración de IA"},
        zh: {appTitle:"人工智能语言学习器",mainTitle:"智能词汇构建器",subtitle:"输入单词列表或长文本。",sourceLangLabel:"我的母语",targetLangLabel:"我学习的语言",userLevelLabel:"我的水平（用于文本/文件）",levelUnspecified:"未指定",levelA1:"A1 (初学者)",levelA2:"A2 (初级)",levelB1:"B1 (中级)",levelB2:"B2 (中高级)",levelC1:"C1 (高级)",uploadBtnText:"上传文件",processBtn:"分析",resultsTitle:"分析结果",startOverBtn:"重新开始",errorLevel:"对于文本/文件请选择水平。",errorText:"请输入或上传有效输入。",errorAIResponse:"无有效响应。",errorServer:"连接问题。",errorNoResults:"未找到项目。",wordNotFound:"未找到单词",definition:"定义",grammar:"语法",collocations:"搭配",examples:"例子",commonMistakes:"常见错误",contextNote:"语境/说明",pronunciation:"发音",forceWordlistLabel:"这是一个单词列表",textPlaceholder:"单词列表（每行一项）或长文本...",expandAll:"全部展开",collapseAll:"全部折叠",speakWord:"朗读单词",speakSentence:"朗读句子",stopSpeech:"停止朗读", notApplicable:"不适用", tags:"标签", footerText:"与 AI 合作完成"},
        tr: {appTitle:"Yapay Zeka ile Dil Öğrenimi",mainTitle:"Akıllı Kelime Oluşturucu",subtitle:"Kelime listesi veya uzun metin.",sourceLangLabel:"Ana Dilim",targetLangLabel:"Öğrendiğim Dil",userLevelLabel:"Seviyem (metin/dosyalar için)",levelUnspecified:"Belirtilmemiş",levelA1:"A1 (Başlangıç)",levelA2:"A2 (Temel)",levelB1:"B1 (Orta)",levelB2:"B2 (Orta-üstü)",levelC1:"C1 (İleri)",uploadBtnText:"Dosya Yükle",processBtn:"Analiz Et",resultsTitle:"Analiz Sonuçları",startOverBtn:"Yeniden Başla",errorLevel:"Metin/dosyalar için seviye seçin.",errorText:"Geçerli bir giriş girin/yükleyin.",errorAIResponse:"Geçerli yanıt yok.",errorServer:"Bağlantı sorunu.",errorNoResults:"Öğe bulunamadı.",wordNotFound:"Kelime bulunamadı",definition:"Tanım",grammar:"Gramer",collocations:"Birlikte Kullanımlar",examples:"Örnekler",commonMistakes:"Yaygın Hatalar",contextNote:"Bağlam/Not",pronunciation:"Telaffuz",forceWordlistLabel:"Bu bir kelime listesidir",textPlaceholder:"Satır başına bir kelime/ifade veya uzun metin...",expandAll:"Tümünü Genişlet",collapseAll:"Tümünü Daralt",speakWord:"Kelimeyi söyle",speakSentence:"Cümleyi söyle",stopSpeech:"Konuşmayı durdur", notApplicable:"Uygulanamaz", tags:"Etiketler", footerText:"AI iş birliğiyle oluşturuldu"},
        it: {appTitle:"Apprendimento delle lingue con IA",mainTitle:"Costruttore di vocabolario intelligente",subtitle:"Elenco parole o testo lungo.",sourceLangLabel:"Lingua madre",targetLangLabel:"Lingua che imparo",userLevelLabel:"Livello (per testi/file)",levelUnspecified:"Non specificato",levelA1:"A1 (Principiante)",levelA2:"A2 (Elementare)",levelB1:"B1 (Intermedio)",levelB2:"B2 (Intermedio-superiore)",levelC1:"C1 (Avanzato)",uploadBtnText:"Carica File",processBtn:"Analizza",resultsTitle:"Risultati dell'analisi",startOverBtn:"Ricomincia",errorLevel:"Per testi/file seleziona il livello.",errorText:"Inserisci/carica un input valido.",errorAIResponse:"Nessuna risposta valida.",errorServer:"Problema di connessione.",errorNoResults:"Nessun elemento trovato.",wordNotFound:"Parola non trovata",definition:"Definizione",grammar:"Grammatica",collocations:"Collocazioni",examples:"Esempi",commonMistakes:"Errori comuni",contextNote:"Contesto/Nota",pronunciation:"Pronuncia",forceWordlistLabel:"Questa è una lista di parole",textPlaceholder:"Elenco parole (una per riga) o testo lungo...",expandAll:"Espandi tutto",collapseAll:"Comprimi tutto",speakWord:"Pronuncia parola",speakSentence:"Pronuncia frase",stopSpeech:"Ferma discorso", notApplicable:"Non applicabile", tags:"Tag", footerText:"Creato con la collaborazione dell'IA"},
        ru: {appTitle:"Изучение языков с ИИ",mainTitle:"Умный конструктор словарного запаса",subtitle:"Список слов или длинный текст.",sourceLangLabel:"Родной язык",targetLangLabel:"Изучаемый язык",userLevelLabel:"Уровень (для текста/файлов)",levelUnspecified:"Не указан",levelA1:"A1 (Начинающий)",levelA2:"A2 (Элементарный)",levelB1:"B1 (Средний)",levelB2:"B2 (Выше среднего)",levelC1:"C1 (Продвинутый)",uploadBtnText:"Загрузить файл",processBtn:"Анализировать",resultsTitle:"Результаты анализа",startOverBtn:"Начать сначала",errorLevel:"Для текста/файлов укажите уровень.",errorText:"Введите/загрузите корректные данные.",errorAIResponse:"Нет ответа ИИ.",errorServer:"Ошибка соединения.",errorNoResults:"Ничего не найдено.",wordNotFound:"Слово не найдено",definition:"Определение",grammar:"Грамматика",collocations:"Сочетания",examples:"Примеры",commonMistakes:"Частые ошибки",contextNote:"Контекст/Примечание",pronunciation:"Произношение",forceWordlistLabel:"Это список слов",textPlaceholder:"Список слов (по одному в строке) или длинный текст...",expandAll:"Развернуть все",collapseAll:"Свернуть все",speakWord:"Произнести слово",speakSentence:"Произнести предложение",stopSpeech:"Остановить речь", notApplicable:"Неприменимо", tags:"Теги", footerText:"Создано при помощи ИИ"}
    };

    function setLanguage(lang){
      currentLang = lang;
      const s = uiStrings[lang] || uiStrings.en;
      const isRtl = lang==='fa';
     
      document.documentElement.lang = lang;
      document.documentElement.dir = isRtl ? 'rtl':'ltr';
     
      document.getElementById('app-title').textContent = s.appTitle;
      document.getElementById('main-title').textContent = s.mainTitle;
      document.getElementById('subtitle').textContent = s.subtitle;
      document.getElementById('source-lang-label').textContent = s.sourceLangLabel;
      document.getElementById('target-lang-label').textContent = s.targetLangLabel;
      document.getElementById('user-level-label').textContent = s.userLevelLabel;
      document.getElementById('level-unspecified').textContent = s.levelUnspecified;
      document.getElementById('level-a1').textContent = s.levelA1;
      document.getElementById('level-a2').textContent = s.levelA2;
      document.getElementById('level-b1').textContent = s.levelB1;
      document.getElementById('level-b2').textContent = s.levelB2;
      document.getElementById('level-c1').textContent = s.levelC1;
      document.getElementById('upload-btn-text').textContent = s.uploadBtnText;

      const processBtnSpan = document.querySelector('#process-btn > span');
      if(processBtnSpan) processBtnSpan.textContent = s.processBtn;

      document.getElementById('results-title').textContent = s.resultsTitle;
      document.getElementById('start-over-btn').textContent = s.startOverBtn;
      document.getElementById('force-wordlist-label').textContent = s.forceWordlistLabel;
      document.getElementById('expand-all').textContent = "⬇️ " + s.expandAll;
      document.getElementById('collapse-all').textContent = "⬆️ " + s.collapseAll;
      document.getElementById('stop-tts').title = s.stopSpeech;
      document.getElementById('text-input').placeholder = s.textPlaceholder;
      document.getElementById('hint').innerHTML = s.hintStatic;
      document.getElementById('footer-text').textContent = s.footerText || "Built with AI collaboration";
      syncLevelRequirement();
    }

    document.addEventListener('DOMContentLoaded', ()=> setLanguage('fa'));
  </script>
</body>
</html>

