<!DOCTYPE html>
<html lang="fa" dir="rtl" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="app-title">€åÿßÿØ⁄Ø€åÿ±€å ÿ≤ÿ®ÿßŸÜ ÿ®ÿß ŸáŸàÿ¥ ŸÖÿµŸÜŸàÿπ€å</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #f7f9fc; --surface: #ffffff; --text: #111827; --muted: #6b7280;
      --border: rgba(17, 24, 39, 0.08); --shadow: 0 10px 30px -12px rgba(2, 6, 23, .18);
      --primary: #3b82f6; --primary-600:#2563eb; --chip:#f8fafc; --chip-border:#e5e7eb;
      --accent-1: #e0e7ff; --accent-2: #fce7f3; --accent-3: #ccfbf1; --accent-4: #fef3c7;
    }
    [data-theme="dark"]{
      --bg: #0b1220; --surface: #0f172a; --text: #e5e7eb; --muted: #9ca3af;
      --border: rgba(148, 163, 184, 0.15); --shadow: 0 14px 42px -12px rgba(2, 6, 23, .6);
      --primary: #60a5fa; --primary-600:#3b82f6; --chip:#0b1220; --chip-border:#1f2937;
      --accent-1: #1e293b; --accent-2: #1f2540; --accent-3: #0f2f2b; --accent-4: #2a1f0f;
    }
    html { scroll-behavior: smooth; }
    body {
      font-family: 'Vazirmatn', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      background-color: var(--bg);
      background-image:
        radial-gradient(1200px 600px at 100% -10%, var(--accent-1), transparent 60%),
        radial-gradient(900px 500px at -10% 110%, var(--accent-2), transparent 60%);
      color: var(--text); min-height: 100vh;
    }
    .glass { backdrop-filter: saturate(160%) blur(12px); background: color-mix(in oklab, var(--surface) 78%, transparent); border-bottom: 1px solid var(--border); }
    .card { background: color-mix(in oklab, var(--surface) 94%, transparent); border: 1px solid var(--border); border-radius: 1.25rem; box-shadow: var(--shadow); }
    .ring-card { position: relative; border-radius: 1rem; overflow: hidden; background-color: var(--surface); }
    .ring-card::before{ content:""; position:absolute; inset: -1px; border-radius: 1rem; padding: 1px;
      background: conic-gradient(from 180deg, #60a5fa, #a78bfa, #22d3ee, #60a5fa);
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude; pointer-events: none; animation: spin 8s linear infinite; opacity: .75; }
    @keyframes spin { to { transform: rotate(360deg); } }
    .result-header { cursor: pointer; background: color-mix(in oklab, var(--surface) 88%, transparent); transition: background .2s ease, transform .15s ease; }
    .ring-card:hover .result-header { transform: translateY(-1px); }
    .result-details { max-height: 0; overflow: hidden; transition: max-height .5s ease, padding .35s ease, border-color .35s ease; border-top: 1px solid transparent; padding: 0 1.25rem; background: var(--surface); }
    .result-details.open { max-height: 1600px; border-top-color: var(--border); padding: 1rem 1.25rem 1.25rem; }
    .chip { display: inline-flex; align-items: center; gap:.35rem; padding: .22rem .6rem; border-radius: 999px; font-size: .78rem; font-weight: 600; border: 1px solid var(--chip-border); background: var(--chip); white-space: nowrap; }
    .chip .dot{width:.5rem;height:.5rem;border-radius:999px;opacity:.85}
    .drop-zone { border: 2px dashed var(--border); border-radius: 1rem; transition: all .2s ease; background: color-mix(in oklab, var(--surface) 80%, transparent); }
    .drop-zone.drag-over { border-color: var(--primary); background: color-mix(in oklab, var(--surface) 92%, transparent); }
    .btn { border-radius: .85rem; font-weight: 700; padding: .68rem 1.2rem; display: inline-flex; align-items: center; gap: .55rem; border: 1px solid var(--border); transition: transform .08s ease, background .15s ease, border-color .15s ease; will-change: transform; }
    .btn:active{ transform: translateY(1px) }
    .btn-primary{ background: linear-gradient(180deg, var(--primary), var(--primary-600)); color: #fff; border-color: color-mix(in oklab, var(--primary-600) 60%, #0000); box-shadow: 0 12px 28px -12px color-mix(in oklab, var(--primary) 60%, transparent); }
    .btn-secondary{ background: var(--surface); color: var(--text); }
    .btn-ghost{ background: transparent; border-color: transparent; }
    .muted { color: var(--muted); }
    .floating-top { position: fixed; bottom: 20px; inset-inline-end: 20px; z-index: 50; backdrop-filter: blur(8px); background: color-mix(in oklab, var(--surface) 92%, transparent); border:1px solid var(--border); border-radius: 999px; padding: .6rem .8rem; box-shadow: var(--shadow); display: none; }
    .floating-top.show{ display: inline-flex; }
    .warn { border: 1px dashed rgba(234,88,12,.5); background: color-mix(in oklab, #fed7aa 30%, var(--surface)); color:#7c2d12; border-radius: 1rem; }
    .promo { background: color-mix(in oklab, var(--accent-1) 28%, var(--surface)); border: 1px solid var(--border); border-radius: 1.25rem; box-shadow: var(--shadow); }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="sticky top-0 z-20 glass">
    <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="size-9 rounded-xl bg-gradient-to-br from-blue-500 via-indigo-500 to-cyan-400 grid place-items-center text-white shadow">
          <svg xmlns="http://www.w3.org/2000/svg" class="size-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2a3 3 0 0 0-3 3v4a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M12 18a3 3 0 0 0 3-3V9a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3Z"/></svg>
        </div>
        <div>
          <h1 id="main-title" class="text-xl md:text-2xl font-extrabold tracking-tight"></h1>
          <p id="header-subtitle" class="hidden"></p><!-- ŸÖÿÆŸÅ€å ÿ¥ÿØÿõ ŸÖÿ™ŸÜ ÿ®Ÿá ÿ®ÿß⁄©ÿ≥ Ÿæÿ±ŸàŸÖŸà ŸÖŸÜÿ™ŸÇŸÑ ÿ¥ÿØŸá -->
        </div>
      </div>

      <div class="flex items-center gap-3">
        <div class="flex items-center gap-2">
          <div class="relative flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="absolute left-3 rtl:right-3 rtl:left-auto size-4 pointer-events-none text-[var(--muted)]" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>
            <select id="ui-lang-switcher" class="appearance-none w-full pl-10 pr-4 rtl:pr-10 rtl:pl-4 py-1.5 rounded-lg border text-sm bg-[var(--surface)] border-[var(--border)]"></select>
          </div>
          <button id="theme-toggle" class="toggle" aria-label="toggle theme">
            <span class="knob"></span>
          </button>
          <button id="stop-tts" class="btn btn-ghost p-2.5" title="ÿ™ŸàŸÇŸÅ ⁄ØŸÅÿ™ÿßÿ±" aria-label="stop-tts">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect></svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Promo Description (big, below header) -->
  <section class="max-w-5xl mx-auto px-4 pt-6">
    <div class="promo p-5 md:p-7">
      <p id="big-desc" class="text-lg md:text-2xl leading-relaxed"></p>
    </div>
  </section>

  <!-- Hero / Controls -->
  <section class="max-w-5xl mx-auto px-4 pt-6 pb-2">
    <div class="card p-6 md:p-8">
      <p id="subtitle" class="hidden"></p><!-- ÿ≠ÿ∞ŸÅ ŸÖÿ™ŸÜ ⁄©Ÿàÿ™ÿßŸáÿõ ÿ®Ÿá big-desc ŸÖŸÜÿ™ŸÇŸÑ ÿ¥ÿØ -->

      <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
        <div>
          <label id="source-lang-label" class="block text-sm font-medium mb-1"></label>
          <select id="source-lang" class="w-full p-2.5 rounded-xl border bg-[var(--surface)] border-[var(--border)]"></select>
        </div>
        <div>
          <label id="target-lang-label" class="block text-sm font-medium mb-1"></label>
          <select id="target-lang" class="w-full p-2.5 rounded-xl border bg-[var(--surface)] border-[var(--border)]"></select>
        </div>
        <div>
          <label id="user-level-label" class="block text-sm font-medium mb-1"></label>
          <select id="user-level" class="w-full p-2.5 rounded-xl border bg-[var(--surface)] border-[var(--border)]">
            <option id="level-unspecified" value="Unspecified"></option>
            <option id="level-a1" value="A1"></option>
            <option id="level-a2" value="A2"></option>
            <option id="level-b1" value="B1"></option>
            <option id="level-b2" value="B2"></option>
            <option id="level-c1" value="C1"></option>
          </select>
        </div>
        <div class="hidden md:block"></div>
      </div>

      <div id="hint-container" class="mb-5 rounded-xl border border-[var(--border)] bg-[var(--surface)]">
        <div class="px-4 py-3 flex items-start gap-3">
          <div class="size-8 rounded-lg bg-[var(--accent-1)]/60 grid place-items-center mt-1">üí°</div>
          <div id="hint" class="text-sm muted space-y-1"></div>
        </div>
      </div>

      <div id="drop-zone" class="drop-zone p-4">
        <div class="flex items-center justify-between mb-3">
          <div class="flex items-center gap-2">
            <span id="drop-hint-icon" class="inline-grid place-items-center size-8 rounded-lg bg-[var(--accent-3)]/50">üìù</span>
            <span id="drop-hint-text" class="text-sm muted"></span>
          </div>
          <div id="drag-drop-badge" class="text-xs px-2 py-1 rounded-full bg-[var(--accent-2)]/40 border border-[var(--border)]"></div>
        </div>

        <textarea id="text-input" rows="10" class="w-full p-3 rounded-xl border bg-[var(--surface)] border-[var(--border)] focus:outline-none"></textarea>

        <!-- checkbox & upload row -->
        <div class="mt-3 flex items-center justify-between gap-3">
          <label class="inline-flex items-center gap-2 cursor-pointer">
            <input id="force-wordlist" type="checkbox" class="w-4 h-4 rounded accent-[var(--primary)]">
            <span id="force-wordlist-label" class="text-sm"></span>
          </label>

          <div class="flex items-center gap-2">
            <label for="file-upload" class="cursor-pointer btn btn-secondary">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
              <span id="upload-btn-text"></span>
            </label>
            <input id="file-upload" type="file" class="hidden" accept=".txt,.srt">
            <span id="file-name" class="text-sm muted"></span>
          </div>
        </div>

        <!-- long-text + no level warning -->
        <div id="level-warning" class="hidden mt-4 p-3 warn text-sm"></div>

        <div class="flex justify-end mt-4">
          <button id="process-btn" class="btn btn-primary px-8">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
            <span class="select-none"></span>
          </button>
        </div>

        <p id="error-msg" class="text-red-500 text-sm mt-3 text-center hidden"></p>
      </div>
    </div>
  </section>

  <!-- Results -->
  <main class="max-w-7xl mx-auto px-4 pb-16">
    <section id="results-view" class="hidden mt-8">
      <div class="card p-4 md:p-5 flex flex-col md:flex-row gap-3 md:items-center justify-between mb-6">
        <h2 id="results-title" class="text-2xl md:text-3xl font-extrabold"></h2>
        <div class="flex gap-2">
          <button id="expand-all" class="btn btn-secondary text-sm"></button>
          <button id="collapse-all" class="btn btn-secondary text-sm"></button>
          <button id="start-over-btn" class="btn btn-secondary text-sm"></button>
        </div>
      </div>

      <div id="loader" class="grid gap-4 md:grid-cols-2 hidden">
        <div class="ring-card"><div class="card p-5"><div class="skeleton h-6 w-40 mb-3"></div><div class="skeleton h-4 w-72 mb-6"></div><div class="skeleton h-24"></div></div></div>
        <div class="ring-card"><div class="card p-5"><div class="skeleton h-6 w-40 mb-3"></div><div class="skeleton h-4 w-72 mb-6"></div><div class="skeleton h-24"></div></div></div>
      </div>

      <div id="results-list" class="space-y-4"></div>
    </section>
  </main>

  <footer class="text-center p-8 mt-8 text-sm muted">
    <p id="footer-text-line1" class="hidden"></p><!-- ÿ≠ÿ∞ŸÅ ÿ¥ÿØ -->
    <p id="footer-text-line2" class="mt-1"></p>
  </footer>

  <button id="to-top" class="floating-top" aria-label="Back to top" title="ÿ®ÿßÿ≤⁄Øÿ¥ÿ™ ÿ®Ÿá ÿ®ÿßŸÑÿß">‚§¥Ô∏é</button>

  <script>
    const PROXY_URL = 'https://language-learner.qaderi.workers.dev/';
    const LANGS = [
      { code:'fa', label:'ŸÅÿßÿ±ÿ≥€å', en:'Persian', tts:'fa-IR' },
      { code:'en', label:'English', en:'English', tts:'en-US' },
      { code:'de', label:'Deutsch', en:'German', tts:'de-DE' },
      { code:'fr', label:'Fran√ßais', en:'French', tts:'fr-FR' },
      { code:'es', label:'Espa√±ol', en:'Spanish', tts:'es-ES' },
      { code:'zh', label:'‰∏≠Êñá', en:'Chinese', tts:'zh-CN' },
      { code:'tr', label:'T√ºrk√ße', en:'Turkish', tts:'tr-TR' },
      { code:'it', label:'Italiano', en:'Italian', tts:'it-IT' },
      { code:'ru', label:'–†—É—Å—Å–∫–∏–π', en:'Russian', tts:'ru-RU' }
    ];
    const RTL_LANGS = new Set(['fa']);

    // DOM refs
    const resultsView = document.getElementById('results-view');
    const processBtn = document.getElementById('process-btn');
    const startOverBtn = document.getElementById('start-over-btn');
    const textInput = document.getElementById('text-input');
    const fileUpload = document.getElementById('file-upload');
    const fileNameEl = document.getElementById('file-name');
    const errorMsg = document.getElementById('error-msg');
    const levelWarning = document.getElementById('level-warning');
    const userLevelSelect = document.getElementById('user-level');
    const sourceLangSelect = document.getElementById('source-lang');
    const targetLangSelect = document.getElementById('target-lang');
    const loader = document.getElementById('loader');
    const resultsList = document.getElementById('results-list');
    const uiLangSwitcher = document.getElementById('ui-lang-switcher');
    const dropZone = document.getElementById('drop-zone');
    const stopTTSBtn = document.getElementById('stop-tts');
    const expandAllBtn = document.getElementById('expand-all');
    const collapseAllBtn = document.getElementById('collapse-all');
    const forceWordlist = document.getElementById('force-wordlist');
    const toTopBtn = document.getElementById('to-top');
    const themeToggle = document.getElementById('theme-toggle');
    const bigDesc = document.getElementById('big-desc');

    // Theme
    const savedTheme = localStorage.getItem('ll-theme') || 'light';
    document.documentElement.setAttribute('data-theme', savedTheme);
    themeToggle.addEventListener('click', () => {
      const next = document.documentElement.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('ll-theme', next);
    });

    // Events
    processBtn.addEventListener('click', handleProcessRequest);
    startOverBtn.addEventListener('click', () => {
      resultsView.classList.add('hidden');
      textInput.value=''; fileUpload.value=''; fileNameEl.textContent=''; resultsList.innerHTML='';
      hideError(); hideLevelWarning();
      window.scrollTo({top:0, behavior:'smooth'});
      updateModeBadge();
    });
    expandAllBtn.addEventListener('click', () => toggleAll(true));
    collapseAllBtn.addEventListener('click', () => toggleAll(false));
    stopTTSBtn.addEventListener('click', () => speechSynthesis.cancel());
    fileUpload.addEventListener('change', (e) => { const f = e.target.files[0]; if (f) handleFile(f); });
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('drag-over'); });
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('drag-over'));
    dropZone.addEventListener('drop', (e) => { e.preventDefault(); dropZone.classList.remove('drag-over'); const f = e.dataTransfer.files[0]; if (f) handleFile(f); });
    uiLangSwitcher.addEventListener('change', (e) => {
      localStorage.setItem('ll-lang', e.target.value);
      setLanguage(e.target.value);
    });
    forceWordlist.addEventListener('change', syncLevelRequirement);
    textInput.addEventListener('input', syncLevelRequirement);
    window.addEventListener('scroll', () => { toTopBtn.classList.toggle('show', window.scrollY > 800) });
    toTopBtn.addEventListener('click', () => window.scrollTo({top:0, behavior:'smooth'}));

    function handleFile(file){
      fileNameEl.textContent = file.name;
      const reader = new FileReader();
      reader.onload = (e) => {
        textInput.value = file.name.endsWith('.srt') ? cleanSRT(e.target.result || '') : (e.target.result || '');
        syncLevelRequirement();
      };
      reader.readAsText(file);
    }
    function cleanSRT(s){
      return s.replace(/\uFEFF/g,'').replace(/^\d+\s*$/gm,'')
        .replace(/\d{2}:\d{2}:\d{2},\d{3}\s+-->\s+\d{2}:\d{2}:\d{2},\d{3}.*/g,'')
        .replace(/<[^>]+>/g,'').replace(/[^\S\r\n]+/g,' ')
        .replace(/\n{2,}/g,'\n').trim();
    }
    function looksLikeWordList(text){
      const lines = text.split(/\r?\n/).filter(l=>l.trim()!=='');
      if (lines.length>=2 && lines.every(l=>l.trim().length<=40)) return true;
      const tokens = text.split(/\s*-\s*/).filter(t=>t.trim()!=='');
      if (tokens.length>=2 && tokens.every(t=>t.trim().length<=40)) return true;
      return text.trim().split(/\s+/).length < 30 && !text.includes('\n\n');
    }
    function updateModeBadge(){
      const badge = document.getElementById('drag-drop-badge');
      const s = uiStrings[currentLang] || uiStrings.en;
      const isList = forceWordlist.checked || (looksLikeWordList(textInput.value.trim()) && !fileUpload.files[0]);
      badge.textContent = isList ? s.modeWordlist : s.modeText;
    }
    function syncLevelRequirement(){
      const txt = textInput.value.trim();
      const isList = forceWordlist.checked || (looksLikeWordList(txt) && !fileUpload.files[0]);
      userLevelSelect.disabled = isList;
      if (isList) userLevelSelect.value='Unspecified';
      updateModeBadge();
      if (!isList && userLevelSelect.value==='Unspecified' && (txt.length > 160 || txt.split(/\s+/).length > 35)) {
        showLevelWarning();
      } else {
        hideLevelWarning();
      }
    }

    function showError(m){ errorMsg.textContent=m; errorMsg.classList.remove('hidden'); }
    function hideError(){ errorMsg.classList.add('hidden'); }
    function showLevelWarning(){
      const s = uiStrings[currentLang] || uiStrings.en;
      levelWarning.innerHTML = s.levelWarning;
      levelWarning.classList.remove('hidden');
    }
    function hideLevelWarning(){ levelWarning.classList.add('hidden'); }

    function handleProcessRequest(){
      const text = textInput.value.trim();
      const level = userLevelSelect.value;
      const isList = forceWordlist.checked || (looksLikeWordList(text) && !fileUpload.files[0]);

      if (!text){ showError(uiStrings[currentLang].errorText); return; }
      if (!isList && level==='Unspecified'){
        showLevelWarning();
        showError(uiStrings[currentLang].errorLevel);
        return;
      }

      hideError(); hideLevelWarning();
      resultsView.classList.remove('hidden');
      loader.classList.remove('hidden');
      resultsList.innerHTML='';
      callAI(text, isList);
      document.getElementById('results-view').scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function buildPrompt(text, isWordList){
      const sourceLang = LANGS.find(l=>l.code===sourceLangSelect.value)?.en || 'Persian';
      const targetLang = LANGS.find(l=>l.code===targetLangSelect.value)?.en || 'English';
      const level = userLevelSelect.value;
      const taskDesc = isWordList
        ? `You will analyze a USER-PROVIDED LIST of words/phrases in ${targetLang}. For EACH item, produce a full analysis.`
        : `You will analyze a LONG TEXT in ${targetLang}. Extract ALL useful, everyday words, idioms, and phrases for a ${level} learner. For EACH extracted item, produce a full analysis.`;
      const fieldSpec = `For EACH item, output EXACTLY the following template. Use "---" as a separator between items.

Word: [the item in ${targetLang}]
Translation: [translation in ${sourceLang}; if multiple common meanings, separate with ";"]
Definition: [simple, level-appropriate definition in ${targetLang}]
Grammar: [part of speech; e.g., "phrasal verb (inseparable)", "verb (takes Akkusativ)", "noun (countable)"]
Collocations: [common combinations, comma-separated; if none, write "N/A"]
Examples:
1. [Example 1 in ${targetLang}] - [${sourceLang} translation]
2. [Example 2 in ${targetLang}] - [${sourceLang} translation]
Common Mistakes: ["nothing specific" OR a concrete pitfall (wrong preposition, false friend, etc.)]
Context/Note:
- Write 1‚Äì2 concise sentences on ONE of the following (most relevant): register/formality; synonym contrast; required prepositions/case; language-specific behavior (e.g., separable verb); usage frequency.
- Never output "N/A". Default: "neutral register; general-use".
Pronunciation: [IPA/Pinyin/phonetic if applicable; else "N/A"]
Tags:
- Choose 1‚Äì3 tags from the list (AT LEAST ONE required). Separate with semicolons.
- Allowed: informal; formal; neutral; spoken; academic; business; travel; tech; slang; idiom; phrasal-verb; collocation; fixed-expression; false-friend; grammar; pronunciation; register; preposition; case; separable; aspect; measure-word; gender; article; tense; frequency-high; frequency-medium; frequency-low; level-a1; level-a2; level-b1; level-b2; level-c1
---`;
      const extraRules = isWordList
        ? `INPUT MODE: WORD LIST. Treat each line or hyphen-separated token as ONE item.`
        : `INPUT MODE: LONG TEXT. "Example 1" MUST be the EXACT sentence from the source text. Add other natural examples. If an item is too basic/rare for ${level}, SKIP it.`;
      return `You are an expert language tutor AI. User's native: ${sourceLang}. Target: ${targetLang}. ${isWordList ? '' : `Proficiency: ${level}.`}

${taskDesc}

RULES:
- Prioritize PRACTICAL usage.
- Output MUST strictly follow the template. No extra commentary.

${fieldSpec}

${extraRules}

${isWordList ? `Here is the word/phrase list:\n${text}` : `Here is the text to analyze:\n${text}`}`;
    }

    async function callAI(text, isWordList){
      const prompt = buildPrompt(text, isWordList);
      try{
        const controller = new AbortController();
        setTimeout(()=>controller.abort(), 60000);
        const res = await fetch(PROXY_URL, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ prompt }), signal: controller.signal });
        if(!res.ok) throw new Error(`Network error: ${res.status}`);
        const data = await res.json();
        const ai = data?.candidates?.[0]?.content?.parts?.[0]?.text || '';
        if(!ai) throw new Error(uiStrings[currentLang].errorAIResponse);
        renderResults(ai);
      }catch(err){
        console.error(err);
        resultsList.innerHTML = `<div class="card p-8 text-center text-red-500">${err.message || uiStrings[currentLang].errorServer}</div>`;
      }finally{
        loader.classList.add('hidden');
      }
    }

    function parseAIResponse(s){
      return s.split('---').filter(x=>x.trim()).map(txt=>{
        const data = {}; let currentKey = '';
        txt.trim().split('\n').forEach(line => {
          const match = line.match(/^([a-zA-Z\s/]+):\s*(.*)/);
          if (match) {
            currentKey = match[1].trim().toLowerCase().replace(/[\s/]/g, '');
            data[currentKey] = match[2].trim();
          } else if (currentKey === 'examples' && /^\d+\./.test(line.trim())) {
            data.exampleslist = data.exampleslist || [];
            data.exampleslist.push(line.trim());
          } else if (currentKey === 'contextnote' && line.trim().startsWith('-')) {
            data[currentKey] = (data[currentKey] || '') + '\n' + line.trim();
          }
        });
        return data;
      });
    }

    function escapeHTML(s=''){ return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
    function speakText(ev, text, langCode){
      ev?.stopPropagation?.();
      if(!text) return;
      speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(text); u.lang = langCode; speechSynthesis.speak(u);
    }
    function tagPalette(i){ return ['#e0e7ff','#ccfbf1','#fef3c7','#fce7f3','#fee2e2'][i % 5]; }

    function renderResults(ai){
      const parsed = parseAIResponse(ai);
      // Labels based on SOURCE (native) language
      const sourceCode = sourceLangSelect.value || currentLang;
      const strings = uiStrings[sourceCode] || uiStrings.en;
      const tts = (LANGS.find(l=>l.code===targetLangSelect.value)?.tts) || 'en-US';

      if (parsed.length === 0 || parsed.every(x => !x.word)){
        resultsList.innerHTML = `<div class="card p-8 text-center muted">${strings.errorNoResults}</div>`;
        return;
      }
      resultsList.innerHTML = parsed.map((it, idx)=>{
        const word = escapeHTML(it.word || '');
        const translation = escapeHTML(it.translation || '');
        const grammar = escapeHTML(it.grammar || 'N/A');
        const collocRaw = (it.collocations || '').split(/,|ÿå/).map(s => s.trim()).filter(Boolean);
        const tagsRaw = (it.tags || '').split(';').map(s=>s.trim()).filter(Boolean);
        const examplesHTML = (it.exampleslist || []).map(ex => {
          const splitAt = ex.lastIndexOf(' - ');
          let original = ex.slice(ex.indexOf('.') + 1).trim();
          let trans = '';
          if (splitAt > 1) {
            original = ex.slice(ex.indexOf('.') + 1, splitAt).trim();
            trans = ex.slice(splitAt + 3).trim();
          }
          return `<li>
              <div class="flex items-center gap-2">
                <p>${escapeHTML(original)}</p>
                <button class="btn btn-ghost p-2" onclick="speakText(event,'${original.replace(/'/g, "\\'")}', '${tts}')" title="${strings.speakSentence}">üîä</button>
              </div>
              ${trans ? `<p class="text-sm muted">${escapeHTML(trans)}</p>`:''}
          </li>`;
        }).join('');
        return `<div class="ring-card">
          <div class="card result-item">
            <div class="result-header flex justify-between items-center p-4" onclick="toggleDetails(${idx})">
              <div class="min-w-0">
                <div class="flex items-center gap-2 flex-wrap">
                  <h3 class="text-xl font-extrabold text-[var(--primary-600)] truncate">${word||strings.wordNotFound}</h3>
                  ${grammar&&grammar!=='N/A'?`<span class="chip"><span class="dot" style="background:${tagPalette(idx)}"></span>${grammar}</span>`:''}
                </div>
                <p class="mt-1 muted">${translation}</p>
              </div>
              <div class="flex items-center gap-2">
                <button class="btn btn-ghost p-2.5" onclick="speakText(event,'${word.replace(/'/g,"\\'")}', '${tts}')" title="${strings.speakWord}">üîä</button>
                <span id="chevron-${idx}" class="text-xl transition-transform">‚ñæ</span>
              </div>
            </div>
            <div id="details-${idx}" class="result-details">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6 pt-2">
                <div>
                  <div class="flex items-center gap-2 mb-2"><span>üìò</span><strong>${strings.definition}:</strong></div>
                  <p>${escapeHTML(it.definition||'N/A')}</p>
                </div>
                <div>
                  <div class="flex items-center gap-2 mb-2"><span>üó£Ô∏è</span><strong>${strings.pronunciation}:</strong></div>
                  <p>${escapeHTML(it.pronunciation||'N/A')}</p>
                </div>
                <div class="md:col-span-2">
                  <div class="flex items-center gap-2 mb-2"><span>üîó</span><strong>${strings.collocations}:</strong></div>
                  <div class="flex flex-wrap gap-2">
                    ${collocRaw.length?collocRaw.map((c,i)=>`<span class="chip" style="background: color-mix(in oklab, ${tagPalette(i)} 60%, transparent)">${escapeHTML(c)}</span>`).join(''):`<span class="text-sm muted">${strings.notApplicable||'‚Äî'}</span>`}
                  </div>
                </div>
                <div class="md:col-span-2">
                  <div class="flex items-center gap-2 mb-2"><span>üè∑Ô∏è</span><strong>${strings.tags||'Tags'}:</strong></div>
                  <div class="flex flex-wrap gap-2">
                    ${tagsRaw.length?tagsRaw.map((t,i)=>`<span class="chip" style="background: color-mix(in oklab, ${tagPalette(i+1)} 60%, transparent)">${escapeHTML(t)}</span>`).join(''):`<span class="text-sm muted">${strings.notApplicable||'‚Äî'}</span>`}
                  </div>
                </div>
                <div class="md:col-span-2">
                  <div class="flex items-center gap-2 mb-2"><span>‚úçÔ∏è</span><strong>${strings.examples}:</strong></div>
                  <ul class="space-y-3 pl-4 pr-4">${examplesHTML}</ul>
                </div>
                <div>
                  <div class="flex items-center gap-2 mb-2"><span>‚ö†Ô∏è</span><strong>${strings.commonMistakes}:</strong></div>
                  <p>${escapeHTML(it.commonmistakes||'N/A')}</p>
                </div>
                <div>
                  <div class="flex items-center gap-2 mb-2"><span>üí°</span><strong>${strings.contextNote}:</strong></div>
                  <p>${(it.contextnote||'').replace(/\n/g,'<br>')}</p>
                </div>
              </div>
            </div>
          </div>
        </div>`;
      }).join('');
    }

    function toggleDetails(i){
      const d=document.getElementById(`details-${i}`); const c=document.getElementById(`chevron-${i}`);
      d.classList.toggle('open'); if(c)c.style.transform=d.classList.contains('open')?'rotate(180deg)':'rotate(0deg)';
    }
    function toggleAll(open){
      document.querySelectorAll('.result-details').forEach((d,idx)=>{
        const c=document.getElementById(`chevron-${idx}`);
        d.classList.toggle('open',open); if(c)c.style.transform=open?'rotate(180deg)':'rotate(0deg)';
      });
    }

    // i18n
    let currentLang='fa';
    const uiStrings = {
      fa:{
        appTitle:"€åÿßÿØ⁄Ø€åÿ±€å ÿ≤ÿ®ÿßŸÜ ÿ®ÿß ŸáŸàÿ¥ ŸÖÿµŸÜŸàÿπ€å",
        mainTitle:"€åÿßÿØ⁄Ø€åÿ±€å ŸÑÿ∫ÿßÿ™ ÿ¨ÿØ€åÿØ ÿ≤ÿ®ÿßŸÜ",
        // big description (moved out of header to the promo box)
        headerSubtitle:"ÿß€åŸÜÿ¨ÿß ŸÖÿ™ŸÜÿßÿ≥ÿ® ÿ®ÿß ÿ≥ÿ∑ÿ≠ ÿ≤ÿ®ÿßŸÜ ÿ¥ŸÖÿßÿå ÿßÿ≤ ŸÖÿ™ŸÜ ÿ¥ŸÖÿß (ÿÆÿ®ÿ±ÿå ÿØÿßÿ≥ÿ™ÿßŸÜÿå ÿ≤€åÿ±ŸÜŸà€åÿ≥ ŸÅ€åŸÑŸÖ Ÿà ...) ÿßÿµÿ∑ŸÑÿßÿ≠ÿßÿ™ Ÿà ÿ¨ŸÖŸÑÿßÿ™ ⁄©ÿßÿ±ÿ®ÿ±ÿØ€å ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ŸÖ€åÿ¥Ÿáÿå ŸÖÿπŸÜ€åÿå ÿ™ŸÑŸÅÿ∏ Ÿà ⁄©ÿßÿ±ÿ®ÿ±ÿØŸáÿß ŸÜŸÖÿß€åÿ¥ ÿØÿßÿØŸá ŸÖ€åÿ¥Ÿá Ÿà ÿ®Ÿá ÿ¥ŸÖÿß ÿØÿ± €åÿßÿØ ⁄Øÿ±ŸÅÿ™ŸÜ ÿ≤ÿ®ÿßŸÜ ÿ¨ÿØ€åÿØ ⁄©ŸÖ⁄© ŸÖ€å⁄©ŸÜŸá.",
        subtitle:"", /* ÿ≠ÿ∞ŸÅ ÿ¥ÿØ */
        sourceLangLabel:"ÿ≤ÿ®ÿßŸÜ ŸÖÿßÿØÿ±€å ŸÖŸÜ",
        targetLangLabel:"ÿ≤ÿ®ÿßŸÜ€å ⁄©Ÿá €åÿßÿØ ŸÖ€å‚Äå⁄Ø€åÿ±ŸÖ",
        userLevelLabel:"ÿ≥ÿ∑ÿ≠ ŸÖŸÜ",
        levels:{unspecified:"ÿßŸÜÿ™ÿÆÿßÿ® ŸÜÿ¥ÿØŸá", A1:"A1 (ŸÖÿ®ÿ™ÿØ€å)", A2:"A2 (ÿßÿ®ÿ™ÿØÿß€å€å)", B1:"B1 (ŸÖÿ™Ÿàÿ≥ÿ∑)", B2:"B2 (ŸÅŸàŸÇ‚ÄåŸÖÿ™Ÿàÿ≥ÿ∑)", C1:"C1 (Ÿæ€åÿ¥ÿ±ŸÅÿ™Ÿá)"},
        forceWordlistLabel:"ÿß€åŸÜ €å⁄© ŸÑ€åÿ≥ÿ™ Ÿàÿß⁄òŸá ÿßÿ≥ÿ™",
        hintStatic:"<p class='font-semibold mb-1'>ÿ±ÿßŸáŸÜŸÖÿß€å Ÿàÿ±ŸàÿØ€å:</p><ul class='list-disc pr-4 space-y-1'><li>ÿß⁄Øÿ± <b>ŸÑ€åÿ≥ÿ™ ⁄©ŸÑŸÖÿßÿ™</b> ÿÆŸàÿØÿ™ŸàŸÜ ÿ±Ÿà ÿØÿßÿ±€åÿØÿå <b>ÿØÿ± Ÿáÿ± ÿÆÿ∑ €å⁄© ⁄©ŸÑŸÖŸá</b> ÿ®ŸÜŸà€åÿ≥€åÿØ €åÿß ÿ®ÿß <code>-</code> ÿ¨ÿØÿß ⁄©ŸÜ€åÿØÿõ ÿØÿ± ÿß€åŸÜ ÿ≠ÿßŸÑÿ™ <b>ŸÜ€åÿßÿ≤€å ÿ®Ÿá ÿßŸÜÿ™ÿÆÿßÿ® ÿ≥ÿ∑ÿ≠ ŸÜ€åÿ≥ÿ™</b> Ÿà ⁄Øÿ≤€åŸÜŸá ¬´ÿß€åŸÜ ŸÑ€åÿ≥ÿ™ Ÿàÿß⁄òŸá ÿßÿ≥ÿ™¬ª ÿ±ÿß ŸÅÿπÿßŸÑ ⁄©ŸÜ€åÿØ.</li><li>ÿß⁄Øÿ± ŸÖ€å‚ÄåÿÆŸàÿßŸá€åÿØ ŸÖÿß ÿßÿ≤ <b>ŸÖÿ™ŸÜ</b> ÿ¥ŸÖÿß ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ⁄©ŸÜ€åŸÖÿå <b>ÿ≥ÿ∑ÿ≠ ÿ≤ÿ®ÿßŸÜ</b> ÿ±ÿß ÿßÿ≤ ŸÖŸÜŸà€å ÿ®ÿßŸÑÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ ÿ™ÿß ÿßÿµÿ∑ŸÑÿßÿ≠ÿßÿ™ ⁄©ÿßÿ±ÿ®ÿ±ÿØ€å <b>ŸÖÿ™ŸÜÿßÿ≥ÿ® ÿ®ÿß ÿ≥ÿ∑ÿ≠ ÿ¥ŸÖÿß</b> ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿ¥ŸàÿØ.</li></ul>",
        uploadBtnText:"ÿ¢ŸæŸÑŸàÿØ ŸÅÿß€åŸÑ (.txt, .srt)",
        processBtn:"ÿ™ÿ≠ŸÑ€åŸÑ ⁄©ŸÜ",
        resultsTitle:"ŸÜÿ™ÿß€åÿ¨ ÿ™ÿ≠ŸÑ€åŸÑ",
        startOverBtn:"ÿ¥ÿ±Ÿàÿπ ÿØŸàÿ®ÿßÿ±Ÿá",
        expandAll:"ÿ®ÿßÿ≤ ⁄©ÿ±ÿØŸÜ ŸáŸÖŸá",
        collapseAll:"ÿ®ÿ≥ÿ™ŸÜ ŸáŸÖŸá",
        errorText:"ŸÑÿ∑ŸÅÿßŸã Ÿàÿ±ŸàÿØ€å ŸÖÿπÿ™ÿ®ÿ± Ÿàÿßÿ±ÿØ €åÿß ÿ¢ŸæŸÑŸàÿØ ⁄©ŸÜ€åÿØ.",
        errorLevel:"ÿ®ÿ±ÿß€å ŸÖÿ™ŸÜ‚ÄåŸáÿß/ŸÅÿß€åŸÑ‚ÄåŸáÿß ŸÑÿ∑ŸÅÿßŸã ÿ≥ÿ∑ÿ≠ ÿÆŸàÿØ ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ.",
        errorAIResponse:"Ÿæÿßÿ≥ÿÆ ŸÖÿπÿ™ÿ®ÿ±€å ÿßÿ≤ ŸáŸàÿ¥ ŸÖÿµŸÜŸàÿπ€å ÿØÿ±€åÿßŸÅÿ™ ŸÜÿ¥ÿØ.",
        errorServer:"ŸÖÿ¥⁄©ŸÑ ÿßÿ±ÿ™ÿ®ÿßÿ∑ ÿ®ÿß ÿ≥ÿ±Ÿàÿ±. ÿØŸàÿ®ÿßÿ±Ÿá ÿ™ŸÑÿßÿ¥ ⁄©ŸÜ€åÿØ.",
        errorNoResults:"ŸÖŸàÿ±ÿØ€å Ÿæ€åÿØÿß ŸÜÿ¥ÿØ.",
        wordNotFound:"⁄©ŸÑŸÖŸá €åÿßŸÅÿ™ ŸÜÿ¥ÿØ",
        definition:"ÿ™ÿπÿ±€åŸÅ",
        grammar:"⁄Øÿ±ÿßŸÖÿ±",
        collocations:"ÿ™ÿ±⁄©€åÿ®‚ÄåŸáÿß€å ÿ±ÿß€åÿ¨",
        examples:"ŸÖÿ´ÿßŸÑ‚ÄåŸáÿß",
        commonMistakes:"ÿßÿ¥ÿ™ÿ®ÿßŸáÿßÿ™ ÿ±ÿß€åÿ¨",
        contextNote:"ŸÜ⁄©ÿ™Ÿá",
        pronunciation:"ÿ™ŸÑŸÅÿ∏",
        notApplicable:"‚Äî",
        tags:"ÿ®ÿ±⁄Üÿ≥ÿ®‚ÄåŸáÿß",
        speakWord:"ÿ¥ŸÜ€åÿØŸÜ Ÿàÿß⁄òŸá",
        speakSentence:"ÿ¥ŸÜ€åÿØŸÜ ÿ¨ŸÖŸÑŸá",
        stopSpeech:"ÿ™ŸàŸÇŸÅ ⁄ØŸÅÿ™ÿßÿ±",
        footerLine1:"", /* ÿ≠ÿ∞ŸÅ */
        footerLine2:`ÿ≥ÿßÿ≤ŸÜÿØŸá: <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`,
        textPlaceholder:"ŸÑ€åÿ≥ÿ™ ⁄©ŸÑŸÖÿßÿ™ ÿÆŸàÿØ ÿ±ÿß ÿß€åŸÜÿ¨ÿß Ÿàÿßÿ±ÿØ ⁄©ŸÜ€åÿØ €åÿß ŸÖÿ™ŸÜ/ŸÅÿß€åŸÑ ÿ±ÿß Paste ⁄©ŸÜ€åÿØ‚Ä¶",
        dropHint:"ŸÖ€å‚Äåÿ™ŸàÿßŸÜ€åÿØ ⁄©ŸÑŸÖÿßÿ™ ÿ±ÿß ÿ™ÿß€åŸæ ⁄©ŸÜ€åÿØ €åÿß ŸÅÿß€åŸÑ .txt/.srt ÿ±ÿß ÿ®⁄©ÿ¥€åÿØ Ÿà ÿ±Ÿáÿß ⁄©ŸÜ€åÿØ.",
        modeWordlist:"ÿ≠ÿßŸÑÿ™: ŸÑ€åÿ≥ÿ™ ⁄©ŸÑŸÖÿßÿ™",
        modeText:"ÿ≠ÿßŸÑÿ™: ŸÖÿ™ŸÜ/ŸÅÿß€åŸÑ",
        levelWarning:"ŸÑÿ∑ŸÅÿßŸã <b>ÿ≥ÿ∑ÿ≠ ÿ≤ÿ®ÿßŸÜ</b> ÿÆŸàÿØ ÿ±ÿß ÿßŸÜÿ™ÿÆÿßÿ® ⁄©ŸÜ€åÿØ ÿ™ÿß ÿßÿµÿ∑ŸÑÿßÿ≠ÿßÿ™ ŸÖÿ™ŸÜÿßÿ≥ÿ® ÿ®ÿß ÿ≥ÿ∑ÿ≠ ÿ¥ŸÖÿß ÿßÿ≥ÿ™ÿÆÿ±ÿßÿ¨ ÿ¥ŸàÿØ."
      },
      en:{
        appTitle:"AI Language Learner",
        mainTitle:"Learn New Vocabulary",
        headerSubtitle:"We extract useful phrases from your text (news, stories, subtitles, ‚Ä¶) based on your level, then show meaning, pronunciation, and usage to help you learn a new language.",
        subtitle:"",
        sourceLangLabel:"My Native Language",
        targetLangLabel:"Language I'm Learning",
        userLevelLabel:"My Level",
        levels:{unspecified:"Unspecified", A1:"A1 (Beginner)", A2:"A2 (Elementary)", B1:"B1 (Intermediate)", B2:"B2 (Upper-Intermediate)", C1:"C1 (Advanced)"},
        forceWordlistLabel:"This is a word list",
        hintStatic:"<p class='font-semibold mb-1'>Input Guide:</p><ul class='list-disc pl-4 space-y-1'><li>If you already have a <b>word list</b>, write <b>one item per line</b> or separate with <code>-</code>; <b>no need to select level</b>. Then check the box.</li><li>If you want us to extract from a <b>text</b>, please choose your <b>level</b> so we pull phrases <b>matched to you</b>.</li></ul>",
        uploadBtnText:"Upload File (.txt, .srt)",
        processBtn:"Analyze",
        resultsTitle:"Analysis Results",
        startOverBtn:"Start Over",
        expandAll:"Expand All",
        collapseAll:"Collapse All",
        errorText:"Please enter or upload valid input.",
        errorLevel:"For texts/files, please select your level.",
        errorAIResponse:"No valid AI response.",
        errorServer:"Server connection issue.",
        errorNoResults:"No items found.",
        wordNotFound:"Word not found",
        definition:"Definition",
        grammar:"Grammar",
        collocations:"Collocations",
        examples:"Examples",
        commonMistakes:"Common Mistakes",
        contextNote:"Context/Note",
        pronunciation:"Pronunciation",
        notApplicable:"‚Äî",
        tags:"Tags",
        speakWord:"Speak word",
        speakSentence:"Speak sentence",
        stopSpeech:"Stop speech",
        footerLine1:"",
        footerLine2:`Built by <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`,
        textPlaceholder:"Enter your word list here or paste a text/file‚Ä¶",
        dropHint:"Type your words or drag & drop a .txt/.srt file.",
        modeWordlist:"Mode: Word list",
        modeText:"Mode: Text/File",
        levelWarning:"Please select your <b>level</b> so we can extract phrases matched to you."
      },
      de:{
        appTitle:"KI-Sprachlerner",
        mainTitle:"Neue Vokabeln lernen",
        headerSubtitle:"Wir extrahieren passende Ausdr√ºcke aus deinem Text (Nachrichten, Geschichten, Untertitel ‚Ä¶) gem√§√ü deinem Niveau und zeigen Bedeutung, Aussprache und Verwendung.",
        subtitle:"",
        sourceLangLabel:"Meine Muttersprache",
        targetLangLabel:"Zielsprache",
        userLevelLabel:"Mein Niveau",
        levels:{unspecified:"Nicht angegeben", A1:"A1 (Anf√§nger)", A2:"A2 (Grundlegend)", B1:"B1 (Mittelstufe)", B2:"B2 (Obere Mittelstufe)", C1:"C1 (Fortgeschritten)"},
        forceWordlistLabel:"Dies ist eine Wortliste",
        hintStatic:"<p class='font-semibold mb-1'>Eingabe-Hinweis:</p><ul class='list-disc pl-4 space-y-1'><li><b>Wortliste</b> vorhanden? <b>Ein Eintrag pro Zeile</b> oder mit <code>-</code> trennen; <b>kein Niveau n√∂tig</b>. Checkbox aktivieren.</li><li>Aus <b>Text</b> extrahieren? Bitte dein <b>Niveau</b> w√§hlen, damit wir passende Ausdr√ºcke finden.</li></ul>",
        uploadBtnText:"Datei hochladen (.txt, .srt)",
        processBtn:"Analysieren",
        resultsTitle:"Analyse-Ergebnisse",
        startOverBtn:"Neu starten",
        expandAll:"Alle √∂ffnen",
        collapseAll:"Alle schlie√üen",
        errorText:"Bitte g√ºltige Eingabe eingeben oder hochladen.",
        errorLevel:"F√ºr Texte/Dateien bitte dein Niveau w√§hlen.",
        errorAIResponse:"Keine g√ºltige KI-Antwort.",
        errorServer:"Serververbindungsproblem.",
        errorNoResults:"Keine Eintr√§ge gefunden.",
        wordNotFound:"Wort nicht gefunden",
        definition:"Definition",
        grammar:"Grammatik",
        collocations:"Kollokationen",
        examples:"Beispiele",
        commonMistakes:"H√§ufige Fehler",
        contextNote:"Hinweis",
        pronunciation:"Aussprache",
        notApplicable:"‚Äî",
        tags:"Tags",
        speakWord:"Wort vorlesen",
        speakSentence:"Satz vorlesen",
        stopSpeech:"Sprachausgabe stoppen",
        footerLine1:"",
        footerLine2:`Erstellt von <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`,
        textPlaceholder:"Wortliste hier eingeben oder Text/Datei einf√ºgen‚Ä¶",
        dropHint:"W√∂rter tippen oder .txt/.srt-Datei ablegen.",
        modeWordlist:"Modus: Wortliste",
        modeText:"Modus: Text/Datei",
        levelWarning:"Bitte w√§hle dein <b>Niveau</b>, damit wir passende Ausdr√ºcke extrahieren."
      },
      fr:{
        appTitle:"Apprenant de langues IA",
        mainTitle:"Apprendre de nouveaux mots",
        headerSubtitle:"Nous extrayons des expressions utiles de votre texte (actu, histoire, sous-titres‚Ä¶) selon votre niveau, et affichons sens, prononciation et usages.",
        subtitle:"",
        sourceLangLabel:"Ma langue maternelle",
        targetLangLabel:"Langue que j‚Äôapprends",
        userLevelLabel:"Mon niveau",
        levels:{unspecified:"Non pr√©cis√©", A1:"A1 (D√©butant)", A2:"A2 (√âl√©mentaire)", B1:"B1 (Interm√©diaire)", B2:"B2 (Interm√©diaire sup√©rieur)", C1:"C1 (Avanc√©)"},
        forceWordlistLabel:"Ceci est une liste de mots",
        hintStatic:"<p class='font-semibold mb-1'>Guide d‚Äôentr√©e :</p><ul class='list-disc pl-4 space-y-1'><li>Vous avez une <b>liste</b> ? <b>Un √©l√©ment par ligne</b> ou s√©par√© par <code>-</code> ; <b>pas besoin de niveau</b>. Cochez la case.</li><li>Pour extraire depuis un <b>texte</b>, choisissez votre <b>niveau</b> pour obtenir des expressions adapt√©es.</li></ul>",
        uploadBtnText:"Importer un fichier (.txt, .srt)",
        processBtn:"Analyser",
        resultsTitle:"R√©sultats de l‚Äôanalyse",
        startOverBtn:"Recommencer",
        expandAll:"Tout d√©ployer",
        collapseAll:"Tout replier",
        errorText:"Veuillez saisir ou importer une entr√©e valide.",
        errorLevel:"Pour les textes/fichiers, veuillez s√©lectionner votre niveau.",
        errorAIResponse:"Aucune r√©ponse IA valide.",
        errorServer:"Probl√®me de connexion au serveur.",
        errorNoResults:"Aucun √©l√©ment trouv√©.",
        wordNotFound:"Mot introuvable",
        definition:"D√©finition",
        grammar:"Grammaire",
        collocations:"Collocations",
        examples:"Exemples",
        commonMistakes:"Erreurs courantes",
        contextNote:"Remarque",
        pronunciation:"Prononciation",
        notApplicable:"‚Äî",
        tags:"Tags",
        speakWord:"Prononcer le mot",
        speakSentence:"Prononcer la phrase",
        stopSpeech:"Arr√™ter la lecture",
        footerLine1:"",
        footerLine2:`Cr√©√© par <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`,
        textPlaceholder:"Entrez votre liste ou collez un texte/fichier‚Ä¶",
        dropHint:"Saisissez vos mots ou d√©posez un fichier .txt/.srt.",
        modeWordlist:"Mode : Liste de mots",
        modeText:"Mode : Texte/Fichier",
        levelWarning:"Veuillez s√©lectionner votre <b>niveau</b> pour extraire des expressions adapt√©es."
      },
      es:{
        appTitle:"Aprendiz de idiomas con IA",
        mainTitle:"Aprender vocabulario nuevo",
        headerSubtitle:"Extraemos expresiones √∫tiles de tu texto (noticias, historias, subt√≠tulos‚Ä¶) seg√∫n tu nivel y mostramos significado, pronunciaci√≥n y uso.",
        subtitle:"",
        sourceLangLabel:"Mi lengua materna",
        targetLangLabel:"Idioma que aprendo",
        userLevelLabel:"Mi nivel",
        levels:{unspecified:"Sin especificar", A1:"A1 (Principiante)", A2:"A2 (B√°sico)", B1:"B1 (Intermedio)", B2:"B2 (Intermedio alto)", C1:"C1 (Avanzado)"},
        forceWordlistLabel:"Esta es una lista de palabras",
        hintStatic:"<p class='font-semibold mb-1'>Gu√≠a de entrada:</p><ul class='list-disc pl-4 space-y-1'><li>Si ya tienes una <b>lista</b>, pon <b>un elemento por l√≠nea</b> o sep√°ralos con <code>-</code>; <b>no hace falta nivel</b>. Marca la casilla.</li><li>Para extraer de un <b>texto</b>, elige tu <b>nivel</b> para obtener expresiones adecuadas.</li></ul>",
        uploadBtnText:"Subir archivo (.txt, .srt)",
        processBtn:"Analizar",
        resultsTitle:"Resultados del an√°lisis",
        startOverBtn:"Reiniciar",
        expandAll:"Expandir todo",
        collapseAll:"Contraer todo",
        errorText:"Introduce o sube una entrada v√°lida.",
        errorLevel:"Para textos/archivos, selecciona tu nivel.",
        errorAIResponse:"Respuesta de IA no v√°lida.",
        errorServer:"Problemas de conexi√≥n.",
        errorNoResults:"No se encontraron elementos.",
        wordNotFound:"Palabra no encontrada",
        definition:"Definici√≥n",
        grammar:"Gram√°tica",
        collocations:"Colocaciones",
        examples:"Ejemplos",
        commonMistakes:"Errores comunes",
        contextNote:"Nota",
        pronunciation:"Pronunciaci√≥n",
        notApplicable:"‚Äî",
        tags:"Etiquetas",
        speakWord:"Pronunciar palabra",
        speakSentence:"Pronunciar frase",
        stopSpeech:"Detener voz",
        footerLine1:"",
        footerLine2:`Creado por <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`,
        textPlaceholder:"Escribe tu lista o pega un texto/archivo‚Ä¶",
        dropHint:"Escribe palabras o suelta un .txt/.srt.",
        modeWordlist:"Modo: Lista",
        modeText:"Modo: Texto/Archivo",
        levelWarning:"Selecciona tu <b>nivel</b> para extraer expresiones adecuadas."
      },
      zh:{
        appTitle:"AI ËØ≠Ë®ÄÂ≠¶‰π†Âä©Êâã",
        mainTitle:"Â≠¶‰π†Êñ∞ËØçÊ±á",
        headerSubtitle:"Ê†πÊçÆ‰Ω†ÁöÑÊ∞¥Âπ≥Ôºå‰ªé‰Ω†ÁöÑÊñáÊú¨ÔºàÊñ∞Èóª„ÄÅÊïÖ‰∫ã„ÄÅÂ≠óÂπïÁ≠âÔºâÊèêÂèñÂÆûÁî®Áü≠ËØ≠ÔºåÂπ∂ÊòæÁ§∫Èáä‰πâ„ÄÅÂèëÈü≥‰∏éÁî®Ê≥ïÔºåÂ∏ÆÂä©‰Ω†Â≠¶‰π†Êñ∞ËØ≠Ë®Ä„ÄÇ",
        subtitle:"",
        sourceLangLabel:"ÊØçËØ≠",
        targetLangLabel:"Ê≠£Âú®Â≠¶‰π†ÁöÑËØ≠Ë®Ä",
        userLevelLabel:"ÊàëÁöÑÊ∞¥Âπ≥",
        levels:{unspecified:"Êú™ÊåáÂÆö", A1:"A1ÔºàÂàùÁ∫ßÔºâ", A2:"A2ÔºàÂü∫Á°ÄÔºâ", B1:"B1Ôºà‰∏≠Á∫ßÔºâ", B2:"B2Ôºà‰∏≠È´òÁ∫ßÔºâ", C1:"C1ÔºàÈ´òÁ∫ßÔºâ"},
        forceWordlistLabel:"ËøôÊòØ‰∏Ä‰∏™ËØçË°®",
        hintStatic:"<p class='font-semibold mb-1'>ËæìÂÖ•ÊåáÂçóÔºö</p><ul class='list-disc pl-4 space-y-1'><li>Â∑≤Êúâ<b>ËØçË°®</b>Ôºü<b>ÊØèË°å‰∏Ä‰∏™</b>ÊàñÁî® <code>-</code> ÂàÜÈöîÔºõ<b>Êó†ÈúÄÈÄâÊã©Ê∞¥Âπ≥</b>„ÄÇÂãæÈÄâÂ§çÈÄâÊ°ÜÂç≥ÂèØ„ÄÇ</li><li>ÈúÄË¶Å‰ªé<b>ÊñáÊú¨</b>ÊèêÂèñÔºüËØ∑ÈÄâÊã©<b>Ê∞¥Âπ≥</b>‰ª•‰æøÂæóÂà∞‰∏é‰Ω†ÂåπÈÖçÁöÑÁü≠ËØ≠„ÄÇ</li></ul>",
        uploadBtnText:"‰∏ä‰º†Êñá‰ª∂ (.txt, .srt)",
        processBtn:"ÂàÜÊûê",
        resultsTitle:"ÂàÜÊûêÁªìÊûú",
        startOverBtn:"ÈáçÊñ∞ÂºÄÂßã",
        expandAll:"ÂÖ®ÈÉ®Â±ïÂºÄ",
        collapseAll:"ÂÖ®ÈÉ®Êî∂Ëµ∑",
        errorText:"ËØ∑ËæìÂÖ•Êàñ‰∏ä‰º†ÊúâÊïàÂÜÖÂÆπ„ÄÇ",
        errorLevel:"ÂØπ‰∫éÊñáÊú¨/Êñá‰ª∂ÔºåËØ∑ÈÄâÊã©‰Ω†ÁöÑÊ∞¥Âπ≥„ÄÇ",
        errorAIResponse:"AI ÂìçÂ∫îÊó†Êïà„ÄÇ",
        errorServer:"ÊúçÂä°Âô®ËøûÊé•ÈóÆÈ¢ò„ÄÇ",
        errorNoResults:"Êú™ÊâæÂà∞ÁªìÊûú„ÄÇ",
        wordNotFound:"Êú™ÊâæÂà∞ËØçËØ≠",
        definition:"Èáä‰πâ",
        grammar:"ËØ≠Ê≥ï",
        collocations:"Êê≠ÈÖç",
        examples:"‰æãÂè•",
        commonMistakes:"Â∏∏ËßÅÈîôËØØ",
        contextNote:"ËØ¥Êòé",
        pronunciation:"ÂèëÈü≥",
        notApplicable:"‚Äî",
        tags:"Ê†áÁ≠æ",
        speakWord:"ÊúóËØªÂçïËØç",
        speakSentence:"ÊúóËØªÂè•Â≠ê",
        stopSpeech:"ÂÅúÊ≠¢ÊúóËØª",
        footerLine1:"",
        footerLine2:`‰ΩúËÄÖÔºö<a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`,
        textPlaceholder:"Âú®Ê≠§ËæìÂÖ•ËØçË°®ÊàñÁ≤òË¥¥ÊñáÊú¨/Êñá‰ª∂‚Ä¶",
        dropHint:"ËæìÂÖ•ËØçËØ≠ÊàñÊãñÊîæ .txt/.srt Êñá‰ª∂„ÄÇ",
        modeWordlist:"Ê®°ÂºèÔºöËØçË°®",
        modeText:"Ê®°ÂºèÔºöÊñáÊú¨/Êñá‰ª∂",
        levelWarning:"ËØ∑ÈÄâÊã©‰Ω†ÁöÑ<b>Ê∞¥Âπ≥</b>‰ª•ÊèêÂèñÂåπÈÖçÁöÑÁü≠ËØ≠„ÄÇ"
      },
      tr:{
        appTitle:"YZ Dil √ñƒürenici",
        mainTitle:"Yeni kelimeler √∂ƒüren",
        headerSubtitle:"Seviyene g√∂re metninden (haber, hik√¢ye, altyazƒ±‚Ä¶) kullanƒ±≈ülƒ± ifadeleri √ßƒ±karƒ±r; anlam, telaffuz ve kullanƒ±mƒ± g√∂sterir.",
        subtitle:"",
        sourceLangLabel:"Anadilim",
        targetLangLabel:"√ñƒürendiƒüim dil",
        userLevelLabel:"Seviyem",
        levels:{unspecified:"Belirtilmedi", A1:"A1 (Ba≈ülangƒ±√ß)", A2:"A2 (Temel)", B1:"B1 (Orta)", B2:"B2 (√úst Orta)", C1:"C1 (ƒ∞leri)"},
        forceWordlistLabel:"Bu bir kelime listesi",
        hintStatic:"<p class='font-semibold mb-1'>Girdi Rehberi:</p><ul class='list-disc pl-4 space-y-1'><li><b>Kelime listen</b> varsa: <b>satƒ±r ba≈üƒ±na bir</b> veya <code>-</code> ile ayƒ±r; <b>seviye se√ßmeye gerek yok</b>. Kutuyu i≈üaretle.</li><li><b>Metinden</b> √ßƒ±karƒ±lacaksa: <b>seviyeni</b> se√ß ki sana uygun ifadeler gelsin.</li></ul>",
        uploadBtnText:"Dosya y√ºkle (.txt, .srt)",
        processBtn:"Analiz et",
        resultsTitle:"Analiz Sonu√ßlarƒ±",
        startOverBtn:"Ba≈ütan ba≈üla",
        expandAll:"Hepsini a√ß",
        collapseAll:"Hepsini kapa",
        errorText:"L√ºtfen ge√ßerli bir girdi gir ya da y√ºkle.",
        errorLevel:"Metin/dosyalar i√ßin l√ºtfen seviyeni se√ß.",
        errorAIResponse:"Ge√ßerli YZ yanƒ±tƒ± yok.",
        errorServer:"Sunucu baƒülantƒ± sorunu.",
        errorNoResults:"√ñƒüe bulunamadƒ±.",
        wordNotFound:"Kelime bulunamadƒ±",
        definition:"Tanƒ±m",
        grammar:"Dilbilgisi",
        collocations:"Sƒ±k birle≈üimler",
        examples:"√ñrnekler",
        commonMistakes:"Yaygƒ±n hatalar",
        contextNote:"Not",
        pronunciation:"Telaffuz",
        notApplicable:"‚Äî",
        tags:"Etiketler",
        speakWord:"Kelimeyi oku",
        speakSentence:"C√ºmleyi oku",
        stopSpeech:"Okumayƒ± durdur",
        footerLine1:"",
        footerLine2:`Geli≈ütirici: <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`,
        textPlaceholder:"Kelime listesini yaz veya metin/dosya yapƒ±≈ütƒ±r‚Ä¶",
        dropHint:"Kelimeleri yaz ya da .txt/.srt dosyasƒ± bƒ±rak.",
        modeWordlist:"Mod: Kelime listesi",
        modeText:"Mod: Metin/Dosya",
        levelWarning:"Uygun ifadeleri √ßƒ±karmak i√ßin l√ºtfen <b>seviyeni</b> se√ß."
      },
      it:{
        appTitle:"Apprendimento lingue con IA",
        mainTitle:"Imparare nuovo vocabolario",
        headerSubtitle:"Estriamo frasi utili dal tuo testo (notizie, storie, sottotitoli‚Ä¶) in base al tuo livello, mostrando significato, pronuncia e uso.",
        subtitle:"",
        sourceLangLabel:"Lingua madre",
        targetLangLabel:"Lingua che sto imparando",
        userLevelLabel:"Il mio livello",
        levels:{unspecified:"Non specificato", A1:"A1 (Principiante)", A2:"A2 (Elementare)", B1:"B1 (Intermedio)", B2:"B2 (Intermedio superiore)", C1:"C1 (Avanzato)"},
        forceWordlistLabel:"Questo √® un elenco di parole",
        hintStatic:"<p class='font-semibold mb-1'>Guida all‚Äôinput:</p><ul class='list-disc pl-4 space-y-1'><li>Hai un <b>elenco</b>? <b>Una riga per parola</b> o separa con <code>-</code>; <b>nessun livello necessario</b>. Spunta la casella.</li><li>Per estrarre da un <b>testo</b>: seleziona il tuo <b>livello</b> per ottenere espressioni adatte.</li></ul>",
        uploadBtnText:"Carica file (.txt, .srt)",
        processBtn:"Analizza",
        resultsTitle:"Risultati dell‚Äôanalisi",
        startOverBtn:"Ricomincia",
        expandAll:"Espandi tutto",
        collapseAll:"Comprimi tutto",
        errorText:"Inserisci o carica un input valido.",
        errorLevel:"Per testi/file, seleziona il tuo livello.",
        errorAIResponse:"Risposta IA non valida.",
        errorServer:"Problema di connessione al server.",
        errorNoResults:"Nessun elemento trovato.",
        wordNotFound:"Parola non trovata",
        definition:"Definizione",
        grammar:"Grammatica",
        collocations:"Collocazioni",
        examples:"Esempi",
        commonMistakes:"Errori comuni",
        contextNote:"Nota",
        pronunciation:"Pronuncia",
        notApplicable:"‚Äî",
        tags:"Tag",
        speakWord:"Pronuncia parola",
        speakSentence:"Pronuncia frase",
        stopSpeech:"Ferma voce",
        footerLine1:"",
        footerLine2:`Creato da <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`,
        textPlaceholder:"Inserisci elenco o incolla testo/file‚Ä¶",
        dropHint:"Scrivi parole o rilascia un file .txt/.srt.",
        modeWordlist:"Modalit√†: Elenco",
        modeText:"Modalit√†: Testo/File",
        levelWarning:"Seleziona il tuo <b>livello</b> per estrarre espressioni adatte."
      },
      ru:{
        appTitle:"–ò–∑—É—á–µ–Ω–∏–µ —è–∑—ã–∫–æ–≤ —Å –ò–ò",
        mainTitle:"–ò–∑—É—á–∞—Ç—å –Ω–æ–≤—ã–µ —Å–ª–æ–≤–∞",
        headerSubtitle:"–ú—ã –∏–∑–≤–ª–µ–∫–∞–µ–º –ø–æ–ª–µ–∑–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –≤–∞—à–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ (–Ω–æ–≤–æ—Å—Ç–∏, —Ä–∞—Å—Å–∫–∞–∑—ã, —Å—É–±—Ç–∏—Ç—Ä—ã –∏ —Ç. –ø.) —Å —É—á—ë—Ç–æ–º —É—Ä–æ–≤–Ω—è –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ, –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ –∏ —É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ.",
        subtitle:"",
        sourceLangLabel:"–†–æ–¥–Ω–æ–π —è–∑—ã–∫",
        targetLangLabel:"–ò–∑—É—á–∞–µ–º—ã–π —è–∑—ã–∫",
        userLevelLabel:"–ú–æ–π —É—Ä–æ–≤–µ–Ω—å",
        levels:{unspecified:"–ù–µ —É–∫–∞–∑–∞–Ω", A1:"A1 (–ù–∞—á–∞–ª—å–Ω—ã–π)", A2:"A2 (–≠–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω—ã–π)", B1:"B1 (–°—Ä–µ–¥–Ω–∏–π)", B2:"B2 (–í—ã—à–µ —Å—Ä–µ–¥–Ω–µ–≥–æ)", C1:"C1 (–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)"},
        forceWordlistLabel:"–≠—Ç–æ —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤",
        hintStatic:"<p class='font-semibold mb-1'>–ö–∞–∫ –≤–≤–æ–¥–∏—Ç—å:</p><ul class='list-disc pl-4 space-y-1'><li>–ï—Å—Ç—å <b>—Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤</b>? <b>–ü–æ –æ–¥–Ω–æ–º—É –≤ —Å—Ç—Ä–æ–∫–µ</b> –∏–ª–∏ —Ä–∞–∑–¥–µ–ª—è–π—Ç–µ <code>-</code>; <b>—É—Ä–æ–≤–µ–Ω—å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è</b>. –û—Ç–º–µ—Ç—å—Ç–µ –≥–∞–ª–æ—á–∫—É.</li><li>–ù—É–∂–Ω–æ –∏–∑–≤–ª–µ—á—å –∏–∑ <b>—Ç–µ–∫—Å—Ç–∞</b>? –í—ã–±–µ—Ä–∏—Ç–µ <b>—É—Ä–æ–≤–µ–Ω—å</b>, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è.</li></ul>",
        uploadBtnText:"–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª (.txt, .srt)",
        processBtn:"–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å",
        resultsTitle:"–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞",
        startOverBtn:"–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ",
        expandAll:"–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ",
        collapseAll:"–°–≤–µ—Ä–Ω—É—Ç—å –≤—Å–µ",
        errorText:"–í–≤–µ–¥–∏—Ç–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.",
        errorLevel:"–î–ª—è —Ç–µ–∫—Å—Ç–∞/—Ñ–∞–π–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —É—Ä–æ–≤–µ–Ω—å.",
        errorAIResponse:"–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –ò–ò.",
        errorServer:"–ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ —Å–µ—Ä–≤–µ—Ä—É.",
        errorNoResults:"–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ.",
        wordNotFound:"–°–ª–æ–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",
        definition:"–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ",
        grammar:"–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞",
        collocations:"–ö–æ–ª–ª–æ–∫–∞—Ü–∏–∏",
        examples:"–ü—Ä–∏–º–µ—Ä—ã",
        commonMistakes:"–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏",
        contextNote:"–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ",
        pronunciation:"–ü—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ",
        notApplicable:"‚Äî",
        tags:"–¢–µ–≥–∏",
        speakWord:"–ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ —Å–ª–æ–≤–æ",
        speakSentence:"–ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ",
        stopSpeech:"–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–∑–≤—É—á–∫—É",
        footerLine1:"",
        footerLine2:`–ê–≤—Ç–æ—Ä: <a href="https://www.linkedin.com/in/mr-qaderi/" target="_blank" rel="noopener" class="text-[var(--primary-600)] hover:underline font-semibold">MohammadReza Qaderi</a>`,
        textPlaceholder:"–í–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∏–ª–∏ –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç/—Ñ–∞–π–ª‚Ä¶",
        dropHint:"–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–∞ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ .txt/.srt.",
        modeWordlist:"–†–µ–∂–∏–º: –°–ø–∏—Å–æ–∫ —Å–ª–æ–≤",
        modeText:"–†–µ–∂–∏–º: –¢–µ–∫—Å—Ç/–§–∞–π–ª",
        levelWarning:"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ <b>—É—Ä–æ–≤–µ–Ω—å</b>, —á—Ç–æ–±—ã –∏–∑–≤–ª–µ—á—å –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è."
      }
    };

    function setLanguage(lang){
      currentLang = lang;
      const s = uiStrings[lang] || uiStrings.en;
      const isRtl = RTL_LANGS.has(lang);
      document.documentElement.lang = lang;
      document.documentElement.dir = isRtl ? 'rtl' : 'ltr';

      const map = {
        'main-title':s.mainTitle, 'header-subtitle':s.headerSubtitle, // kept for completeness
        'source-lang-label':s.sourceLangLabel, 'target-lang-label':s.targetLangLabel,
        'user-level-label':s.userLevelLabel, 'force-wordlist-label':s.forceWordlistLabel,
        'hint':s.hintStatic, 'upload-btn-text':s.uploadBtnText, 'results-title':s.resultsTitle,
        'start-over-btn':s.startOverBtn, 'drop-hint-text':s.dropHint
      };
      for(const id in map){ const el=document.getElementById(id); if(el) el.innerHTML = map[id]; }

      bigDesc.textContent = s.headerSubtitle; // ŸÖÿ™ŸÜ ÿ®ÿ≤ÿ±⁄Ø Ÿæÿ±ŸàŸÖŸà
      document.title = s.appTitle;
      document.querySelector('#process-btn > span').textContent = s.processBtn;
      document.getElementById('expand-all').innerHTML = `‚¨áÔ∏è ${s.expandAll}`;
      document.getElementById('collapse-all').innerHTML = `‚¨ÜÔ∏è ${s.collapseAll}`;
      document.getElementById('stop-tts').title = s.stopSpeech;
      document.getElementById('to-top').title = isRtl ? 'ÿ®ÿßÿ≤⁄Øÿ¥ÿ™ ÿ®Ÿá ÿ®ÿßŸÑÿß' : (lang==='fr'?'Haut de page':lang==='es'?'Volver arriba':lang==='de'?'Zur√ºck nach oben':'Back to top');
      document.getElementById('text-input').placeholder = s.textPlaceholder;
      document.getElementById('footer-text-line1').innerHTML = s.footerLine1 || '';
      document.getElementById('footer-text-line2').innerHTML = s.footerLine2 || '';

      // fix level options
      const lv = s.levels || uiStrings.en.levels;
      document.getElementById('level-unspecified').textContent = lv.unspecified;
      document.getElementById('level-a1').textContent = lv.A1;
      document.getElementById('level-a2').textContent = lv.A2;
      document.getElementById('level-b1').textContent = lv.B1;
      document.getElementById('level-b2').textContent = lv.B2;
      document.getElementById('level-c1').textContent = lv.C1;

      updateModeBadge();
      syncLevelRequirement();
    }

    // Populate language selects once
    document.addEventListener('DOMContentLoaded', ()=> {
      [uiLangSwitcher, sourceLangSelect, targetLangSelect].forEach(sel => {
        sel.innerHTML = LANGS.map(l => `<option value="${l.code}">${l.label}</option>`).join('');
      });
      const lang = localStorage.getItem('ll-lang') || 'fa';
      setLanguage(lang);
      uiLangSwitcher.value = lang;
      sourceLangSelect.value = 'fa';
      targetLangSelect.value = 'en';
      updateModeBadge();
    });
  </script>
</body>
</html>
